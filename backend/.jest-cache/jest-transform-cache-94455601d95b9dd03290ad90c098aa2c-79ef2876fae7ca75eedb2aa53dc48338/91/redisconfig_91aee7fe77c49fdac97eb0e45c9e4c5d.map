{"file":"C:\\Users\\Windows\\OneDrive - Seattle Colleges\\Desktop\\YWMESSAGING\\backend\\src\\config\\redis.config.ts","mappings":"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","names":[],"sources":["C:\\Users\\Windows\\OneDrive - Seattle Colleges\\Desktop\\YWMESSAGING\\backend\\src\\config\\redis.config.ts"],"sourcesContent":["import { createClient } from 'redis';\n\nconst redisUrl = process.env.REDIS_URL || 'redis://localhost:6379';\n\nexport const redisClient = createClient({\n  url: redisUrl,\n  // Auto-reconnect configuration to handle connection drops\n  socket: {\n    reconnectStrategy: (retries: number) => {\n      // Reconnect immediately first 3 times, then with exponential backoff\n      if (retries < 3) {\n        return 0; // Retry immediately\n      }\n      const delayMs = Math.min(1000 * Math.pow(2, retries - 3), 30000); // Max 30 seconds\n      console.log(`üîÑ Redis reconnect attempt ${retries}, waiting ${delayMs}ms`);\n      return delayMs;\n    },\n    // Connection timeout and keepalive\n    connectTimeout: 10000,\n    keepAlive: 30000,\n  },\n});\n\nredisClient.on('error', (err: any) => {\n  console.error('‚ùå Redis Client Error:', err.message);\n});\n\nredisClient.on('connect', () => {\n  console.log('‚úÖ Redis connected');\n});\n\nredisClient.on('ready', () => {\n  console.log('‚úÖ Redis ready to use');\n});\n\nredisClient.on('reconnecting', () => {\n  console.log('üîÑ Redis reconnecting...');\n});\n\n// Koinonia to Redis with timeout\nexport async function connectRedis(timeoutMs: number = 10000): Promise<boolean> {\n  if (redisClient.isOpen) {\n    return true; // Already connected\n  }\n\n  return new Promise((resolve) => {\n    let connected = false;\n    const timeout = setTimeout(() => {\n      if (!connected) {\n        console.error('‚ùå Redis connection timeout after', timeoutMs, 'ms');\n        console.error('   Using fallback mode: Token revocation will be less reliable');\n        console.error('   Check REDIS_URL environment variable or Redis service status');\n        resolve(false); // Resolve as failed but don't throw - app can continue\n      }\n    }, timeoutMs);\n\n    redisClient.connect()\n      .then(() => {\n        connected = true;\n        clearTimeout(timeout);\n        console.log('‚úÖ Redis connection established successfully');\n        resolve(true);\n      })\n      .catch((error: any) => {\n        connected = true;\n        clearTimeout(timeout);\n        console.error('‚ùå Redis connection failed:', error.message);\n        console.error('   Using fallback mode: Token revocation disabled');\n        console.error('   Ensure REDIS_URL is set to a valid Redis instance');\n        resolve(false); // Continue without Redis\n      });\n  });\n}\n\nexport async function disconnectRedis() {\n  if (redisClient.isOpen) {\n    try {\n      await redisClient.disconnect();\n      console.log('‚úÖ Redis connection closed gracefully');\n    } catch (error: any) {\n      console.error('‚ö†Ô∏è  Error disconnecting Redis:', error.message);\n    }\n  }\n}\n"],"version":3}