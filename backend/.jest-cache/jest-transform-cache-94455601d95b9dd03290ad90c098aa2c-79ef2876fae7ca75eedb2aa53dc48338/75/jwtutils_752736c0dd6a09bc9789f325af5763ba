96082f9fa841d8063b86aea12efd60a9
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateAccessToken = generateAccessToken;
exports.generateRefreshToken = generateRefreshToken;
exports.verifyAccessToken = verifyAccessToken;
exports.verifyRefreshToken = verifyRefreshToken;
exports.generateMFASessionToken = generateMFASessionToken;
exports.verifyMFASessionToken = verifyMFASessionToken;
exports.decodeToken = decodeToken;
const jsonwebtoken_1 = __importDefault(require("jsonwebtoken"));
const ACCESS_SECRET = process.env.JWT_ACCESS_SECRET || '';
const REFRESH_SECRET = process.env.JWT_REFRESH_SECRET || '';
// Validate secrets are set at startup
if (!ACCESS_SECRET) {
    throw new Error('JWT_ACCESS_SECRET environment variable is required');
}
if (!REFRESH_SECRET) {
    throw new Error('JWT_REFRESH_SECRET environment variable is required');
}
/**
 * Generate access token (short-lived: 15 minutes)
 */
function generateAccessToken(adminId, churchId, role) {
    return jsonwebtoken_1.default.sign({ adminId, churchId, role }, ACCESS_SECRET, { expiresIn: '15m' });
}
/**
 * Generate refresh token (long-lived: 7 days)
 */
function generateRefreshToken(adminId, churchId) {
    return jsonwebtoken_1.default.sign({ adminId, churchId }, REFRESH_SECRET, { expiresIn: '7d' });
}
/**
 * Verify access token
 */
function verifyAccessToken(token) {
    try {
        const payload = jsonwebtoken_1.default.verify(token, ACCESS_SECRET);
        return payload;
    }
    catch (error) {
        return null;
    }
}
/**
 * Verify refresh token
 */
function verifyRefreshToken(token) {
    try {
        const payload = jsonwebtoken_1.default.verify(token, REFRESH_SECRET);
        return payload;
    }
    catch (error) {
        return null;
    }
}
/**
 * Generate MFA session token (very short-lived: 5 minutes)
 * Used during MFA verification step in login flow
 */
function generateMFASessionToken(adminId, churchId) {
    return jsonwebtoken_1.default.sign({ adminId, churchId }, ACCESS_SECRET, // Reuse access secret
    { expiresIn: '5m' });
}
/**
 * Verify MFA session token
 */
function verifyMFASessionToken(token) {
    try {
        const payload = jsonwebtoken_1.default.verify(token, ACCESS_SECRET);
        return payload;
    }
    catch (error) {
        return null;
    }
}
/**
 * Decode token without verification (for debugging)
 */
function decodeToken(token) {
    try {
        return jsonwebtoken_1.default.decode(token);
    }
    catch (error) {
        return null;
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxXaW5kb3dzXFxPbmVEcml2ZSAtIFNlYXR0bGUgQ29sbGVnZXNcXERlc2t0b3BcXFlXTUVTU0FHSU5HXFxiYWNrZW5kXFxzcmNcXHV0aWxzXFxqd3QudXRpbHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFnQ0Esa0RBTUM7QUFLRCxvREFNQztBQUtELDhDQU9DO0FBS0QsZ0RBT0M7QUFNRCwwREFNQztBQUtELHNEQU9DO0FBS0Qsa0NBTUM7QUE1R0QsZ0VBQStCO0FBRS9CLE1BQU0sYUFBYSxHQUFXLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLElBQUksRUFBRSxDQUFDO0FBQ2xFLE1BQU0sY0FBYyxHQUFXLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLElBQUksRUFBRSxDQUFDO0FBRXBFLHNDQUFzQztBQUN0QyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDbkIsTUFBTSxJQUFJLEtBQUssQ0FBQyxvREFBb0QsQ0FBQyxDQUFDO0FBQ3hFLENBQUM7QUFDRCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDcEIsTUFBTSxJQUFJLEtBQUssQ0FBQyxxREFBcUQsQ0FBQyxDQUFDO0FBQ3pFLENBQUM7QUFrQkQ7O0dBRUc7QUFDSCxTQUFnQixtQkFBbUIsQ0FBQyxPQUFlLEVBQUUsUUFBZ0IsRUFBRSxJQUFZO0lBQ2pGLE9BQU8sc0JBQUcsQ0FBQyxJQUFJLENBQ2IsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxFQUMzQixhQUFhLEVBQ2IsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLENBQ3JCLENBQUM7QUFDSixDQUFDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixvQkFBb0IsQ0FBQyxPQUFlLEVBQUUsUUFBZ0I7SUFDcEUsT0FBTyxzQkFBRyxDQUFDLElBQUksQ0FDYixFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsRUFDckIsY0FBYyxFQUNkLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUNwQixDQUFDO0FBQ0osQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsaUJBQWlCLENBQUMsS0FBYTtJQUM3QyxJQUFJLENBQUM7UUFDSCxNQUFNLE9BQU8sR0FBRyxzQkFBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsYUFBYSxDQUFZLENBQUM7UUFDNUQsT0FBTyxPQUE2QixDQUFDO0lBQ3ZDLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0FBQ0gsQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0Isa0JBQWtCLENBQUMsS0FBYTtJQUM5QyxJQUFJLENBQUM7UUFDSCxNQUFNLE9BQU8sR0FBRyxzQkFBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsY0FBYyxDQUFZLENBQUM7UUFDN0QsT0FBTyxPQUE4QixDQUFDO0lBQ3hDLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0FBQ0gsQ0FBQztBQUVEOzs7R0FHRztBQUNILFNBQWdCLHVCQUF1QixDQUFDLE9BQWUsRUFBRSxRQUFnQjtJQUN2RSxPQUFPLHNCQUFHLENBQUMsSUFBSSxDQUNiLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxFQUNyQixhQUFhLEVBQUUsc0JBQXNCO0lBQ3JDLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUNwQixDQUFDO0FBQ0osQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IscUJBQXFCLENBQUMsS0FBYTtJQUNqRCxJQUFJLENBQUM7UUFDSCxNQUFNLE9BQU8sR0FBRyxzQkFBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsYUFBYSxDQUFZLENBQUM7UUFDNUQsT0FBTyxPQUFpQyxDQUFDO0lBQzNDLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0FBQ0gsQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsV0FBVyxDQUFDLEtBQWE7SUFDdkMsSUFBSSxDQUFDO1FBQ0gsT0FBTyxzQkFBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMzQixDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNmLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztBQUNILENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxXaW5kb3dzXFxPbmVEcml2ZSAtIFNlYXR0bGUgQ29sbGVnZXNcXERlc2t0b3BcXFlXTUVTU0FHSU5HXFxiYWNrZW5kXFxzcmNcXHV0aWxzXFxqd3QudXRpbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGp3dCBmcm9tICdqc29ud2VidG9rZW4nO1xuXG5jb25zdCBBQ0NFU1NfU0VDUkVUOiBzdHJpbmcgPSBwcm9jZXNzLmVudi5KV1RfQUNDRVNTX1NFQ1JFVCB8fCAnJztcbmNvbnN0IFJFRlJFU0hfU0VDUkVUOiBzdHJpbmcgPSBwcm9jZXNzLmVudi5KV1RfUkVGUkVTSF9TRUNSRVQgfHwgJyc7XG5cbi8vIFZhbGlkYXRlIHNlY3JldHMgYXJlIHNldCBhdCBzdGFydHVwXG5pZiAoIUFDQ0VTU19TRUNSRVQpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdKV1RfQUNDRVNTX1NFQ1JFVCBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyByZXF1aXJlZCcpO1xufVxuaWYgKCFSRUZSRVNIX1NFQ1JFVCkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ0pXVF9SRUZSRVNIX1NFQ1JFVCBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyByZXF1aXJlZCcpO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFjY2Vzc1Rva2VuUGF5bG9hZCB7XG4gIGFkbWluSWQ6IHN0cmluZztcbiAgY2h1cmNoSWQ6IHN0cmluZztcbiAgcm9sZTogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJlZnJlc2hUb2tlblBheWxvYWQge1xuICBhZG1pbklkOiBzdHJpbmc7XG4gIGNodXJjaElkOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTUZBU2Vzc2lvblRva2VuUGF5bG9hZCB7XG4gIGFkbWluSWQ6IHN0cmluZztcbiAgY2h1cmNoSWQ6IHN0cmluZztcbn1cblxuLyoqXG4gKiBHZW5lcmF0ZSBhY2Nlc3MgdG9rZW4gKHNob3J0LWxpdmVkOiAxNSBtaW51dGVzKVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVBY2Nlc3NUb2tlbihhZG1pbklkOiBzdHJpbmcsIGNodXJjaElkOiBzdHJpbmcsIHJvbGU6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBqd3Quc2lnbihcbiAgICB7IGFkbWluSWQsIGNodXJjaElkLCByb2xlIH0sXG4gICAgQUNDRVNTX1NFQ1JFVCxcbiAgICB7IGV4cGlyZXNJbjogJzE1bScgfVxuICApO1xufVxuXG4vKipcbiAqIEdlbmVyYXRlIHJlZnJlc2ggdG9rZW4gKGxvbmctbGl2ZWQ6IDcgZGF5cylcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlUmVmcmVzaFRva2VuKGFkbWluSWQ6IHN0cmluZywgY2h1cmNoSWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBqd3Quc2lnbihcbiAgICB7IGFkbWluSWQsIGNodXJjaElkIH0sXG4gICAgUkVGUkVTSF9TRUNSRVQsXG4gICAgeyBleHBpcmVzSW46ICc3ZCcgfVxuICApO1xufVxuXG4vKipcbiAqIFZlcmlmeSBhY2Nlc3MgdG9rZW5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZlcmlmeUFjY2Vzc1Rva2VuKHRva2VuOiBzdHJpbmcpOiBBY2Nlc3NUb2tlblBheWxvYWQgfCBudWxsIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYXlsb2FkID0gand0LnZlcmlmeSh0b2tlbiwgQUNDRVNTX1NFQ1JFVCkgYXMgdW5rbm93bjtcbiAgICByZXR1cm4gcGF5bG9hZCBhcyBBY2Nlc3NUb2tlblBheWxvYWQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLyoqXG4gKiBWZXJpZnkgcmVmcmVzaCB0b2tlblxuICovXG5leHBvcnQgZnVuY3Rpb24gdmVyaWZ5UmVmcmVzaFRva2VuKHRva2VuOiBzdHJpbmcpOiBSZWZyZXNoVG9rZW5QYXlsb2FkIHwgbnVsbCB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGF5bG9hZCA9IGp3dC52ZXJpZnkodG9rZW4sIFJFRlJFU0hfU0VDUkVUKSBhcyB1bmtub3duO1xuICAgIHJldHVybiBwYXlsb2FkIGFzIFJlZnJlc2hUb2tlblBheWxvYWQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLyoqXG4gKiBHZW5lcmF0ZSBNRkEgc2Vzc2lvbiB0b2tlbiAodmVyeSBzaG9ydC1saXZlZDogNSBtaW51dGVzKVxuICogVXNlZCBkdXJpbmcgTUZBIHZlcmlmaWNhdGlvbiBzdGVwIGluIGxvZ2luIGZsb3dcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlTUZBU2Vzc2lvblRva2VuKGFkbWluSWQ6IHN0cmluZywgY2h1cmNoSWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBqd3Quc2lnbihcbiAgICB7IGFkbWluSWQsIGNodXJjaElkIH0sXG4gICAgQUNDRVNTX1NFQ1JFVCwgLy8gUmV1c2UgYWNjZXNzIHNlY3JldFxuICAgIHsgZXhwaXJlc0luOiAnNW0nIH1cbiAgKTtcbn1cblxuLyoqXG4gKiBWZXJpZnkgTUZBIHNlc3Npb24gdG9rZW5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZlcmlmeU1GQVNlc3Npb25Ub2tlbih0b2tlbjogc3RyaW5nKTogTUZBU2Vzc2lvblRva2VuUGF5bG9hZCB8IG51bGwge1xuICB0cnkge1xuICAgIGNvbnN0IHBheWxvYWQgPSBqd3QudmVyaWZ5KHRva2VuLCBBQ0NFU1NfU0VDUkVUKSBhcyB1bmtub3duO1xuICAgIHJldHVybiBwYXlsb2FkIGFzIE1GQVNlc3Npb25Ub2tlblBheWxvYWQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLyoqXG4gKiBEZWNvZGUgdG9rZW4gd2l0aG91dCB2ZXJpZmljYXRpb24gKGZvciBkZWJ1Z2dpbmcpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWNvZGVUb2tlbih0b2tlbjogc3RyaW5nKTogYW55IHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gand0LmRlY29kZSh0b2tlbik7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==