import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useEffect, useState } from 'react';
import toast from 'react-hot-toast';
import { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, } from 'recharts';
import BackButton from '../../components/BackButton';
import { getMessageStats, getBranchStats, getSummaryStats, } from '../../api/analytics';
import Card from '../../components/ui/Card';
import { themeColors } from '../../utils/themeColors';
import { Spinner } from '../../components/ui';
export function AnalyticsPage() {
    const [messageStats, setMessageStats] = useState(null);
    const [branchStats, setBranchStats] = useState([]);
    const [summaryStats, setSummaryStats] = useState(null);
    const [isLoading, setIsLoading] = useState(true);
    const [days, setDays] = useState(30);
    useEffect(() => {
        loadAnalytics();
    }, [days]);
    const loadAnalytics = async () => {
        try {
            setIsLoading(true);
            const [msgStats, branchData, summaryData] = await Promise.all([
                getMessageStats({ days }),
                getBranchStats(),
                getSummaryStats(),
            ]);
            setMessageStats(msgStats);
            setBranchStats(branchData);
            setSummaryStats(summaryData);
        }
        catch (error) {
            toast.error(error.message || 'Failed to load analytics');
        }
        finally {
            setIsLoading(false);
        }
    };
    return (_jsx("div", { className: "min-h-screen bg-background p-6 transition-colors duration-normal", children: _jsxs("div", { className: "max-w-7xl mx-auto", children: [_jsx("div", { className: "mb-6", children: _jsx(BackButton, { variant: "ghost" }) }), _jsxs("div", { className: "flex justify-between items-center mb-8", children: [_jsxs("div", { children: [_jsx("h1", { className: "text-4xl font-bold text-foreground mb-2", children: "\uD83D\uDCCA Analytics" }), _jsx("p", { className: "text-foreground/80", children: "Track your messaging performance and engagement" })] }), _jsxs("select", { value: days, onChange: (e) => setDays(parseInt(e.target.value)), className: "px-4 py-2 border border-border rounded-lg bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors duration-normal", children: [_jsx("option", { value: 7, children: "Last 7 days" }), _jsx("option", { value: 30, children: "Last 30 days" }), _jsx("option", { value: 90, children: "Last 90 days" })] })] }), isLoading ? (_jsx("div", { className: "flex items-center justify-center py-20", children: _jsx(Spinner, { size: "lg", text: "Loading analytics..." }) })) : (_jsxs("div", { className: "space-y-8", children: [summaryStats && (_jsxs("div", { className: "grid grid-cols-1 md:grid-cols-5 gap-4", children: [_jsxs(Card, { variant: "default", className: "text-center bg-muted border-border", children: [_jsx("p", { className: "text-muted-foreground text-sm mb-2", children: "\uD83D\uDCE8 Total Messages" }), _jsx("p", { className: "text-3xl font-bold text-accent-400", children: summaryStats.totalMessages })] }), _jsxs(Card, { variant: "default", className: "text-center bg-slate-900/50 border-slate-700", children: [_jsx("p", { className: "text-muted-foreground text-sm mb-2", children: "\u2705 Delivery Rate" }), _jsxs("p", { className: "text-3xl font-bold text-green-400", children: [summaryStats.averageDeliveryRate, "%"] })] }), _jsxs(Card, { variant: "default", className: "text-center bg-slate-900/50 border-slate-700", children: [_jsx("p", { className: "text-muted-foreground text-sm mb-2", children: "\uD83D\uDC64 Total Members" }), _jsx("p", { className: "text-3xl font-bold text-blue-400", children: summaryStats.totalMembers })] }), _jsxs(Card, { variant: "default", className: "text-center bg-slate-900/50 border-slate-700", children: [_jsx("p", { className: "text-muted-foreground text-sm mb-2", children: "\uD83D\uDCCD Branches" }), _jsx("p", { className: "text-3xl font-bold text-yellow-400", children: summaryStats.totalBranches })] }), _jsxs(Card, { variant: "default", className: "text-center bg-slate-900/50 border-slate-700", children: [_jsx("p", { className: "text-muted-foreground text-sm mb-2", children: "\uD83D\uDC65 Total Groups" }), _jsx("p", { className: "text-3xl font-bold text-red-400", children: summaryStats.totalGroups })] })] })), messageStats && messageStats.byDay.length > 0 && (_jsxs(Card, { variant: "default", className: "bg-muted border-border", children: [_jsx("h2", { className: "text-lg font-semibold text-foreground mb-4", children: "\uD83D\uDCC8 Message Volume" }), _jsx(ResponsiveContainer, { width: "100%", height: 300, children: _jsxs(LineChart, { data: messageStats.byDay, children: [_jsx(CartesianGrid, { strokeDasharray: "3 3", stroke: themeColors.border.dark }), _jsx(XAxis, { dataKey: "date", tick: { fontSize: 12 }, angle: -45, textAnchor: "end", height: 80 }), _jsx(YAxis, {}), _jsx(Tooltip, { contentStyle: { backgroundColor: '#1f2937', border: '1px solid #374151', borderRadius: '8px', color: '#fff' } }), _jsx(Legend, {}), _jsx(Line, { type: "monotone", dataKey: "count", stroke: "#3b82f6", name: "Messages Sent" }), _jsx(Line, { type: "monotone", dataKey: "delivered", stroke: "#10b981", name: "Delivered" }), _jsx(Line, { type: "monotone", dataKey: "failed", stroke: "#ef4444", name: "Failed" })] }) })] })), branchStats.length > 0 && (_jsxs(Card, { variant: "default", className: "bg-muted border-border", children: [_jsx("h2", { className: "text-lg font-semibold text-foreground mb-4", children: "\uD83D\uDCCA Branch Comparison" }), _jsx(ResponsiveContainer, { width: "100%", height: 300, children: _jsxs(BarChart, { data: branchStats, children: [_jsx(CartesianGrid, { strokeDasharray: "3 3", stroke: themeColors.border.dark }), _jsx(XAxis, { dataKey: "name", tick: { fontSize: 12 }, angle: -45, textAnchor: "end", height: 80 }), _jsx(YAxis, { yAxisId: "left" }), _jsx(YAxis, { yAxisId: "right", orientation: "right" }), _jsx(Tooltip, { contentStyle: { backgroundColor: '#1f2937', border: '1px solid #374151', borderRadius: '8px', color: '#fff' } }), _jsx(Legend, {}), _jsx(Bar, { yAxisId: "left", dataKey: "messageCount", fill: "#3b82f6", name: "Messages Sent" }), _jsx(Bar, { yAxisId: "right", dataKey: "deliveryRate", fill: "#10b981", name: "Delivery Rate (%)" })] }) })] })), branchStats.length > 0 && (_jsxs(Card, { variant: "default", className: "overflow-hidden bg-muted border-border", children: [_jsx("h2", { className: "text-lg font-semibold text-foreground mb-4", children: "\uD83D\uDCCB Branch Details" }), _jsx("div", { className: "overflow-x-auto", children: _jsxs("table", { className: "min-w-full", children: [_jsx("thead", { className: "bg-muted border-b border-border", children: _jsxs("tr", { children: [_jsx("th", { className: "px-6 py-3 text-left text-sm font-semibold text-foreground", children: "Branch" }), _jsx("th", { className: "px-6 py-3 text-left text-sm font-semibold text-foreground", children: "Members" }), _jsx("th", { className: "px-6 py-3 text-left text-sm font-semibold text-foreground", children: "Groups" }), _jsx("th", { className: "px-6 py-3 text-left text-sm font-semibold text-foreground", children: "Messages" }), _jsx("th", { className: "px-6 py-3 text-left text-sm font-semibold text-foreground", children: "Delivery Rate" })] }) }), _jsx("tbody", { className: "divide-y divide-border", children: branchStats.map((branch) => (_jsxs("tr", { className: "hover:bg-muted/50 transition-colors duration-normal", children: [_jsx("td", { className: "px-6 py-4 text-sm font-medium text-foreground", children: branch.name }), _jsx("td", { className: "px-6 py-4 text-sm text-foreground/80", children: branch.memberCount }), _jsx("td", { className: "px-6 py-4 text-sm text-foreground/80", children: branch.groupCount }), _jsx("td", { className: "px-6 py-4 text-sm text-foreground/80", children: branch.messageCount }), _jsx("td", { className: "px-6 py-4 text-sm", children: _jsxs("div", { className: "flex items-center gap-2", children: [_jsx("div", { className: "w-32 bg-muted rounded-full h-2", children: _jsx("div", { className: "bg-green-500 h-2 rounded-full", style: {
                                                                                width: `${branch.deliveryRate}%`,
                                                                            } }) }), _jsxs("span", { className: "font-medium text-foreground", children: [branch.deliveryRate, "%"] })] }) })] }, branch.id))) })] }) })] })), messageStats && (_jsxs(Card, { variant: "default", className: "bg-muted border-border", children: [_jsx("h2", { className: "text-lg font-semibold text-foreground mb-4", children: "\uD83D\uDCAC Message Statistics" }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-4 gap-4", children: [_jsxs("div", { children: [_jsx("p", { className: "text-muted-foreground text-sm mb-1", children: "Total Messages" }), _jsx("p", { className: "text-2xl font-bold text-primary", children: messageStats.totalMessages })] }), _jsxs("div", { children: [_jsx("p", { className: "text-muted-foreground text-sm mb-1", children: "Delivered" }), _jsx("p", { className: "text-2xl font-bold text-green-400", children: messageStats.deliveredCount })] }), _jsxs("div", { children: [_jsx("p", { className: "text-muted-foreground text-sm mb-1", children: "Failed" }), _jsx("p", { className: "text-2xl font-bold text-red-400", children: messageStats.failedCount })] }), _jsxs("div", { children: [_jsx("p", { className: "text-muted-foreground text-sm mb-1", children: "Pending" }), _jsx("p", { className: "text-2xl font-bold text-yellow-400", children: messageStats.pendingCount })] })] })] }))] }))] }) }));
}
export default AnalyticsPage;
//# sourceMappingURL=AnalyticsPage.js.map