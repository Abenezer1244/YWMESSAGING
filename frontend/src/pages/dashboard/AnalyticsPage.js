import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useEffect, useState } from 'react';
import toast from 'react-hot-toast';
import { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, } from 'recharts';
import { getMessageStats, getBranchStats, getSummaryStats, } from '../../api/analytics';
export function AnalyticsPage() {
    const [messageStats, setMessageStats] = useState(null);
    const [branchStats, setBranchStats] = useState([]);
    const [summaryStats, setSummaryStats] = useState(null);
    const [isLoading, setIsLoading] = useState(true);
    const [days, setDays] = useState(30);
    useEffect(() => {
        loadAnalytics();
    }, [days]);
    const loadAnalytics = async () => {
        try {
            setIsLoading(true);
            const [msgStats, branchData, summaryData] = await Promise.all([
                getMessageStats({ days }),
                getBranchStats(),
                getSummaryStats(),
            ]);
            setMessageStats(msgStats);
            setBranchStats(branchData);
            setSummaryStats(summaryData);
        }
        catch (error) {
            toast.error(error.message || 'Failed to load analytics');
        }
        finally {
            setIsLoading(false);
        }
    };
    return (_jsxs("div", { className: "min-h-screen bg-gray-50", children: [_jsx("div", { className: "bg-white shadow", children: _jsx("div", { className: "max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4", children: _jsxs("div", { className: "flex justify-between items-center", children: [_jsx("h1", { className: "text-3xl font-bold text-gray-900", children: "Analytics" }), _jsxs("select", { value: days, onChange: (e) => setDays(parseInt(e.target.value)), className: "px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500", children: [_jsx("option", { value: 7, children: "Last 7 days" }), _jsx("option", { value: 30, children: "Last 30 days" }), _jsx("option", { value: 90, children: "Last 90 days" })] })] }) }) }), _jsx("main", { className: "max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8", children: isLoading ? (_jsx("div", { className: "text-center py-12", children: _jsx("p", { className: "text-gray-500", children: "Loading analytics..." }) })) : (_jsxs("div", { className: "space-y-8", children: [summaryStats && (_jsxs("div", { className: "grid grid-cols-1 md:grid-cols-5 gap-4", children: [_jsxs("div", { className: "bg-white rounded-lg shadow p-6", children: [_jsx("p", { className: "text-gray-600 text-sm", children: "Total Messages" }), _jsx("p", { className: "text-3xl font-bold text-blue-600 mt-2", children: summaryStats.totalMessages })] }), _jsxs("div", { className: "bg-white rounded-lg shadow p-6", children: [_jsx("p", { className: "text-gray-600 text-sm", children: "Avg Delivery Rate" }), _jsxs("p", { className: "text-3xl font-bold text-green-600 mt-2", children: [summaryStats.averageDeliveryRate, "%"] })] }), _jsxs("div", { className: "bg-white rounded-lg shadow p-6", children: [_jsx("p", { className: "text-gray-600 text-sm", children: "Total Members" }), _jsx("p", { className: "text-3xl font-bold text-purple-600 mt-2", children: summaryStats.totalMembers })] }), _jsxs("div", { className: "bg-white rounded-lg shadow p-6", children: [_jsx("p", { className: "text-gray-600 text-sm", children: "Total Branches" }), _jsx("p", { className: "text-3xl font-bold text-orange-600 mt-2", children: summaryStats.totalBranches })] }), _jsxs("div", { className: "bg-white rounded-lg shadow p-6", children: [_jsx("p", { className: "text-gray-600 text-sm", children: "Total Groups" }), _jsx("p", { className: "text-3xl font-bold text-pink-600 mt-2", children: summaryStats.totalGroups })] })] })), messageStats && messageStats.byDay.length > 0 && (_jsxs("div", { className: "bg-white rounded-lg shadow p-6", children: [_jsx("h2", { className: "text-lg font-semibold text-gray-900 mb-4", children: "Message Volume" }), _jsx(ResponsiveContainer, { width: "100%", height: 300, children: _jsxs(LineChart, { data: messageStats.byDay, children: [_jsx(CartesianGrid, { strokeDasharray: "3 3" }), _jsx(XAxis, { dataKey: "date", tick: { fontSize: 12 }, angle: -45, textAnchor: "end", height: 80 }), _jsx(YAxis, {}), _jsx(Tooltip, {}), _jsx(Legend, {}), _jsx(Line, { type: "monotone", dataKey: "count", stroke: "#3b82f6", name: "Messages Sent" }), _jsx(Line, { type: "monotone", dataKey: "delivered", stroke: "#10b981", name: "Delivered" }), _jsx(Line, { type: "monotone", dataKey: "failed", stroke: "#ef4444", name: "Failed" })] }) })] })), branchStats.length > 0 && (_jsxs("div", { className: "bg-white rounded-lg shadow p-6", children: [_jsx("h2", { className: "text-lg font-semibold text-gray-900 mb-4", children: "Branch Comparison" }), _jsx(ResponsiveContainer, { width: "100%", height: 300, children: _jsxs(BarChart, { data: branchStats, children: [_jsx(CartesianGrid, { strokeDasharray: "3 3" }), _jsx(XAxis, { dataKey: "name", tick: { fontSize: 12 }, angle: -45, textAnchor: "end", height: 80 }), _jsx(YAxis, { yAxisId: "left" }), _jsx(YAxis, { yAxisId: "right", orientation: "right" }), _jsx(Tooltip, {}), _jsx(Legend, {}), _jsx(Bar, { yAxisId: "left", dataKey: "messageCount", fill: "#3b82f6", name: "Messages Sent" }), _jsx(Bar, { yAxisId: "right", dataKey: "deliveryRate", fill: "#10b981", name: "Delivery Rate (%)" })] }) })] })), branchStats.length > 0 && (_jsxs("div", { className: "bg-white rounded-lg shadow overflow-hidden", children: [_jsx("div", { className: "px-6 py-4 border-b", children: _jsx("h2", { className: "text-lg font-semibold text-gray-900", children: "Branch Details" }) }), _jsx("div", { className: "overflow-x-auto", children: _jsxs("table", { className: "min-w-full", children: [_jsx("thead", { className: "bg-gray-50 border-b", children: _jsxs("tr", { children: [_jsx("th", { className: "px-6 py-3 text-left text-sm font-semibold text-gray-900", children: "Branch" }), _jsx("th", { className: "px-6 py-3 text-left text-sm font-semibold text-gray-900", children: "Members" }), _jsx("th", { className: "px-6 py-3 text-left text-sm font-semibold text-gray-900", children: "Groups" }), _jsx("th", { className: "px-6 py-3 text-left text-sm font-semibold text-gray-900", children: "Messages" }), _jsx("th", { className: "px-6 py-3 text-left text-sm font-semibold text-gray-900", children: "Delivery Rate" })] }) }), _jsx("tbody", { className: "divide-y", children: branchStats.map((branch) => (_jsxs("tr", { className: "hover:bg-gray-50", children: [_jsx("td", { className: "px-6 py-4 text-sm font-medium text-gray-900", children: branch.name }), _jsx("td", { className: "px-6 py-4 text-sm text-gray-600", children: branch.memberCount }), _jsx("td", { className: "px-6 py-4 text-sm text-gray-600", children: branch.groupCount }), _jsx("td", { className: "px-6 py-4 text-sm text-gray-600", children: branch.messageCount }), _jsx("td", { className: "px-6 py-4 text-sm", children: _jsxs("div", { className: "flex items-center gap-2", children: [_jsx("div", { className: "w-32 bg-gray-200 rounded-full h-2", children: _jsx("div", { className: "bg-green-500 h-2 rounded-full", style: {
                                                                                width: `${branch.deliveryRate}%`,
                                                                            } }) }), _jsxs("span", { className: "font-medium text-gray-900", children: [branch.deliveryRate, "%"] })] }) })] }, branch.id))) })] }) })] })), messageStats && (_jsxs("div", { className: "bg-white rounded-lg shadow p-6", children: [_jsx("h2", { className: "text-lg font-semibold text-gray-900 mb-4", children: "Message Statistics" }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-4 gap-4", children: [_jsxs("div", { children: [_jsx("p", { className: "text-gray-600 text-sm", children: "Total Messages" }), _jsx("p", { className: "text-2xl font-bold text-blue-600 mt-1", children: messageStats.totalMessages })] }), _jsxs("div", { children: [_jsx("p", { className: "text-gray-600 text-sm", children: "Delivered" }), _jsx("p", { className: "text-2xl font-bold text-green-600 mt-1", children: messageStats.deliveredCount })] }), _jsxs("div", { children: [_jsx("p", { className: "text-gray-600 text-sm", children: "Failed" }), _jsx("p", { className: "text-2xl font-bold text-red-600 mt-1", children: messageStats.failedCount })] }), _jsxs("div", { children: [_jsx("p", { className: "text-gray-600 text-sm", children: "Pending" }), _jsx("p", { className: "text-2xl font-bold text-yellow-600 mt-1", children: messageStats.pendingCount })] })] })] }))] })) })] }));
}
export default AnalyticsPage;
//# sourceMappingURL=AnalyticsPage.js.map