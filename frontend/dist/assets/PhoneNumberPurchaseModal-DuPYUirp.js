import{c as P,r as m,j as e,B as j,_ as p}from"./index-BXA5Nr36.js";import{u as B,a as T,C as M,E as W,l as X}from"./index-BLH4VJGT.js";import{c as q,A as U,X as Y}from"./index-CER3tAvT.js";import{m as u}from"./proxy-Bk6Bu19j.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],E=q("phone",G);async function H(r){const a=new URLSearchParams;return r.areaCode&&a.append("areaCode",r.areaCode),r.state&&a.append("state",r.state),r.contains&&a.append("contains",r.contains),r.quantity&&a.append("quantity",r.quantity.toString()),(await P.get(`/numbers/search?${a.toString()}`)).data.data}async function V(r){return(await P.post("/numbers/setup-payment-intent",{phoneNumber:r})).data}async function Q(r,a){return(await P.post("/numbers/confirm-payment",{paymentIntentId:r,paymentMethodId:a})).data}async function Z(r,a,x){return(await P.post("/numbers/purchase",{phoneNumber:r,paymentIntentId:a,connectionId:x})).data}async function oe(){return(await P.get("/numbers/current")).data.data}const J={style:{base:{fontSize:"14px",color:"var(--foreground)","::placeholder":{color:"var(--muted-foreground)"},fontFamily:"system-ui, -apple-system, sans-serif"},invalid:{color:"#ff4444"}}};function K({amount:r,phoneNumber:a,paymentIntentId:x,onSuccess:d,onError:l,isLoading:f=!1,paymentStatus:c="idle",paymentMessage:b=""}){const g=B(),C=T(),[h,t]=m.useState(!1),y=async i=>{if(i.preventDefault(),!g||!C){p.error("Payment system not initialized");return}t(!0);try{const n=C.getElement(M);if(!n)throw new Error("Card element not found");const{error:o,paymentMethod:w}=await g.createPaymentMethod({type:"card",card:n,billing_details:{}});if(o){console.error("Payment method creation failed:",o),p.error(o.message||"Failed to process card"),l?.(o.message||"Failed to process card"),t(!1);return}if(!w)throw new Error("No payment method returned");d(w.id)}catch(n){console.error("Payment form error:",n);const o=n.message||"Payment processing failed";p.error(o),l?.(o)}finally{t(!1)}};return e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-foreground mb-2",children:["Payment for ",a]}),e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["$",(r/100).toFixed(2)]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"One-time setup fee"})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Card Details"}),e.jsx("div",{className:"p-3 border border-border rounded-lg bg-muted",children:e.jsx(M,{options:J})})]})}),c!=="idle"&&e.jsxs("div",{className:`p-4 rounded-lg border text-center ${c==="success"?"bg-green-500/10 border-green-500/20 text-green-700":c==="declined"||c==="failed"?"bg-red-500/10 border-red-500/20 text-red-700":"bg-blue-500/10 border-blue-500/20 text-blue-700"}`,children:[c==="success"&&"âœ“ Payment Successful",c==="declined"&&"âœ— Card Declined",c==="failed"&&"âœ— Payment Failed",c==="processing"&&"â³ Processing...",b&&e.jsx("div",{className:"text-sm mt-1",children:b})]}),e.jsx("div",{className:"text-xs text-muted-foreground bg-blue-500/10 border border-blue-500/20 rounded-lg p-3",children:"ðŸ”’ Payment is processed securely by Stripe. Your card details are encrypted and never stored on our servers."}),e.jsx("div",{className:"space-y-2",children:e.jsx(j,{type:"submit",variant:"primary",fullWidth:!0,size:"lg",disabled:!g||h||f,isLoading:h||f,className:"bg-primary hover:bg-primary/90 text-background font-medium",children:h?"Processing...":"Complete Purchase"})})]})}const ee=[{code:"CA",name:"California"},{code:"NY",name:"New York"},{code:"TX",name:"Texas"},{code:"FL",name:"Florida"},{code:"IL",name:"Illinois"},{code:"PA",name:"Pennsylvania"},{code:"OH",name:"Ohio"},{code:"GA",name:"Georgia"},{code:"MI",name:"Michigan"},{code:"NC",name:"North Carolina"}],se=X("pk_live_51SNi09E7LiXbMhWDr4X7EtXptIiMS3xAZgkdIfdjgf18XMQpSpt2OY47nmuv7hGSMCehvRDLawh9bDSsLto5D0jS00A7xoe8Ut");function ie({isOpen:r,onClose:a,onPurchaseComplete:x}){const[d,l]=m.useState("search"),[f,c]=m.useState(""),[b,g]=m.useState(""),[C,h]=m.useState([]),[t,y]=m.useState(null),[i,n]=m.useState(!1),[o,w]=m.useState(null),[F,v]=m.useState("idle"),[A,N]=m.useState(""),D=async()=>{if(!f&&!b){p.error("Please enter an area code or select a state");return}n(!0);try{const s=await H({areaCode:f||void 0,state:b||void 0,quantity:10});s.length===0?(p.error("No numbers found for that search"),h([])):(h(s),l("select"))}catch(s){console.error("Search failed:",s),p.error(s.message||"Failed to search numbers")}finally{n(!1)}},L=async s=>{y(s),l("confirm")},z=async()=>{if(t){n(!0);try{const s=await V(t.phoneNumber);if(!s.success||!s.data?.paymentIntentId)throw new Error("Failed to create payment intent");w(s.data.paymentIntentId),l("payment")}catch(s){console.error("Payment intent creation failed:",s),p.error(s.message||"Failed to create payment intent")}finally{n(!1)}}},$=async s=>{if(!(!t||!o)){n(!0),v("processing"),N("");try{const S=await Q(o,s);if(!S.success||S.data?.status!=="succeeded"){v("failed"),N("Payment confirmation failed. Please try again."),n(!1);return}(await Z(t.phoneNumber,o)).success&&(v("success"),N(""),setTimeout(()=>{p.success(`Successfully purchased ${t.formattedNumber}!`),x&&x(t.phoneNumber),O(),a()},1500))}catch(S){console.error("Purchase failed:",S);const I=S.message||"Failed to process payment",_=I.toLowerCase().includes("declined")||I.toLowerCase().includes("insufficient");v(_?"declined":"failed"),N(I),n(!1)}}},O=()=>{l("search"),c(""),g(""),h([]),y(null),w(null),v("idle"),N("")},R={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.1}}},k={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{duration:.3,type:"tween"}}};return e.jsx(U,{children:r&&e.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4 backdrop-blur-md",children:e.jsxs(u.div,{initial:{opacity:0,scale:.92,y:30},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.92,y:30},transition:{duration:.4,ease:"easeOut"},className:"bg-background border border-border/50 rounded-2xl shadow-2xl max-w-2xl w-full overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-primary/5 border-b border-border/30 p-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/20 rounded-lg",children:e.jsx(E,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Buy Phone Number"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d==="search"&&"Search available numbers",d==="select"&&"Choose a number",d==="confirm"&&"Confirm purchase",d==="payment"&&"Complete payment"]})]})]}),e.jsx(u.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:a,disabled:i,className:"p-2 hover:bg-muted rounded-lg transition-colors disabled:opacity-50",children:e.jsx(Y,{className:"w-5 h-5 text-muted-foreground"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs(u.div,{variants:R,initial:"hidden",animate:"visible",children:[d==="search"&&e.jsxs(u.div,{variants:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Area Code"}),e.jsx("input",{type:"text",placeholder:"e.g., 415, 212, 310",value:f,onChange:s=>c(s.target.value),maxLength:3,className:"w-full px-3 py-2 border border-border/50 rounded-lg bg-background text-foreground placeholder-muted-foreground focus:border-primary focus:outline-none transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"State (Optional)"}),e.jsxs("select",{value:b,onChange:s=>g(s.target.value),className:"w-full px-3 py-2 border border-border/50 rounded-lg bg-background text-foreground focus:border-primary focus:outline-none transition-colors appearance-none",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 9L1 4h10z'/%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",paddingRight:"2rem"},children:[e.jsx("option",{value:"",children:"Select a state..."}),ee.map(s=>e.jsx("option",{value:s.code,children:s.name},s.code))]})]}),e.jsx(j,{variant:"primary",fullWidth:!0,size:"lg",onClick:D,disabled:i,isLoading:i,className:"bg-primary hover:bg-primary/90 text-background font-medium mt-6",children:i?"Searching...":"Search Numbers"})]}),d==="select"&&e.jsxs(u.div,{variants:k,className:"space-y-3",children:[e.jsx("div",{className:"space-y-2 max-h-72 overflow-y-auto",children:C.map(s=>e.jsx(u.button,{whileHover:{scale:1.02},onClick:()=>L(s),className:"w-full p-4 border-2 border-border/30 rounded-lg bg-muted/20 hover:border-primary/50 hover:bg-primary/5 transition-all text-left group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-foreground text-lg",children:s.formattedNumber}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s.region})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-foreground",children:["$",s.costPerSms.toFixed(4),"/SMS"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["$",s.costPerMinute.toFixed(4),"/min"]})]})]})},s.id))}),e.jsx(j,{variant:"secondary",fullWidth:!0,size:"sm",onClick:()=>{l("search"),h([]),y(null)},className:"mt-4",children:"Back to Search"})]}),d==="confirm"&&t&&e.jsxs(u.div,{variants:k,className:"space-y-4",children:[e.jsx("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(E,{className:"w-8 h-8 text-primary mx-auto mb-3"}),e.jsx("div",{className:"text-2xl font-bold text-foreground mb-1",children:t.formattedNumber}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.region})]})}),e.jsxs("div",{className:"space-y-2 bg-muted/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Per SMS:"}),e.jsxs("span",{className:"font-medium text-foreground",children:["$",t.costPerSms.toFixed(4)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Per minute:"}),e.jsxs("span",{className:"font-medium text-foreground",children:["$",t.costPerMinute.toFixed(4)]})]}),e.jsxs("div",{className:"border-t border-border/30 pt-2 mt-2 flex justify-between font-semibold",children:[e.jsx("span",{className:"text-foreground",children:"One-time setup:"}),e.jsx("span",{className:"text-primary",children:"$4.99"})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:"By purchasing, you agree to Telnyx's terms and will be charged the one-time setup fee. Usage charges apply separately."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{variant:"primary",fullWidth:!0,size:"lg",onClick:z,disabled:i,isLoading:i,className:"bg-primary hover:bg-primary/90 text-background font-medium",children:i?"Processing...":"Continue to Payment"}),e.jsx(j,{variant:"secondary",fullWidth:!0,size:"sm",onClick:()=>{l("select"),y(null)},disabled:i,children:"Choose Different Number"})]})]}),d==="payment"&&t&&o&&e.jsxs(u.div,{variants:k,className:"space-y-4",children:[e.jsx(W,{stripe:se,children:e.jsx(K,{amount:499,phoneNumber:t.phoneNumber,paymentIntentId:o,onSuccess:$,isLoading:i,paymentStatus:F,paymentMessage:A})}),e.jsx(j,{variant:"secondary",fullWidth:!0,size:"sm",onClick:()=>{l("confirm"),v("idle"),N("")},disabled:i,children:"Back"})]})]})})]})})})}export{ie as P,E as a,oe as g};
//# sourceMappingURL=PhoneNumberPurchaseModal-DuPYUirp.js.map
