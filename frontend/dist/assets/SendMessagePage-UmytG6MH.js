import{r as i,j as e,_ as c}from"./index-BU1-0t56.js";import{u as L}from"./groupStore-CFqLaX58.js";import{u as G,s as U}from"./messages-BcBDTwZY.js";import{g as $,T as E}from"./TemplateFormModal-BQV1-P7K.js";import{a as R,S as N,L as A}from"./SoftLayout-CFZbwPY2.js";import{S as d}from"./SoftButton-BtM2JNYO.js";import{A as I,m as o}from"./AnimatedBlobs-DMPhxVjT.js";import{F as P,U as B}from"./zap-DxImSWMK.js";import{S as v}from"./send-BrMpOHkE.js";import{T as _}from"./trash-2-D8VTYEGJ.js";import"./index.esm-Cunc4WDT.js";function Z(){const{groups:x}=L(),{addMessage:S}=G(),[t,m]=i.useState(""),[a,f]=i.useState("groups"),[r,u]=i.useState([]),[p,j]=i.useState(!1),[g,w]=i.useState([]),[T,y]=i.useState(!1);i.useEffect(()=>{b()},[]);const b=async()=>{try{const s=await $();w(s)}catch(s){console.error("Failed to load templates:",s)}},n=Math.ceil(t.length/160)||0,C=n*r.length*.0075,M=r.reduce((s,l)=>s+(x.find(h=>h.id===l)?.memberCount||0),0),k=s=>{u(l=>l.includes(s)?l.filter(h=>h!==s):[...l,s])},F=s=>{m(s.content),c.success(`Using template: ${s.name}`)},z=async()=>{if(!t.trim()){c.error("Please enter a message");return}if(a==="groups"&&r.length===0){c.error("Please select at least one group");return}try{j(!0);const s=await U({content:t.trim(),targetType:a==="all"?"all":"groups",targetIds:a==="all"?void 0:r});S(s),c.success(`Message queued for ${s.totalRecipients} recipients`),m(""),u([])}catch(s){c.error(s.message||"Failed to send message")}finally{j(!1)}};return e.jsxs(R,{children:[e.jsx(I,{variant:"minimal"}),e.jsxs("div",{className:"px-4 md:px-8 py-8 w-full max-w-4xl mx-auto",children:[e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex items-center justify-between mb-8",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:e.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Send Message"})}),e.jsx("p",{className:"text-muted-foreground",children:"Reach your congregation with direct SMS messages"})]})}),e.jsxs(N,{className:"space-y-6",children:[g.length>0&&e.jsxs(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsxs("label",{className:"block text-sm font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"Use Template"]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[g.slice(0,6).map(s=>e.jsx(d,{variant:"secondary",size:"sm",onClick:()=>F(s),children:s.name},s.id)),g.length>6&&e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>window.location.href="/templates",children:"More Templates..."})]})]}),e.jsxs(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15},children:[e.jsxs("label",{className:"block text-sm font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4"}),"Message Content"]}),e.jsx("textarea",{value:t,onChange:s=>m(s.target.value.slice(0,1600)),className:"w-full px-4 py-3 border border-border/40 rounded-lg bg-card/50 text-foreground placeholder-muted-foreground/50 focus:outline-none focus:ring-2 focus:ring-primary resize-none transition-colors duration-normal backdrop-blur-sm",rows:6,placeholder:"Type your message here...",maxLength:1600}),e.jsxs("div",{className:"flex justify-between mt-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[t.length," / 1600 characters"]}),e.jsxs("span",{children:[n," SMS segment",n!==1?"s":"",n>0&&` ($${(n*.0075).toFixed(4)} per recipient)`]})]}),t.trim()&&e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>y(!0),className:"mt-2",children:"Save as Template"})]}),e.jsxs(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:[e.jsxs("label",{className:"block text-sm font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"Send To"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:"targetType",value:"groups",checked:a==="groups",onChange:s=>f(s.target.value),className:"w-4 h-4 accent-primary cursor-pointer"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Select Groups"})]}),a==="groups"&&e.jsx("div",{className:"ml-7 space-y-2 bg-muted p-4 rounded-lg border border-border",children:x.length===0?e.jsx("p",{className:"text-muted-foreground text-sm",children:"No groups available"}):x.map(s=>e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:r.includes(s.id),onChange:()=>k(s.id),className:"w-4 h-4 rounded accent-primary cursor-pointer"}),e.jsxs("span",{className:"text-sm text-foreground/80",children:[s.name," (",s.memberCount," members)"]})]},s.id))}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:"targetType",value:"all",checked:a==="all",onChange:s=>f(s.target.value),className:"w-4 h-4 accent-primary cursor-pointer"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"All Members"})]})]})]}),(a==="all"||r.length>0)&&n>0&&e.jsx(o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.25},children:e.jsx(N,{variant:"gradient",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-foreground/80",children:"Recipients:"}),e.jsx("span",{className:"font-medium text-foreground",children:M})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-foreground/80",children:"Segments:"}),e.jsx("span",{className:"font-medium text-foreground",children:n})]}),e.jsxs("div",{className:"flex justify-between border-t border-border/40 pt-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Estimated Cost:"}),e.jsxs("span",{className:"font-bold text-primary",children:["$",C.toFixed(2)]})]})]})})}),e.jsxs(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex gap-3 pt-4",children:[e.jsx(d,{variant:"secondary",size:"md",onClick:()=>{m(""),u([])},disabled:p,icon:e.jsx(_,{className:"w-4 h-4"}),children:"Clear"}),e.jsx(d,{variant:"primary",size:"md",fullWidth:!0,onClick:z,disabled:p||!t.trim()||a==="groups"&&r.length===0,icon:p?e.jsx(o.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(A,{className:"w-4 h-4"})}):e.jsx(v,{className:"w-4 h-4"}),children:p?"Sending...":"Send Message"})]})]})]}),T&&e.jsx(E,{template:null,onClose:()=>{y(!1),b()}})]})}export{Z as SendMessagePage,Z as default};
//# sourceMappingURL=SendMessagePage-UmytG6MH.js.map
