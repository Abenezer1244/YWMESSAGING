import{c as C,r as a,_ as o,j as e,I as A}from"./index-Cizj7HGY.js";import{P as F,g as D}from"./PhoneNumberPurchaseModal-azylRQOM.js";import{L as P,S as x,C as T,a as E}from"./SoftLayout-BWeBQ-3Q.js";import{S as j}from"./SoftButton-YkLQnYMU.js";import{U as M}from"./user-plus-Boaj7h0P.js";import{T as R}from"./trash-2-BosttyQE.js";import{C as W}from"./chevron-left-V8Ae24iC.js";import{C as z}from"./check-BA08CHU8.js";import{P as I}from"./phone-De7tIWuB.js";import{C as Y}from"./circle-alert-3HxXb02K.js";import{m as p}from"./proxy-CUeZk1DQ.js";import"./index-CSdF079A.js";import"./index-YmNWoLEH.js";import"./index-DUjabO45.js";async function $(){return(await C.get("/admin/profile")).data}async function q(s){return(await C.put("/admin/profile",s)).data}async function B(){return(await C.get("/admin/co-admins")).data}async function U(s){return(await C.post("/admin/co-admins",s)).data}async function _(s){return(await C.delete(`/admin/co-admins/${s}`)).data}async function J(s=1,m=50){return(await C.get("/admin/activity-logs",{params:{page:s,limit:m}})).data}async function O(s){return(await C.post("/admin/phone-numbers/link",{phoneNumber:s})).data}function V(){const[s,m]=a.useState([]),[f,h]=a.useState(!0),[i,g]=a.useState(null),[u,l]=a.useState(!1),[c,N]=a.useState(!1),[b,v]=a.useState(null),[d,y]=a.useState({email:"",firstName:"",lastName:""});a.useEffect(()=>{n()},[]);const n=async()=>{try{h(!0);const t=await B();m(t)}catch(t){o.error(t.message||"Failed to load co-admins")}finally{h(!1)}},w=async t=>{if(confirm("Are you sure you want to remove this co-admin? They will lose access immediately."))try{g(t),await _(t),o.success("Co-admin removed successfully"),n()}catch(S){o.error(S.message||"Failed to remove co-admin")}finally{g(null)}},k=async t=>{if(t.preventDefault(),!d.email||!d.firstName||!d.lastName){o.error("Please fill in all fields");return}try{N(!0);const S=await U({email:d.email,firstName:d.firstName,lastName:d.lastName});v(S.data),y({email:"",firstName:"",lastName:""}),o.success("Co-admin invited successfully"),n()}catch(S){o.error(S.message||"Failed to invite co-admin")}finally{N(!1)}};return f?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(P,{className:"w-6 h-6 text-primary animate-spin"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Co-Admin Management"}),e.jsx(j,{variant:"primary",onClick:()=>l(!u),icon:e.jsx(M,{className:"w-4 h-4"}),children:u?"Cancel":"Invite Co-Admin"})]}),u&&e.jsxs(x,{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"Invite New Co-Admin"}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"First Name"}),e.jsx("input",{type:"text",value:d.firstName,onChange:t=>y({...d,firstName:t.target.value}),className:"w-full px-4 py-2 border border-border/40 rounded-lg bg-card/50 text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors duration-normal backdrop-blur-sm",placeholder:"John",disabled:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Last Name"}),e.jsx("input",{type:"text",value:d.lastName,onChange:t=>y({...d,lastName:t.target.value}),className:"w-full px-4 py-2 border border-border/40 rounded-lg bg-card/50 text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors duration-normal backdrop-blur-sm",placeholder:"Doe",disabled:c})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Email"}),e.jsx("input",{type:"email",value:d.email,onChange:t=>y({...d,email:t.target.value}),className:"w-full px-4 py-2 border border-border/40 rounded-lg bg-card/50 text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors duration-normal backdrop-blur-sm",placeholder:"john.doe@example.com",disabled:c})]}),e.jsx(j,{type:"submit",variant:"primary",fullWidth:!0,disabled:c,children:c?"Inviting...":"Send Invite"})]})]}),b&&e.jsxs(x,{variant:"gradient",className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"Co-Admin Invited Successfully!"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Share the following credentials with ",e.jsx("strong",{children:b.admin.email}),":"]}),e.jsxs(x,{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-foreground mb-2",children:[e.jsx("strong",{children:"Email:"})," ",b.admin.email]}),e.jsxs("p",{className:"text-sm text-foreground mb-2",children:[e.jsx("strong",{children:"Temporary Password:"}),e.jsx("code",{className:"ml-2 bg-muted/50 px-2 py-1 rounded font-mono text-primary",children:b.tempPassword}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(b.tempPassword),o.success("Password copied to clipboard")},className:"ml-2 text-primary hover:text-primary/80 text-sm font-medium",children:"Copy"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"They can log in with this temporary password and change it after first login."}),e.jsx(j,{variant:"primary",onClick:()=>v(null),children:"Done"})]}),s.length===0?e.jsxs(x,{className:"text-center py-12 mb-6",children:[e.jsx("p",{className:"text-muted-foreground",children:"No co-admins yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:'Click "Invite Co-Admin" to add your first co-admin'})]}):e.jsx(x,{className:"mb-6 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"border-b border-border/40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Added"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Last Login"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border/40",children:s.map(t=>e.jsxs("tr",{className:"hover:bg-muted/30 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 text-sm font-medium text-foreground",children:[t.firstName," ",t.lastName]}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:t.email}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:t.lastLoginAt?new Date(t.lastLoginAt).toLocaleDateString():"Never"}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsxs("button",{onClick:()=>w(t.id),disabled:i===t.id,className:"inline-flex items-center gap-1 text-danger hover:text-danger/80 disabled:opacity-50 font-medium",children:[e.jsx(R,{className:"w-4 h-4"}),i===t.id?"Removing...":"Remove"]})})]},t.id))})]})})}),e.jsx(x,{variant:"gradient",children:e.jsxs("p",{className:"text-sm text-foreground",children:["ℹ️ ",e.jsx("strong",{children:"Tip:"})," Co-admins can manage branches, groups, members, and messages. They cannot manage billing or other co-admins."]})})]})}function G(){const[s,m]=a.useState(null),[f,h]=a.useState(!0),[i,g]=a.useState(1);a.useEffect(()=>{u()},[i]);const u=async()=>{try{h(!0);const l=await J(i,50);m(l)}catch(l){o.error(l.message||"Failed to load activity logs")}finally{h(!1)}};return f?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(P,{className:"w-6 h-6 text-primary animate-spin"})}):!s||s.logs.length===0?e.jsx(x,{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No activity logs yet"})}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-foreground mb-6",children:"Activity Logs"}),e.jsx(x,{className:"mb-6 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"border-b border-border/40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Action"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Admin"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Timestamp"})]})}),e.jsx("tbody",{className:"divide-y divide-border/40",children:s.logs.map(l=>e.jsxs("tr",{className:"hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-foreground",children:l.action}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:l.details}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:l.adminEmail}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:new Date(l.timestamp).toLocaleString()})]},l.id))})]})})}),s.pagination.pages>1&&e.jsx(x,{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(i-1)*s.pagination.limit+1," to"," ",Math.min(i*s.pagination.limit,s.pagination.total)," of"," ",s.pagination.total," logs"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"secondary",size:"sm",onClick:()=>g(Math.max(1,i-1)),disabled:i===1,icon:e.jsx(W,{className:"w-4 h-4"}),children:"Previous"}),e.jsxs("div",{className:"px-4 py-2 text-sm text-muted-foreground font-medium",children:["Page ",i," of ",s.pagination.pages]}),e.jsx(j,{variant:"secondary",size:"sm",onClick:()=>g(Math.min(s.pagination.pages,i+1)),disabled:i===s.pagination.pages,icon:e.jsx(T,{className:"w-4 h-4"}),children:"Next"})]})]})}),e.jsx(x,{variant:"gradient",children:e.jsxs("p",{className:"text-sm text-foreground",children:["ℹ️ ",e.jsx("strong",{children:"Activity logs:"})," All user actions are logged for security and compliance purposes. Logs are retained for 90 days."]})})]})}function H({currentPhoneNumber:s,onSuccess:m}){const[f,h]=a.useState(s||""),[i,g]=a.useState(!1),[u,l]=a.useState(!s),[c,N]=a.useState(s),[b,v]=a.useState(null),d=async y=>{if(y.preventDefault(),!f.trim()){o.error("Please enter a phone number");return}try{g(!0);const n=await O(f);n.success&&(N(n.data.phoneNumber),v(n.data.webhookId?"auto":"manual"),l(!1),h(""),o.success(n.data.message),m?.(n.data.phoneNumber,n.data.webhookId))}catch(n){const w=n.message;o.error(w||"Failed to link phone number"),v(null)}finally{g(!1)}};return e.jsxs("div",{className:"space-y-4",children:[c&&!u&&e.jsx("div",{className:"p-4 bg-gradient-to-r from-green-500/10 to-emerald-500/10 border border-green-500/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(z,{className:"w-5 h-5 text-green-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Phone Number Linked"}),e.jsx("p",{className:"text-lg font-bold text-green-500 mt-1",children:c}),b==="auto"&&e.jsx("p",{className:"text-xs text-green-600 mt-2",children:"✅ Webhook auto-created successfully"}),b==="manual"&&e.jsx("p",{className:"text-xs text-yellow-600 mt-2",children:"⚠️ Please configure webhook manually in Telnyx dashboard"})]})]}),e.jsx(j,{variant:"secondary",size:"sm",onClick:()=>l(!0),className:"flex-shrink-0",children:"Change"})]})}),u&&e.jsxs("form",{onSubmit:d,className:"space-y-4 p-4 bg-muted/50 rounded-lg border border-border/40",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Telnyx Phone Number"}),e.jsx(A,{type:"tel",placeholder:"+1 (555) 123-4567",value:f,onChange:y=>h(y.target.value),disabled:i,autoFocus:!0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Enter the phone number you purchased from Telnyx (in any format)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"primary",type:"submit",disabled:i||!f.trim(),className:"flex-1",children:i?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 animate-spin mr-2 inline"}),"Linking..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 mr-2 inline"}),"Link Phone Number"]})}),c&&e.jsx(j,{variant:"secondary",type:"button",onClick:()=>{l(!1),h("")},disabled:i,children:"Cancel"})]}),e.jsxs("div",{className:"p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg flex gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-blue-600",children:"When you link a phone number, we'll automatically create a webhook in your Telnyx account. Members can then start texting this number to send messages and media!"})]})]}),!u&&c&&e.jsx("div",{className:"p-3 bg-primary/10 border border-primary/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-primary/80",children:[e.jsx("strong",{children:"What happens next?"})," Your congregation can now text ",e.jsx("strong",{children:c})," to start conversations with you. Messages and media will appear in your Conversations dashboard!"]})})]})}const K=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s);function me(){const[s,m]=a.useState("profile"),[f,h]=a.useState(!1),[i,g]=a.useState(!1),[u,l]=a.useState(null),[c,N]=a.useState(null),[b,v]=a.useState(!1),[d,y]=a.useState(!1),[n,w]=a.useState({name:"",email:""}),k=async()=>{try{h(!0);const r=await $();l(r),w({name:r.name||"",email:r.email||""})}catch{o.error("Failed to load profile. Please refresh the page.")}finally{h(!1)}},t=async()=>{try{y(!0);const r=await D();N(r.telnyxPhoneNumber)}catch{N(null)}finally{y(!1)}};a.useEffect(()=>{k(),t()},[]);const S=async r=>{if(r.preventDefault(),!n.name.trim()){o.error("Church name is required");return}if(!n.email.trim()){o.error("Email address is required");return}if(!K(n.email.trim())){o.error("Please enter a valid email address");return}try{g(!0),await q({name:n.name.trim(),email:n.email.trim()}),o.success("Profile updated successfully"),k()}catch{o.error("Failed to update profile. Please try again.")}finally{g(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(E,{children:e.jsxs("div",{className:"px-4 md:px-8 py-8 w-full",children:[e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:e.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Settings"})}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your church account and permissions"})]}),e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"mb-8",children:e.jsxs(x,{children:[e.jsx("div",{className:"border-b border-border/40",children:e.jsx("div",{className:"flex flex-wrap",children:["profile","coadmins","numbers","logs"].map((r,L)=>e.jsxs(p.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:L*.05},onClick:()=>m(r),className:`flex-1 min-w-[120px] px-4 py-4 text-center font-medium border-b-2 transition ${s===r?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[r==="profile"&&"Church Profile",r==="coadmins"&&"Co-Admins",r==="numbers"&&"Phone Numbers",r==="logs"&&"Activity Logs"]},r))})}),e.jsxs("div",{className:"p-8",children:[s==="profile"&&e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-6",children:"Church Profile"}),f?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(p.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0},children:e.jsx(P,{className:"w-8 h-8 text-primary"})})}):e.jsxs("form",{onSubmit:S,className:"max-w-2xl",children:[e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-6",children:e.jsx(A,{label:"Church Name",type:"text",value:n.name,onChange:r=>w({...n,name:r.target.value}),placeholder:"Your church name"})}),e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"mb-6",children:e.jsx(A,{label:"Email Address",type:"email",value:n.email,onChange:r=>w({...n,email:r.target.value}),placeholder:"contact@church.com"})}),u&&e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-6",children:e.jsxs(x,{variant:"gradient",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"Account Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Status:"})," ",e.jsx("span",{className:"font-medium text-foreground",children:u.subscriptionStatus})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Created:"})," ",e.jsx("span",{className:"font-medium text-foreground",children:new Date(u.createdAt).toLocaleDateString()})]})]})]})}),e.jsx(j,{type:"submit",variant:"primary",disabled:i,children:i?"Saving...":"Save Changes"})]})]}),s==="coadmins"&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:e.jsx(V,{})}),s==="numbers"&&e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-6",children:"Phone Numbers"}),d?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(p.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0},children:e.jsx(P,{className:"w-8 h-8 text-primary"})})}):e.jsxs("div",{className:"max-w-2xl space-y-6",children:[e.jsx("div",{className:"mb-6",children:e.jsx(H,{currentPhoneNumber:c,onSuccess:r=>{N(r),t(),o.success("Phone number linked successfully!")}})}),e.jsxs(x,{variant:"gradient",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(I,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-foreground",children:"Current Phone Number"})]}),c?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:c}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your active Telnyx phone number for receiving SMS messages and conversations."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted-foreground",children:"No phone number linked yet. Link a number you've purchased from Telnyx above or buy one to start."}),e.jsx(j,{variant:"primary",onClick:()=>v(!0),children:"Buy Phone Number"})]})]}),e.jsxs(x,{variant:"default",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"About Phone Numbers"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-primary font-bold",children:"•"}),e.jsx("span",{children:"Each church gets one dedicated phone number for receiving member conversations"})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-primary font-bold",children:"•"}),e.jsx("span",{children:"Members text your number to start conversations with your church"})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-primary font-bold",children:"•"}),e.jsx("span",{children:"When you link a number, we automatically create a webhook for receiving messages"})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-primary font-bold",children:"•"}),e.jsx("span",{children:"Numbers are powered by Telnyx for reliable SMS/MMS delivery"})]})]})]})]})]}),s==="logs"&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:e.jsx(G,{})})]})]})})]})}),e.jsx(F,{isOpen:b,onClose:()=>v(!1),onPurchaseComplete:r=>{N(r),v(!1),o.success("Phone number purchased successfully!")}})]})}export{me as AdminSettingsPage,me as default};
//# sourceMappingURL=AdminSettingsPage-BQyUToop.js.map
