import{r as l,j as e,C as N,B as i,_ as c}from"./index-JCVRrkha.js";import{u as k}from"./groupStore-pXHF3za3.js";import{u as F,s as E}from"./messages-Bi7wWfXx.js";import{g as B,T as z}from"./TemplateFormModal-BH-xpIKF.js";import{B as G}from"./BackButton-BpV0x2bV.js";import"./index.esm-De4jGUYe.js";function _(){const{groups:u}=k(),{addMessage:y}=F(),[a,d]=l.useState(""),[t,h]=l.useState("groups"),[r,x]=l.useState([]),[m,f]=l.useState(!1),[g,v]=l.useState([]),[C,j]=l.useState(!1);l.useEffect(()=>{b()},[]);const b=async()=>{try{const s=await B();v(s)}catch(s){console.error("Failed to load templates:",s)}},n=Math.ceil(a.length/160)||0,S=n*r.length*.0075,w=r.reduce((s,o)=>s+(u.find(p=>p.id===o)?.memberCount||0),0),D=s=>{x(o=>o.includes(s)?o.filter(p=>p!==s):[...o,s])},T=s=>{d(s.content),c.success(`Using template: ${s.name}`)},M=async()=>{if(!a.trim()){c.error("Please enter a message");return}if(t==="groups"&&r.length===0){c.error("Please select at least one group");return}try{f(!0);const s=await E({content:a.trim(),targetType:t==="all"?"all":"groups",targetIds:t==="all"?void 0:r});y(s),c.success(`Message queued for ${s.totalRecipients} recipients`),d(""),x([])}catch(s){c.error(s.message||"Failed to send message")}finally{f(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background p-6 transition-colors duration-normal",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsx(G,{variant:"ghost"})}),e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"ðŸ“¨ Send Message"}),e.jsx("p",{className:"text-foreground/80",children:"Reach your congregation with direct SMS messages"})]})}),e.jsxs(N,{variant:"default",className:"space-y-6",children:[g.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-foreground mb-3",children:"ðŸ“‹ Use Template"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[g.slice(0,6).map(s=>e.jsx(i,{variant:"secondary",size:"sm",onClick:()=>T(s),title:s.content,children:s.name},s.id)),g.length>6&&e.jsx(i,{variant:"outline",size:"sm",onClick:()=>window.location.href="/templates",children:"More Templates..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-foreground mb-3",children:"âœï¸ Message Content"}),e.jsx("textarea",{value:a,onChange:s=>d(s.target.value.slice(0,1600)),className:"w-full px-4 py-3 border border-border rounded-lg bg-input text-foreground placeholder-muted-foreground/50 focus:outline-none focus:ring-2 focus:ring-primary resize-none transition-colors duration-normal",rows:6,placeholder:"Type your message here...",maxLength:1600}),e.jsxs("div",{className:"flex justify-between mt-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[a.length," / 1600 characters"]}),e.jsxs("span",{children:[n," SMS segment",n!==1?"s":"",n>0&&` ($${(n*.0075).toFixed(4)} per recipient)`]})]}),a.trim()&&e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>j(!0),className:"mt-2",children:"ðŸ’¾ Save as Template"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-foreground mb-3",children:"ðŸ‘¥ Send To"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:"targetType",value:"groups",checked:t==="groups",onChange:s=>h(s.target.value),className:"w-4 h-4 accent-primary cursor-pointer"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Select Groups"})]}),t==="groups"&&e.jsx("div",{className:"ml-7 space-y-2 bg-muted p-4 rounded-lg border border-border",children:u.length===0?e.jsx("p",{className:"text-muted-foreground text-sm",children:"No groups available"}):u.map(s=>e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:r.includes(s.id),onChange:()=>D(s.id),className:"w-4 h-4 rounded accent-primary cursor-pointer"}),e.jsxs("span",{className:"text-sm text-foreground/80",children:[s.name," (",s.memberCount," members)"]})]},s.id))}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:"targetType",value:"all",checked:t==="all",onChange:s=>h(s.target.value),className:"w-4 h-4 accent-primary cursor-pointer"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"All Members"})]})]})]}),(t==="all"||r.length>0)&&n>0&&e.jsx(N,{variant:"highlight",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-foreground/80",children:"Recipients:"}),e.jsx("span",{className:"font-medium text-foreground",children:w})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-foreground/80",children:"Segments:"}),e.jsx("span",{className:"font-medium text-foreground",children:n})]}),e.jsxs("div",{className:"flex justify-between border-t border-border pt-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Estimated Cost:"}),e.jsxs("span",{className:"font-bold text-primary",children:["$",S.toFixed(2)]})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(i,{variant:"secondary",size:"md",onClick:()=>{d(""),x([])},disabled:m,children:"ðŸ—‘ï¸ Clear"}),e.jsx(i,{variant:"primary",size:"md",fullWidth:!0,onClick:M,disabled:m||!a.trim()||t==="groups"&&r.length===0,isLoading:m,children:m?"Sending...":"âœ‰ï¸ Send Message"})]})]})]}),C&&e.jsx(z,{template:null,onClose:()=>{j(!1),b()}})]})}export{_ as SendMessagePage,_ as default};
//# sourceMappingURL=SendMessagePage-By4a1Ig1.js.map
