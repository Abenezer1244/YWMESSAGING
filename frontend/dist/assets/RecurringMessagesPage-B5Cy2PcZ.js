import{e as f,r as m,j as e,_ as o}from"./index-BVn4UIJl.js";import{u as q}from"./index.esm-BICfdk-F.js";import{u as D}from"./groupStore-CigYmQo5.js";import{a as A,L as O,S as w}from"./SoftLayout-Bkgn0dyT.js";import{S as b}from"./SoftButton-CJkLUDDO.js";import{A as L,m as M}from"./AnimatedBlobs-DyMOq9LE.js";import{P as R,S as W}from"./square-pen-CEF6nles.js";import{c as I,C as F}from"./index-BvpLcuDk.js";import{T as E}from"./trash-2-CYxEY73n.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],$=I("refresh-cw",G);async function z(){return(await f.get("/recurring")).data}async function P(s){return(await f.post("/recurring",s)).data}async function _(s,a){return(await f.put(`/recurring/${s}`,a)).data}async function B(s){return(await f.delete(`/recurring/${s}`)).data}async function H(s,a){return(await f.put(`/recurring/${s}/toggle`,{isActive:a})).data}function J({message:s,onClose:a}){const{groups:x}=D(),[c,p]=m.useState(!1),{register:n,handleSubmit:j,formState:{errors:i},watch:d}=q({defaultValues:s?{name:s.name,content:s.content,targetType:s.targetType==="all"?"all":"groups",selectedGroupIds:s.targetIds?JSON.parse(s.targetIds):[],frequency:s.frequency,timeOfDay:s.timeOfDay||"09:00",dayOfWeek:s.dayOfWeek||0}:{name:"",content:"",targetType:"groups",selectedGroupIds:[],frequency:"daily",timeOfDay:"09:00",dayOfWeek:0}}),h=d("targetType");d("selectedGroupIds");const N=d("frequency"),k=async r=>{try{p(!0);const u={name:r.name,content:r.content,targetType:r.targetType==="all"?"all":"groups",targetIds:r.targetType==="all"?void 0:r.selectedGroupIds,frequency:r.frequency,timeOfDay:r.timeOfDay,dayOfWeek:r.frequency==="weekly"?r.dayOfWeek:void 0};s?(await _(s.id,u),o.success("Recurring message updated")):(await P(u),o.success("Recurring message created")),a()}catch(u){o.error(u.message||"Failed to save recurring message")}finally{p(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-md w-full mx-4 p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:s?"Edit Recurring Message":"Create Recurring Message"}),e.jsxs("form",{onSubmit:j(k),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Name *"}),e.jsx("input",{...n("name",{required:"Name is required"}),type:"text",className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Sunday Reminder"}),i.name&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:i.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Content *"}),e.jsx("textarea",{...n("content",{required:"Content is required"}),className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:4,placeholder:"Message content..."}),i.content&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:i.content.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Send To *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 dark:text-gray-300",children:[e.jsx("input",{...n("targetType"),type:"radio",value:"groups"}),e.jsx("span",{className:"text-sm",children:"Select Groups"})]}),h==="groups"&&e.jsx("div",{className:"ml-6 space-y-1 bg-gray-50 dark:bg-slate-700 p-2 rounded",children:x.map(r=>e.jsxs("label",{className:"flex items-center gap-2 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",value:r.id,...n("selectedGroupIds")}),e.jsx("span",{className:"text-sm",children:r.name})]},r.id))}),e.jsxs("label",{className:"flex items-center gap-2 dark:text-gray-300",children:[e.jsx("input",{...n("targetType"),type:"radio",value:"all"}),e.jsx("span",{className:"text-sm",children:"All Members"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Frequency *"}),e.jsxs("select",{...n("frequency"),className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),N==="weekly"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Day of Week *"}),e.jsxs("select",{...n("dayOfWeek",{valueAsNumber:!0}),className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:0,children:"Sunday"}),e.jsx("option",{value:1,children:"Monday"}),e.jsx("option",{value:2,children:"Tuesday"}),e.jsx("option",{value:3,children:"Wednesday"}),e.jsx("option",{value:4,children:"Thursday"}),e.jsx("option",{value:5,children:"Friday"}),e.jsx("option",{value:6,children:"Saturday"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Time of Day *"}),e.jsx("input",{...n("timeOfDay"),type:"time",className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-700 dark:text-gray-300 font-medium hover:bg-gray-50 dark:hover:bg-slate-700 transition",disabled:c,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition disabled:bg-gray-400",disabled:c,children:c?"Saving...":"Save"})]})]})]})})}function se(){const[s,a]=m.useState([]),[x,c]=m.useState(!0),[p,n]=m.useState(!1),[j,i]=m.useState(null);m.useEffect(()=>{d()},[]);const d=async()=>{try{c(!0);const t=await z();a(t)}catch(t){o.error(t.message||"Failed to load recurring messages")}finally{c(!1)}},h=()=>{i(null),n(!0)},N=t=>{i(t),n(!0)},k=async t=>{if(window.confirm("Are you sure you want to delete this recurring message?"))try{await B(t),a(s.filter(l=>l.id!==t)),o.success("Recurring message deleted")}catch(l){o.error(l.message||"Failed to delete recurring message")}},r=async(t,l)=>{try{const g=await H(t,!l);a(s.map(y=>y.id===t?g:y)),o.success(l?"Recurring message paused":"Recurring message resumed")}catch(g){o.error(g.message||"Failed to toggle recurring message")}},u=()=>{n(!1),i(null),d()},C=t=>{const l=new Date(t),g=new Date,y=l.getTime()-g.getTime(),S=Math.floor(y/(1e3*60*60*24)),v=Math.floor(y%(1e3*60*60*24)/(1e3*60*60));return S>0?`in ${S}d ${v}h`:v>0?`in ${v}h`:"soon"},T=t=>({daily:"Daily",weekly:"Weekly",monthly:"Monthly"})[t]||t;return e.jsxs(A,{children:[e.jsx(L,{variant:"minimal"}),e.jsxs("div",{className:"px-4 md:px-8 py-8 w-full",children:[e.jsxs(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:e.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Recurring Messages"})}),e.jsx("p",{className:"text-muted-foreground",children:"Automate regular communications"})]}),e.jsx(b,{variant:"primary",size:"lg",onClick:h,icon:e.jsx(R,{className:"w-5 h-5"}),children:"Create Recurring Message"})]}),x?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(M.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:e.jsx(O,{className:"w-8 h-8 text-primary"})})}):s.length===0?e.jsx(M.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.1},children:e.jsxs(w,{variant:"gradient",className:"text-center py-16",children:[e.jsx("div",{className:"mb-6",children:e.jsx($,{className:"w-16 h-16 mx-auto text-muted-foreground"})}),e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-3",children:"No Recurring Messages Yet"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Create recurring messages to automatically send messages on a regular schedule."}),e.jsx(b,{variant:"primary",size:"md",onClick:h,icon:e.jsx(R,{className:"w-4 h-4"}),children:"Create First Message"})]})}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:s.map((t,l)=>e.jsxs(w,{index:l,className:t.isActive?"":"opacity-75",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:t.name}),e.jsx("p",{className:"text-sm text-foreground/80 mt-1",children:T(t.frequency)})]}),e.jsx("button",{onClick:()=>r(t.id,t.isActive),className:`px-3 py-1 rounded-full text-xs font-semibold transition-colors ${t.isActive?"bg-green-500/20 text-green-400":"bg-muted-foreground/20 text-muted-foreground"}`,children:t.isActive?"Active":"Paused"})]}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4 line-clamp-2",children:t.content}),e.jsxs(w,{variant:"gradient",className:"mb-4",children:[e.jsxs("p",{className:"text-foreground text-sm flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("strong",{children:"Next send:"})," ",C(t.nextSendAt)]}),e.jsx("p",{className:"text-muted-foreground text-xs mt-2",children:new Date(t.nextSendAt).toLocaleString()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{variant:"secondary",size:"sm",onClick:()=>N(t),fullWidth:!0,icon:e.jsx(W,{className:"w-3 h-3"}),children:"Edit"}),e.jsx(b,{variant:"danger",size:"sm",onClick:()=>k(t.id),fullWidth:!0,icon:e.jsx(E,{className:"w-3 h-3"}),children:"Delete"})]})]},t.id))})]}),p&&e.jsx(J,{message:j,onClose:u})]})}export{se as RecurringMessagesPage,se as default};
//# sourceMappingURL=RecurringMessagesPage-B5Cy2PcZ.js.map
