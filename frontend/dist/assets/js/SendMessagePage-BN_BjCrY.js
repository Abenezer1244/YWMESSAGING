import{j as e,m as s}from"./vendor-ui-DhbhiCKM.js";import{a}from"./vendor-react-DC7Nk3dg.js";import{a as t,_ as r}from"./index-BBK03AmT.js";import{u as i}from"./groupStore-BDxGeJKG.js";import{u as n,s as l}from"./messages-CaZbo-5P.js";import{g as o}from"./groups-D_epV1CD.js";import{g as c,T as d}from"./TemplateFormModal-vfFRHsLh.js";import{a as m,S as x}from"./SoftLayout-DrlEjH-k.js";import{S as p}from"./SoftButton-CoQCJuB5.js";import{F as u,j as h,U as g,n as j,L as f}from"./vendor-utils-C8GUPZyx.js";import"./index.esm-C8Q_B5eL.js";function y(){const{groups:y,setGroups:N}=i(),{currentBranchId:b}=t(),{addMessage:v}=n(),[w,S]=a.useState(""),[C,k]=a.useState("groups"),[M,T]=a.useState([]),[F,z]=a.useState(!1),[$,I]=a.useState(!1),[L,P]=a.useState([]),[R,U]=a.useState(!1);a.useEffect(()=>{W()},[b]);const W=async()=>{I(!0);try{const e=[c().catch(e=>[])];let s=-1;b&&0===y.length&&(s=0,e.unshift(o(b).catch(e=>[])));const a=await Promise.all(e);0===s?(N(a[0]),P(a[1])):P(a[0])}catch(e){r.error("Failed to load page data")}finally{I(!1)}},A=Math.ceil(w.length/160)||0,B=A*M.length*.0075,E=M.reduce((e,s)=>e+(y.find(e=>e.id===s)?.memberCount||0),0);return e.jsxs(m,{children:[e.jsxs("div",{className:"px-4 md:px-8 py-8 w-full max-w-4xl mx-auto",children:[e.jsx(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex items-center justify-between mb-8",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:e.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Send Message"})}),e.jsx("p",{className:"text-muted-foreground",children:"Reach your congregation with direct SMS messages"})]})}),e.jsxs(x,{className:"space-y-6",children:[L.length>0&&e.jsxs(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsxs("label",{className:"block text-sm font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4"}),"Use Template"]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[L.slice(0,6).map(s=>e.jsx(p,{variant:"secondary",size:"sm",onClick:()=>(e=>{S(e.content),r.success(`Using template: ${e.name}`)})(s),children:s.name},s.id)),L.length>6&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>window.location.href="/templates",children:"More Templates..."})]})]}),e.jsxs(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15},children:[e.jsxs("label",{className:"block text-sm font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"}),"Message Content"]}),e.jsx("textarea",{value:w,onChange:e=>S(e.target.value.slice(0,1600)),className:"w-full px-4 py-3 border border-border/40 rounded-lg bg-card/50 text-foreground placeholder-muted-foreground/50 focus:outline-none focus:ring-2 focus:ring-primary resize-none transition-colors duration-normal backdrop-blur-sm",rows:6,placeholder:"Type your message here...",maxLength:1600}),e.jsxs("div",{className:"flex justify-between mt-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[w.length," / 1600 characters"]}),e.jsxs("span",{children:[A," SMS segment",1!==A?"s":"",A>0&&` ($${(.0075*A).toFixed(4)} per recipient)`]})]}),w.trim()&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>U(!0),className:"mt-2",children:"Save as Template"})]}),e.jsxs(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:[e.jsxs("label",{className:"block text-sm font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4"}),"Send To"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:"targetType",value:"groups",checked:"groups"===C,onChange:e=>k(e.target.value),className:"w-4 h-4 accent-primary cursor-pointer"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Select Groups"})]}),"groups"===C&&e.jsx("div",{className:"ml-7 space-y-2 bg-muted p-4 rounded-lg border border-border",children:0===y.length?e.jsx("p",{className:"text-muted-foreground text-sm",children:"No groups available"}):y.map(s=>e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:M.includes(s.id),onChange:()=>{return e=s.id,void T(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e},className:"w-4 h-4 rounded accent-primary cursor-pointer"}),e.jsxs("span",{className:"text-sm text-foreground/80",children:[s.name," (",s.memberCount," members)"]})]},s.id))}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:"targetType",value:"all",checked:"all"===C,onChange:e=>k(e.target.value),className:"w-4 h-4 accent-primary cursor-pointer"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"All Members"})]})]})]}),"groups"===C&&M.length>0&&e.jsx(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.25},children:e.jsx(x,{variant:"gradient",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:"ğŸ“¬ Will send to:"}),e.jsx("div",{className:"space-y-2",children:M.map(s=>{const a=y.find(e=>e.id===s);return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-foreground/80",children:a?.name}),e.jsxs("span",{className:"text-xs font-medium text-primary bg-primary/10 px-2 py-1 rounded",children:[a?.memberCount," members"]})]},s)})}),e.jsx("div",{className:"border-t border-primary/20 pt-2 mt-2",children:e.jsxs("p",{className:"text-sm font-medium text-foreground",children:["Total: ",e.jsxs("span",{className:"text-primary",children:[E," recipients"]})]})})]})})}),"all"===C&&A>0&&e.jsx(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.25},children:e.jsx(x,{variant:"gradient",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:"ğŸ“¬ Will send to:"}),e.jsx("p",{className:"text-sm text-foreground/80",children:"All members in your church"}),e.jsx("div",{className:"border-t border-primary/20 pt-2 mt-2",children:e.jsxs("p",{className:"text-sm font-medium text-foreground",children:["Total: ",e.jsxs("span",{className:"text-primary",children:[E," recipients"]})]})})]})})}),("all"===C||M.length>0)&&A>0&&e.jsx(s.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.25},children:e.jsx(x,{variant:"gradient",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-foreground/80",children:"Recipients:"}),e.jsx("span",{className:"font-medium text-foreground",children:E})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-foreground/80",children:"Segments:"}),e.jsx("span",{className:"font-medium text-foreground",children:A})]}),e.jsxs("div",{className:"flex justify-between border-t border-border/40 pt-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Estimated Cost:"}),e.jsxs("span",{className:"font-bold text-primary",children:["$",B.toFixed(2)]})]})]})})}),e.jsxs(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex gap-3 pt-4",children:[e.jsx(p,{variant:"secondary",size:"md",onClick:()=>{S(""),T([])},disabled:F,icon:e.jsx(j,{className:"w-4 h-4"}),children:"Clear"}),e.jsx(p,{variant:"primary",size:"md",fullWidth:!0,onClick:async()=>{if(w.trim())if("groups"!==C||0!==M.length)try{z(!0);const e=await l({content:w.trim(),targetType:"all"===C?"all":"groups",targetIds:"all"===C?void 0:M});v(e),r.success(`Message queued for ${e.totalRecipients} recipients`),S(""),T([])}catch(e){r.error(e.message||"Failed to send message")}finally{z(!1)}else r.error("Please select at least one group");else r.error("Please enter a message")},disabled:F||!w.trim()||"groups"===C&&0===M.length,icon:F?e.jsx(s.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(f,{className:"w-4 h-4"})}):e.jsx(h,{className:"w-4 h-4"}),children:F?"Sending...":"Send Message"})]})]})]}),R&&e.jsx(d,{template:null,onClose:()=>{U(!1),W()}})]})}export{y as SendMessagePage,y as default};
