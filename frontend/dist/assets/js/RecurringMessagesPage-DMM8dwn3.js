import{j as e,m as s}from"./vendor-ui-DhbhiCKM.js";import{a as t}from"./vendor-react-DC7Nk3dg.js";import{c as a,_ as r}from"./index-FlShn6lH.js";import{u as n}from"./index.esm-C8Q_B5eL.js";import{u as l}from"./groupStore-2ySJVRE5.js";import{a as i,S as d}from"./SoftLayout-C-5Gldc4.js";import{S as c}from"./SoftButton-Dr7nJZFM.js";import{r as o,L as m,R as u,b as x,s as g,n as y}from"./vendor-utils-C8GUPZyx.js";function p({message:s,onClose:i}){const{groups:d}=l(),[c,o]=t.useState(!1),{register:m,handleSubmit:u,formState:{errors:x},watch:g}=n({defaultValues:s?{name:s.name,content:s.content,targetType:"all"===s.targetType?"all":"groups",selectedGroupIds:s.targetIds?JSON.parse(s.targetIds):[],frequency:s.frequency,timeOfDay:s.timeOfDay||"09:00",dayOfWeek:s.dayOfWeek||0}:{name:"",content:"",targetType:"groups",selectedGroupIds:[],frequency:"daily",timeOfDay:"09:00",dayOfWeek:0}}),y=g("targetType");g("selectedGroupIds");const p=g("frequency");return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-md w-full mx-4 p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:s?"Edit Recurring Message":"Create Recurring Message"}),e.jsxs("form",{onSubmit:u(async e=>{try{o(!0);const t={name:e.name,content:e.content,targetType:"all"===e.targetType?"all":"groups",targetIds:"all"===e.targetType?void 0:e.selectedGroupIds,frequency:e.frequency,timeOfDay:e.timeOfDay,dayOfWeek:"weekly"===e.frequency?e.dayOfWeek:void 0};s?(await async function(e,s){return(await a.put(`/recurring/${e}`,s)).data}(s.id,t),r.success("Recurring message updated")):(await async function(e){return(await a.post("/recurring",e)).data}(t),r.success("Recurring message created")),i()}catch(t){r.error(t.message||"Failed to save recurring message")}finally{o(!1)}}),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Name *"}),e.jsx("input",{...m("name",{required:"Name is required"}),type:"text",className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Sunday Reminder"}),x.name&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:x.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Content *"}),e.jsx("textarea",{...m("content",{required:"Content is required"}),className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:4,placeholder:"Message content..."}),x.content&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:x.content.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Send To *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 dark:text-gray-300",children:[e.jsx("input",{...m("targetType"),type:"radio",value:"groups"}),e.jsx("span",{className:"text-sm",children:"Select Groups"})]}),"groups"===y&&e.jsx("div",{className:"ml-6 space-y-1 bg-gray-50 dark:bg-slate-700 p-2 rounded",children:d.map(s=>e.jsxs("label",{className:"flex items-center gap-2 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",value:s.id,...m("selectedGroupIds")}),e.jsx("span",{className:"text-sm",children:s.name})]},s.id))}),e.jsxs("label",{className:"flex items-center gap-2 dark:text-gray-300",children:[e.jsx("input",{...m("targetType"),type:"radio",value:"all"}),e.jsx("span",{className:"text-sm",children:"All Members"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Frequency *"}),e.jsxs("select",{...m("frequency"),className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),"weekly"===p&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Day of Week *"}),e.jsxs("select",{...m("dayOfWeek",{valueAsNumber:!0}),className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:0,children:"Sunday"}),e.jsx("option",{value:1,children:"Monday"}),e.jsx("option",{value:2,children:"Tuesday"}),e.jsx("option",{value:3,children:"Wednesday"}),e.jsx("option",{value:4,children:"Thursday"}),e.jsx("option",{value:5,children:"Friday"}),e.jsx("option",{value:6,children:"Saturday"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Time of Day *"}),e.jsx("input",{...m("timeOfDay"),type:"time",className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:i,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-700 dark:text-gray-300 font-medium hover:bg-gray-50 dark:hover:bg-slate-700 transition",disabled:c,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition disabled:bg-gray-400",disabled:c,children:c?"Saving...":"Save"})]})]})]})})}function f(){const[n,l]=t.useState([]),[f,h]=t.useState(!0),[j,b]=t.useState(!1),[N,v]=t.useState(null);t.useEffect(()=>{k()},[]);const k=async()=>{try{h(!0);const e=await async function(){return(await a.get("/recurring")).data}();l(e)}catch(e){r.error(e.message||"Failed to load recurring messages")}finally{h(!1)}},w=()=>{v(null),b(!0)},S=async e=>{if(window.confirm("Are you sure you want to delete this recurring message?"))try{await async function(e){return(await a.delete(`/recurring/${e}`)).data}(e),l(n.filter(s=>s.id!==e)),r.success("Recurring message deleted")}catch(s){r.error(s.message||"Failed to delete recurring message")}},C=async(e,s)=>{try{const t=await async function(e,s){return(await a.put(`/recurring/${e}/toggle`,{isActive:s})).data}(e,!s);l(n.map(s=>s.id===e?t:s)),r.success(s?"Recurring message paused":"Recurring message resumed")}catch(t){r.error(t.message||"Failed to toggle recurring message")}},T=e=>{const s=new Date(e),t=new Date,a=s.getTime()-t.getTime(),r=Math.floor(a/864e5),n=Math.floor(a%864e5/36e5);return r>0?`in ${r}d ${n}h`:n>0?`in ${n}h`:"soon"};return e.jsxs(i,{children:[e.jsxs("div",{className:"px-4 md:px-8 py-8 w-full",children:[e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:e.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Recurring Messages"})}),e.jsx("p",{className:"text-muted-foreground",children:"Automate regular communications"})]}),e.jsx(c,{variant:"primary",size:"lg",onClick:w,icon:e.jsx(o,{className:"w-5 h-5"}),children:"Create Recurring Message"})]}),f?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(s.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:e.jsx(m,{className:"w-8 h-8 text-primary"})})}):0===n.length?e.jsx(s.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.1},children:e.jsxs(d,{variant:"gradient",className:"text-center py-16",children:[e.jsx("div",{className:"mb-6",children:e.jsx(u,{className:"w-16 h-16 mx-auto text-muted-foreground"})}),e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-3",children:"No Recurring Messages Yet"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Create recurring messages to automatically send messages on a regular schedule."}),e.jsx(c,{variant:"primary",size:"md",onClick:w,icon:e.jsx(o,{className:"w-4 h-4"}),children:"Create First Message"})]})}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:n.map((s,t)=>{return e.jsxs(d,{index:t,className:s.isActive?"":"opacity-75",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:s.name}),e.jsx("p",{className:"text-sm text-foreground/80 mt-1",children:(a=s.frequency,{daily:"Daily",weekly:"Weekly",monthly:"Monthly"}[a]||a)})]}),e.jsx("button",{onClick:()=>C(s.id,s.isActive),className:"px-3 py-1 rounded-full text-xs font-semibold transition-colors "+(s.isActive?"bg-green-500/20 text-green-400":"bg-muted-foreground/20 text-muted-foreground"),children:s.isActive?"Active":"Paused"})]}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4 line-clamp-2",children:s.content}),e.jsxs(d,{variant:"gradient",className:"mb-4",children:[e.jsxs("p",{className:"text-foreground text-sm flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4"}),e.jsx("strong",{children:"Next send:"})," ",T(s.nextSendAt)]}),e.jsx("p",{className:"text-muted-foreground text-xs mt-2",children:new Date(s.nextSendAt).toLocaleString()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"secondary",size:"sm",onClick:()=>(e=>{v(e),b(!0)})(s),fullWidth:!0,icon:e.jsx(g,{className:"w-3 h-3"}),children:"Edit"}),e.jsx(c,{variant:"danger",size:"sm",onClick:()=>S(s.id),fullWidth:!0,icon:e.jsx(y,{className:"w-3 h-3"}),children:"Delete"})]})]},s.id);var a})})]}),j&&e.jsx(p,{message:N,onClose:()=>{b(!1),v(null),k()}})]})}export{f as RecurringMessagesPage,f as default};
