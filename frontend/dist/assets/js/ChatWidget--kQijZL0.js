import{j as e,A as t,m as s}from"./vendor-ui-DmDBw7yB.js";import{a}from"./vendor-react-GajVb7Yi.js";import{c as r,b as o,_ as i}from"./index-BN2KEnXV.js";import{k as n,X as l,j as d}from"./vendor-utils-DZXJUmYg.js";function c({variant:c="floating",position:x="bottom-right"}){const[m,u]=a.useState(""),[g,b]=a.useState(!1),h=a.useRef(null),[y]=a.useState(()=>{let e=localStorage.getItem("visitor_id");return e||(e=`visitor_${Date.now()}_${Math.random().toString(36).substring(7)}`,localStorage.setItem("visitor_id",e)),e}),{conversationId:f,messages:p,isLoading:j,error:v,isOpen:w,setConversationId:k,addMessage:N,setLoading:C,setError:I,openChat:A,closeChat:S}=o();a.useEffect(()=>{(async()=>{if(!f&&w)try{const e=await async function(e){return(await r.post("/chat/conversation",{visitorId:e})).data.data}(y);k(e.conversationId)}catch{I("Failed to start conversation"),i.error("Failed to start conversation")}})()},[w,f,k,I,y]),a.useEffect(()=>{h.current?.scrollIntoView({behavior:"smooth"})},[p]),a.useEffect(()=>{const e=()=>{b(document.documentElement.classList.contains("dark"))};e();const t=new MutationObserver(e);return t.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>t.disconnect()},[]);const E=async()=>{if(!m.trim())return;const e=m.trim();u(""),N({id:Date.now().toString(),role:"user",content:e,createdAt:(new Date).toISOString()}),C(!0),I(null);try{const t=await async function(e,t,s){return(await r.post("/chat/message",{message:e,conversationId:t,visitorId:s})).data.data}(e,f||void 0,y);N({id:`response_${Date.now()}`,role:"assistant",content:t.message,createdAt:(new Date).toISOString()}),f||k(t.conversationId)}catch(t){const e=t.response?.data?.error||"Failed to send message";I(e),i.error(e)}finally{C(!1)}},K="bottom-left"===x?"left-4":"right-4",z=g?"#5f8787":"#e78a53",_=g?"#9db0b0":"#c97a4c";return"floating"===c?e.jsx("div",{className:`fixed bottom-4 ${K} z-50`,children:e.jsxs(t,{children:[!w&&e.jsx(s.button,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},onClick:A,className:"w-14 h-14 rounded-full text-white shadow-lg hover:shadow-xl transition-shadow flex items-center justify-center",style:{backgroundColor:z},children:e.jsx(n,{size:24})}),w&&e.jsxs(s.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"w-80 sm:w-96 h-[500px] bg-white dark:bg-slate-900 rounded-lg shadow-2xl border border-gray-200 dark:border-slate-700 flex flex-col overflow-hidden max-w-[calc(100vw-32px)]",children:[e.jsxs("div",{className:"text-white p-4 flex items-center justify-between",style:{backgroundColor:z},children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Koinonia Assistant"}),e.jsx("p",{className:"text-sm",style:{color:_},children:"Ask me about Koinonia SMS"})]}),e.jsx("button",{onClick:S,className:"p-1 rounded transition-colors",style:{background:"rgba(0, 0, 0, 0.2)"},children:e.jsx(l,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50 dark:bg-slate-800",children:[0===p.length&&e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:[e.jsx(n,{size:32,className:"mx-auto mb-2 opacity-30"}),e.jsxs("p",{className:"text-sm",children:["Hi! I'm the Koinonia Assistant.",e.jsx("br",{}),"Ask me anything about our platform!"]})]}),p.map(t=>e.jsx(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex "+("user"===t.role?"justify-end":"justify-start"),children:e.jsx("div",{className:"max-w-xs px-3 py-2 rounded-lg text-sm "+("user"===t.role?"text-white rounded-br-none":"bg-white dark:bg-slate-700 text-gray-900 dark:text-white border border-gray-200 dark:border-slate-600 rounded-bl-none"),style:"user"===t.role?{backgroundColor:z}:void 0,children:t.content})},t.id)),j&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-white dark:bg-slate-700 px-3 py-2 rounded-lg rounded-bl-none",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200"})]})})}),v&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:v}),e.jsx("div",{ref:h})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-slate-700 p-4 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:m,onChange:e=>u(e.target.value),onKeyPress:e=>"Enter"===e.key&&E(),placeholder:"Ask me something...",disabled:j,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 dark:bg-slate-800 dark:text-white text-sm",style:{"--tw-ring-color":z}}),e.jsx("button",{onClick:E,disabled:j||!m.trim(),className:"text-white p-2 rounded-lg transition-colors disabled:bg-gray-400",style:{backgroundColor:!j&&m.trim()?z:void 0},children:e.jsx(d,{size:18})})]})})]})]})}):e.jsxs("div",{className:"w-full h-full bg-white dark:bg-slate-900 rounded-lg shadow-lg border border-gray-200 dark:border-slate-700 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"text-white p-4",style:{backgroundColor:z},children:[e.jsx("h3",{className:"font-semibold",children:"Koinonia Assistant"}),e.jsx("p",{className:"text-sm",style:{color:_},children:"Ask me about Koinonia features and support"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50 dark:bg-slate-800",children:[0===p.length&&e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:[e.jsx(n,{size:32,className:"mx-auto mb-2 opacity-30"}),e.jsxs("p",{className:"text-sm",children:["Hi! I'm the Koinonia Assistant.",e.jsx("br",{}),"Ask me anything about our platform!"]})]}),p.map(t=>e.jsx(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex "+("user"===t.role?"justify-end":"justify-start"),children:e.jsx("div",{className:"max-w-xs px-3 py-2 rounded-lg text-sm "+("user"===t.role?"text-white rounded-br-none":"bg-white dark:bg-slate-700 text-gray-900 dark:text-white border border-gray-200 dark:border-slate-600 rounded-bl-none"),style:"user"===t.role?{backgroundColor:z}:void 0,children:t.content})},t.id)),j&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-white dark:bg-slate-700 px-3 py-2 rounded-lg rounded-bl-none",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200"})]})})}),v&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:v}),e.jsx("div",{ref:h})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-slate-700 p-4 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:m,onChange:e=>u(e.target.value),onKeyPress:e=>"Enter"===e.key&&E(),placeholder:"Ask me something...",disabled:j,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 dark:bg-slate-800 dark:text-white text-sm",style:{"--tw-ring-color":z}}),e.jsx("button",{onClick:E,disabled:j||!m.trim(),className:"text-white p-2 rounded-lg transition-colors disabled:bg-gray-400",style:{backgroundColor:!j&&m.trim()?z:void 0},children:e.jsx(d,{size:18})})]})})]})}export{c as C};
