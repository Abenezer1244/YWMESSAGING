import{c as e,B as a,_ as t}from"./index-Bh5608IB.js";import{j as s,A as r,m as n}from"./vendor-ui-CCpZGCAs.js";import{a as i}from"./vendor-react-EgHOOK1G.js";import{u as o,a as d,C as c,E as l,l as m}from"./index-BAYjKl5s.js";import{v as u,X as p}from"./vendor-utils-BrBSGCQw.js";async function x(){return(await e.get("/numbers/current")).data.data}async function h(a){return(await e.delete("/numbers/current",{data:a})).data}async function b(){return(await e.get("/admin/profile")).data}async function g(a){return(await e.put("/admin/profile",a)).data}async function y(){return(await e.get("/admin/co-admins")).data}async function f(a){return(await e.post("/admin/co-admins",a)).data}async function v(a){return(await e.delete(`/admin/co-admins/${a}`)).data}async function j(a=1,t=50){return(await e.get("/admin/activity-logs",{params:{page:a,limit:t}})).data}async function N(a){return(await e.post("/admin/phone-numbers/link",{phoneNumber:a})).data}const w={style:{base:{fontSize:"14px",color:"var(--foreground)","::placeholder":{color:"var(--muted-foreground)"},fontFamily:"system-ui, -apple-system, sans-serif"},invalid:{color:"#ff4444"}}};function S({amount:e,phoneNumber:r,paymentIntentId:n,onSuccess:l,onError:m,isLoading:u=!1,paymentStatus:p="idle",paymentMessage:x=""}){const h=o(),b=d(),[g,y]=i.useState(!1);return s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),h&&b){y(!0);try{const e=b.getElement(c);if(!e)throw new Error("Card element not found");const{error:a,paymentMethod:s}=await h.createPaymentMethod({type:"card",card:e,billing_details:{}});if(a)return t.error(a.message||"Failed to process card"),m?.(a.message||"Failed to process card"),void y(!1);if(!s)throw new Error("No payment method returned");l(s.id)}catch(a){const e=a.message||"Payment processing failed";t.error(e),m?.(e)}finally{y(!1)}}else t.error("Payment system not initialized")},className:"space-y-4",children:[s.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:[s.jsxs("h3",{className:"font-semibold text-foreground mb-2",children:["Payment for ",r]}),s.jsxs("div",{className:"text-2xl font-bold text-primary",children:["$",(e/100).toFixed(2)]}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"One-time setup fee"})]}),s.jsx("div",{className:"space-y-3",children:s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Card Details"}),s.jsx("div",{className:"p-3 border border-border rounded-lg bg-muted",children:s.jsx(c,{options:w})})]})}),"idle"!==p&&s.jsxs("div",{className:"p-4 rounded-lg border text-center "+("success"===p?"bg-green-500/10 border-green-500/20 text-green-700":"declined"===p||"failed"===p?"bg-red-500/10 border-red-500/20 text-red-700":"bg-blue-500/10 border-blue-500/20 text-blue-700"),children:["success"===p&&"âœ“ Payment Successful","declined"===p&&"âœ— Card Declined","failed"===p&&"âœ— Payment Failed","processing"===p&&"â³ Processing...",x&&s.jsx("div",{className:"text-sm mt-1",children:x})]}),s.jsx("div",{className:"text-xs text-muted-foreground bg-blue-500/10 border border-blue-500/20 rounded-lg p-3",children:"ðŸ”’ Payment is processed securely by Stripe. Your card details are encrypted and never stored on our servers."}),s.jsx("div",{className:"space-y-2",children:s.jsx(a,{type:"submit",variant:"primary",fullWidth:!0,size:"lg",disabled:!h||g||u,isLoading:g||u,className:"bg-primary hover:bg-primary/90 text-background font-medium",children:g?"Processing...":"Complete Purchase"})})]})}const C=[{code:"CA",name:"California"},{code:"NY",name:"New York"},{code:"TX",name:"Texas"},{code:"FL",name:"Florida"},{code:"IL",name:"Illinois"},{code:"PA",name:"Pennsylvania"},{code:"OH",name:"Ohio"},{code:"GA",name:"Georgia"},{code:"MI",name:"Michigan"},{code:"NC",name:"North Carolina"}],k=m("pk_live_51SNi09E7LiXbMhWDr4X7EtXptIiMS3xAZgkdIfdjgf18XMQpSpt2OY47nmuv7hGSMCehvRDLawh9bDSsLto5D0jS00A7xoe8Ut");function P({isOpen:o,onClose:d,onPurchaseComplete:c}){const[m,x]=i.useState("search"),[h,b]=i.useState(""),[g,y]=i.useState(""),[f,v]=i.useState([]),[j,N]=i.useState(null),[w,P]=i.useState(!1),[I,M]=i.useState(null),[L,F]=i.useState("idle"),[E,z]=i.useState(""),$=()=>{x("search"),b(""),y(""),v([]),N(null),M(null),F("idle"),z("")},D={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{duration:.3,type:"tween"}}};return s.jsx(r,{children:o&&s.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4 backdrop-blur-md",children:s.jsxs(n.div,{initial:{opacity:0,scale:.92,y:30},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.92,y:30},transition:{duration:.4,ease:"easeOut"},className:"bg-background border border-border/50 rounded-2xl shadow-2xl max-w-2xl w-full overflow-hidden",children:[s.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-primary/5 border-b border-border/30 p-6 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-primary/20 rounded-lg",children:s.jsx(u,{className:"w-5 h-5 text-primary"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Buy Phone Number"}),s.jsxs("p",{className:"text-xs text-muted-foreground",children:["search"===m&&"Search available numbers","select"===m&&"Choose a number","confirm"===m&&"Confirm purchase","payment"===m&&"Complete payment"]})]})]}),s.jsx(n.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:d,disabled:w,className:"p-2 hover:bg-muted rounded-lg transition-colors disabled:opacity-50",children:s.jsx(p,{className:"w-5 h-5 text-muted-foreground"})})]}),s.jsx("div",{className:"p-6",children:s.jsxs(n.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.1}}},initial:"hidden",animate:"visible",children:["search"===m&&s.jsxs(n.div,{variants:D,className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Area Code"}),s.jsx("input",{type:"text",placeholder:"e.g., 415, 212, 310",value:h,onChange:e=>b(e.target.value),maxLength:3,className:"w-full px-3 py-2 border border-border/50 rounded-lg bg-background text-foreground placeholder-muted-foreground focus:border-primary focus:outline-none transition-colors"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"State (Optional)"}),s.jsxs("select",{value:g,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border border-border/50 rounded-lg bg-background text-foreground focus:border-primary focus:outline-none transition-colors appearance-none",style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 9L1 4h10z'/%3E%3C/svg%3E\")",backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",paddingRight:"2rem"},children:[s.jsx("option",{value:"",children:"Select a state..."}),C.map(e=>s.jsx("option",{value:e.code,children:e.name},e.code))]})]}),s.jsx(a,{variant:"primary",fullWidth:!0,size:"lg",onClick:async()=>{if(h||g){P(!0);try{const a=await async function(a){const t=new URLSearchParams;return a.areaCode&&t.append("areaCode",a.areaCode),a.state&&t.append("state",a.state),a.contains&&t.append("contains",a.contains),a.quantity&&t.append("quantity",a.quantity.toString()),(await e.get(`/numbers/search?${t.toString()}`)).data.data}({areaCode:h||void 0,state:g||void 0,quantity:10});0===a.length?(t.error("No numbers found for that search"),v([])):(v(a),x("select"))}catch(a){t.error(a.message||"Failed to search numbers")}finally{P(!1)}}else t.error("Please enter an area code or select a state")},disabled:w,isLoading:w,className:"bg-primary hover:bg-primary/90 text-background font-medium mt-6",children:w?"Searching...":"Search Numbers"})]}),"select"===m&&s.jsxs(n.div,{variants:D,className:"space-y-3",children:[s.jsx("div",{className:"space-y-2 max-h-72 overflow-y-auto",children:f.map(e=>s.jsx(n.button,{whileHover:{scale:1.02},onClick:()=>(async e=>{N(e),x("confirm")})(e),className:"w-full p-4 border-2 border-border/30 rounded-lg bg-muted/20 hover:border-primary/50 hover:bg-primary/5 transition-all text-left group",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-semibold text-foreground text-lg",children:e.formattedNumber}),s.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:e.region})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("div",{className:"text-sm font-medium text-foreground",children:["$",e.costPerSms.toFixed(4),"/SMS"]}),s.jsxs("div",{className:"text-xs text-muted-foreground",children:["$",e.costPerMinute.toFixed(4),"/min"]})]})]})},e.id))}),s.jsx(a,{variant:"secondary",fullWidth:!0,size:"sm",onClick:()=>{x("search"),v([]),N(null)},className:"mt-4",children:"Back to Search"})]}),"confirm"===m&&j&&s.jsxs(n.div,{variants:D,className:"space-y-4",children:[s.jsx("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx(u,{className:"w-8 h-8 text-primary mx-auto mb-3"}),s.jsx("div",{className:"text-2xl font-bold text-foreground mb-1",children:j.formattedNumber}),s.jsx("div",{className:"text-sm text-muted-foreground",children:j.region})]})}),s.jsxs("div",{className:"space-y-2 bg-muted/30 rounded-lg p-4",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:"Per SMS:"}),s.jsxs("span",{className:"font-medium text-foreground",children:["$",j.costPerSms.toFixed(4)]})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:"Per minute:"}),s.jsxs("span",{className:"font-medium text-foreground",children:["$",j.costPerMinute.toFixed(4)]})]}),s.jsxs("div",{className:"border-t border-border/30 pt-2 mt-2 flex justify-between font-semibold",children:[s.jsx("span",{className:"text-foreground",children:"One-time setup:"}),s.jsx("span",{className:"text-primary",children:"$0.50"})]})]}),s.jsx("div",{className:"text-xs text-muted-foreground bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:"By purchasing, you agree to Telnyx's terms and will be charged the one-time setup fee. Usage charges apply separately."}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{variant:"primary",fullWidth:!0,size:"lg",onClick:async()=>{if(j){P(!0);try{const a=await async function(a){return(await e.post("/numbers/setup-payment-intent",{phoneNumber:a})).data}(j.phoneNumber);if(!a.success||!a.data?.paymentIntentId)throw new Error("Failed to create payment intent");M(a.data.paymentIntentId),x("payment")}catch(a){t.error(a.message||"Failed to create payment intent")}finally{P(!1)}}},disabled:w,isLoading:w,className:"bg-primary hover:bg-primary/90 text-background font-medium",children:w?"Processing...":"Continue to Payment"}),s.jsx(a,{variant:"secondary",fullWidth:!0,size:"sm",onClick:()=>{x("select"),N(null)},disabled:w,children:"Choose Different Number"})]})]}),"payment"===m&&j&&I&&s.jsxs(n.div,{variants:D,className:"space-y-4",children:[s.jsx(l,{stripe:k,children:s.jsx(S,{amount:50,phoneNumber:j.phoneNumber,paymentIntentId:I,onSuccess:async a=>{if(j&&I){P(!0),F("processing"),z("");try{const s=await async function(a,t){return(await e.post("/numbers/confirm-payment",{paymentIntentId:a,paymentMethodId:t})).data}(I,a);if(!s.success||"succeeded"!==s.data?.status)return F("failed"),z("Payment confirmation failed. Please try again."),void P(!1);const r=await async function(a,t,s){return(await e.post("/numbers/purchase",{phoneNumber:a,paymentIntentId:t,connectionId:s})).data}(j.phoneNumber,I);r.success&&(F("success"),z(""),setTimeout(()=>{const e=r.data.webhookId?"automatically linked with webhook":"linked (webhook manual setup recommended)";t.success(`Successfully purchased ${j.formattedNumber}! Number ${e}.`),c&&c(j.phoneNumber),$(),d()},1500))}catch(s){let e="Payment processing failed";402===s.response?.status?e=s.response?.data?.error||"Request failed with status code 402":s.message&&(e=s.message);const a=e.toLowerCase().includes("declined")||e.toLowerCase().includes("insufficient");F(a?"declined":"failed"),z(e),P(!1)}}},isLoading:w,paymentStatus:L,paymentMessage:E})}),s.jsx(a,{variant:"secondary",fullWidth:!0,size:"sm",onClick:()=>{x("confirm"),F("idle"),z("")},disabled:w,children:"Back"})]})]})})]})})})}export{P,x as a,y as b,j as c,h as d,b as g,f as i,N as l,v as r,g as u};
