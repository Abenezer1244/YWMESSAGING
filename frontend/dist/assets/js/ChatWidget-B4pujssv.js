import{j as e,A as s,m as t}from"./vendor-ui-DhbhiCKM.js";import{a}from"./vendor-react-DC7Nk3dg.js";import{c as r,l as o,X as i,j as n}from"./vendor-utils-C8GUPZyx.js";import{b as l,c as d,_ as c}from"./index-D_Sb9qdq.js";const x=l(r(e=>({conversationId:null,messages:[],isLoading:!1,error:null,isOpen:!1,setConversationId:s=>e({conversationId:s}),addMessage:s=>e(e=>({messages:[...e.messages,s]})),setMessages:s=>e({messages:s}),setLoading:s=>e({isLoading:s}),setError:s=>e({error:s}),toggleChatWindow:()=>e(e=>({isOpen:!e.isOpen})),openChat:()=>e({isOpen:!0}),closeChat:()=>e({isOpen:!1}),clearChat:()=>e({messages:[],conversationId:null,error:null})})));function m({variant:r="floating",position:l="bottom-right"}){const[m,g]=a.useState(""),[u,b]=a.useState(!1),h=a.useRef(null),[y]=a.useState(()=>{let e=localStorage.getItem("visitor_id");return e||(e=`visitor_${Date.now()}_${Math.random().toString(36).substring(7)}`,localStorage.setItem("visitor_id",e)),e}),{conversationId:p,messages:f,isLoading:v,error:j,isOpen:w,setConversationId:k,addMessage:N,setLoading:C,setError:I,openChat:A,closeChat:S}=x();a.useEffect(()=>{(async()=>{if(!p&&w)try{const e=await async function(e){return(await d.post("/chat/conversation",{visitorId:e})).data.data}(y);k(e.conversationId)}catch{I("Failed to start conversation"),c.error("Failed to start conversation")}})()},[w,p,k,I,y]),a.useEffect(()=>{h.current?.scrollIntoView({behavior:"smooth"})},[f]),a.useEffect(()=>{const e=()=>{b(document.documentElement.classList.contains("dark"))};e();const s=new MutationObserver(e);return s.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>s.disconnect()},[]);const E=async()=>{if(!m.trim())return;const e=m.trim();g(""),N({id:Date.now().toString(),role:"user",content:e,createdAt:(new Date).toISOString()}),C(!0),I(null);try{const s=await async function(e,s,t){return(await d.post("/chat/message",{message:e,conversationId:s,visitorId:t})).data.data}(e,p||void 0,y);N({id:`response_${Date.now()}`,role:"assistant",content:s.message,createdAt:(new Date).toISOString()}),p||k(s.conversationId)}catch(s){const e=s.response?.data?.error||"Failed to send message";I(e),c.error(e)}finally{C(!1)}},O="bottom-left"===l?"left-4":"right-4",K=u?"#5f8787":"#e78a53",z=u?"#9db0b0":"#c97a4c";return"floating"===r?e.jsx("div",{className:`fixed bottom-4 ${O} z-50`,children:e.jsxs(s,{children:[!w&&e.jsx(t.button,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},onClick:A,className:"w-14 h-14 rounded-full text-white shadow-lg hover:shadow-xl transition-shadow flex items-center justify-center",style:{backgroundColor:K},children:e.jsx(o,{size:24})}),w&&e.jsxs(t.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"w-80 sm:w-96 h-[500px] bg-white dark:bg-slate-900 rounded-lg shadow-2xl border border-gray-200 dark:border-slate-700 flex flex-col overflow-hidden max-w-[calc(100vw-32px)]",children:[e.jsxs("div",{className:"text-white p-4 flex items-center justify-between",style:{backgroundColor:K},children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Koinonia Assistant"}),e.jsx("p",{className:"text-sm",style:{color:z},children:"Ask me about Koinonia SMS"})]}),e.jsx("button",{onClick:S,className:"p-1 rounded transition-colors",style:{background:"rgba(0, 0, 0, 0.2)"},children:e.jsx(i,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50 dark:bg-slate-800",children:[0===f.length&&e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:[e.jsx(o,{size:32,className:"mx-auto mb-2 opacity-30"}),e.jsxs("p",{className:"text-sm",children:["Hi! I'm the Koinonia Assistant.",e.jsx("br",{}),"Ask me anything about our platform!"]})]}),f.map(s=>e.jsx(t.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex "+("user"===s.role?"justify-end":"justify-start"),children:e.jsx("div",{className:"max-w-xs px-3 py-2 rounded-lg text-sm "+("user"===s.role?"text-white rounded-br-none":"bg-white dark:bg-slate-700 text-gray-900 dark:text-white border border-gray-200 dark:border-slate-600 rounded-bl-none"),style:"user"===s.role?{backgroundColor:K}:void 0,children:s.content})},s.id)),v&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-white dark:bg-slate-700 px-3 py-2 rounded-lg rounded-bl-none",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200"})]})})}),j&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:j}),e.jsx("div",{ref:h})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-slate-700 p-4 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:m,onChange:e=>g(e.target.value),onKeyPress:e=>"Enter"===e.key&&E(),placeholder:"Ask me something...",disabled:v,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 dark:bg-slate-800 dark:text-white text-sm",style:{"--tw-ring-color":K}}),e.jsx("button",{onClick:E,disabled:v||!m.trim(),className:"text-white p-2 rounded-lg transition-colors disabled:bg-gray-400",style:{backgroundColor:!v&&m.trim()?K:void 0},children:e.jsx(n,{size:18})})]})})]})]})}):e.jsxs("div",{className:"w-full h-full bg-white dark:bg-slate-900 rounded-lg shadow-lg border border-gray-200 dark:border-slate-700 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"text-white p-4",style:{backgroundColor:K},children:[e.jsx("h3",{className:"font-semibold",children:"Koinonia Assistant"}),e.jsx("p",{className:"text-sm",style:{color:z},children:"Ask me about Koinonia features and support"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50 dark:bg-slate-800",children:[0===f.length&&e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:[e.jsx(o,{size:32,className:"mx-auto mb-2 opacity-30"}),e.jsxs("p",{className:"text-sm",children:["Hi! I'm the Koinonia Assistant.",e.jsx("br",{}),"Ask me anything about our platform!"]})]}),f.map(s=>e.jsx(t.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex "+("user"===s.role?"justify-end":"justify-start"),children:e.jsx("div",{className:"max-w-xs px-3 py-2 rounded-lg text-sm "+("user"===s.role?"text-white rounded-br-none":"bg-white dark:bg-slate-700 text-gray-900 dark:text-white border border-gray-200 dark:border-slate-600 rounded-bl-none"),style:"user"===s.role?{backgroundColor:K}:void 0,children:s.content})},s.id)),v&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-white dark:bg-slate-700 px-3 py-2 rounded-lg rounded-bl-none",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200"})]})})}),j&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:j}),e.jsx("div",{ref:h})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-slate-700 p-4 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:m,onChange:e=>g(e.target.value),onKeyPress:e=>"Enter"===e.key&&E(),placeholder:"Ask me something...",disabled:v,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 dark:bg-slate-800 dark:text-white text-sm",style:{"--tw-ring-color":K}}),e.jsx("button",{onClick:E,disabled:v||!m.trim(),className:"text-white p-2 rounded-lg transition-colors disabled:bg-gray-400",style:{backgroundColor:!v&&m.trim()?K:void 0},children:e.jsx(n,{size:18})})]})})]})}export{m as C};
