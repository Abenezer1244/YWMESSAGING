import{j as e,m as s}from"./vendor-ui-DhbhiCKM.js";import{a}from"./vendor-react-DC7Nk3dg.js";import{_ as t}from"./index-whm2mmto.js";import{u as r}from"./groupStore-RT9jG-93.js";import{u as i,s as n}from"./messages-l1txrX0d.js";import{g as l,T as o}from"./TemplateFormModal-DGn0bz1b.js";import{a as c,S as d}from"./SoftLayout-shb3P8ZN.js";import{S as m}from"./SoftButton-Dr7nJZFM.js";import{F as x,j as p,U as u,n as h,L as g}from"./vendor-utils-C8GUPZyx.js";import"./index.esm-C8Q_B5eL.js";function j(){const{groups:j}=r(),{addMessage:f}=i(),[y,b]=a.useState(""),[N,v]=a.useState("groups"),[w,S]=a.useState([]),[C,k]=a.useState(!1),[T,M]=a.useState([]),[z,F]=a.useState(!1);a.useEffect(()=>{$()},[]);const $=async()=>{try{const e=await l();M(e)}catch(e){}},E=Math.ceil(y.length/160)||0,L=E*w.length*.0075,R=w.reduce((e,s)=>e+(j.find(e=>e.id===s)?.memberCount||0),0);return e.jsxs(c,{children:[e.jsxs("div",{className:"px-4 md:px-8 py-8 w-full max-w-4xl mx-auto",children:[e.jsx(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex items-center justify-between mb-8",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:e.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Send Message"})}),e.jsx("p",{className:"text-muted-foreground",children:"Reach your congregation with direct SMS messages"})]})}),e.jsxs(d,{className:"space-y-6",children:[T.length>0&&e.jsxs(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsxs("label",{className:"block text-sm font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4"}),"Use Template"]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[T.slice(0,6).map(s=>e.jsx(m,{variant:"secondary",size:"sm",onClick:()=>(e=>{b(e.content),t.success(`Using template: ${e.name}`)})(s),children:s.name},s.id)),T.length>6&&e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>window.location.href="/templates",children:"More Templates..."})]})]}),e.jsxs(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15},children:[e.jsxs("label",{className:"block text-sm font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4"}),"Message Content"]}),e.jsx("textarea",{value:y,onChange:e=>b(e.target.value.slice(0,1600)),className:"w-full px-4 py-3 border border-border/40 rounded-lg bg-card/50 text-foreground placeholder-muted-foreground/50 focus:outline-none focus:ring-2 focus:ring-primary resize-none transition-colors duration-normal backdrop-blur-sm",rows:6,placeholder:"Type your message here...",maxLength:1600}),e.jsxs("div",{className:"flex justify-between mt-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[y.length," / 1600 characters"]}),e.jsxs("span",{children:[E," SMS segment",1!==E?"s":"",E>0&&` ($${(.0075*E).toFixed(4)} per recipient)`]})]}),y.trim()&&e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>F(!0),className:"mt-2",children:"Save as Template"})]}),e.jsxs(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:[e.jsxs("label",{className:"block text-sm font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4"}),"Send To"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:"targetType",value:"groups",checked:"groups"===N,onChange:e=>v(e.target.value),className:"w-4 h-4 accent-primary cursor-pointer"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Select Groups"})]}),"groups"===N&&e.jsx("div",{className:"ml-7 space-y-2 bg-muted p-4 rounded-lg border border-border",children:0===j.length?e.jsx("p",{className:"text-muted-foreground text-sm",children:"No groups available"}):j.map(s=>e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:w.includes(s.id),onChange:()=>{return e=s.id,void S(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e},className:"w-4 h-4 rounded accent-primary cursor-pointer"}),e.jsxs("span",{className:"text-sm text-foreground/80",children:[s.name," (",s.memberCount," members)"]})]},s.id))}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:"targetType",value:"all",checked:"all"===N,onChange:e=>v(e.target.value),className:"w-4 h-4 accent-primary cursor-pointer"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"All Members"})]})]})]}),"groups"===N&&w.length>0&&e.jsx(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.25},children:e.jsx(d,{variant:"gradient",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:"ğŸ“¬ Will send to:"}),e.jsx("div",{className:"space-y-2",children:w.map(s=>{const a=j.find(e=>e.id===s);return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-foreground/80",children:a?.name}),e.jsxs("span",{className:"text-xs font-medium text-primary bg-primary/10 px-2 py-1 rounded",children:[a?.memberCount," members"]})]},s)})}),e.jsx("div",{className:"border-t border-primary/20 pt-2 mt-2",children:e.jsxs("p",{className:"text-sm font-medium text-foreground",children:["Total: ",e.jsxs("span",{className:"text-primary",children:[R," recipients"]})]})})]})})}),"all"===N&&E>0&&e.jsx(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.25},children:e.jsx(d,{variant:"gradient",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:"ğŸ“¬ Will send to:"}),e.jsx("p",{className:"text-sm text-foreground/80",children:"All members in your church"}),e.jsx("div",{className:"border-t border-primary/20 pt-2 mt-2",children:e.jsxs("p",{className:"text-sm font-medium text-foreground",children:["Total: ",e.jsxs("span",{className:"text-primary",children:[R," recipients"]})]})})]})})}),("all"===N||w.length>0)&&E>0&&e.jsx(s.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.25},children:e.jsx(d,{variant:"gradient",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-foreground/80",children:"Recipients:"}),e.jsx("span",{className:"font-medium text-foreground",children:R})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-foreground/80",children:"Segments:"}),e.jsx("span",{className:"font-medium text-foreground",children:E})]}),e.jsxs("div",{className:"flex justify-between border-t border-border/40 pt-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Estimated Cost:"}),e.jsxs("span",{className:"font-bold text-primary",children:["$",L.toFixed(2)]})]})]})})}),e.jsxs(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex gap-3 pt-4",children:[e.jsx(m,{variant:"secondary",size:"md",onClick:()=>{b(""),S([])},disabled:C,icon:e.jsx(h,{className:"w-4 h-4"}),children:"Clear"}),e.jsx(m,{variant:"primary",size:"md",fullWidth:!0,onClick:async()=>{if(y.trim())if("groups"!==N||0!==w.length)try{k(!0);const e=await n({content:y.trim(),targetType:"all"===N?"all":"groups",targetIds:"all"===N?void 0:w});f(e),t.success(`Message queued for ${e.totalRecipients} recipients`),b(""),S([])}catch(e){t.error(e.message||"Failed to send message")}finally{k(!1)}else t.error("Please select at least one group");else t.error("Please enter a message")},disabled:C||!y.trim()||"groups"===N&&0===w.length,icon:C?e.jsx(s.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(g,{className:"w-4 h-4"})}):e.jsx(p,{className:"w-4 h-4"}),children:C?"Sending...":"Send Message"})]})]})]}),z&&e.jsx(o,{template:null,onClose:()=>{F(!1),$()}})]})}export{j as SendMessagePage,j as default};
