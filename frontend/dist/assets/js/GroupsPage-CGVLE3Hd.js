import{j as e,m as s}from"./vendor-ui-DhbhiCKM.js";import{a,f as r}from"./vendor-react-DC7Nk3dg.js";import{_ as t,a as l,i}from"./index-DRgsfogx.js";import{u as n,c as d,g as o,d as c}from"./groups-B6GIKg1I.js";import{u as m}from"./index.esm-C8Q_B5eL.js";import{a as x,S as u}from"./SoftLayout-DYnejCwh.js";import{S as g}from"./SoftButton-CoQCJuB5.js";import{L as p,U as h,P as b,n as f,o as j}from"./vendor-utils-C8GUPZyx.js";function y({isOpen:s,group:r,branchId:l,onClose:i,onSuccess:o}){const{register:c,handleSubmit:x,reset:u,watch:g}=m({defaultValues:{name:r?.name||"",description:r?.description||"",welcomeMessageEnabled:r?.welcomeMessageEnabled||!1,welcomeMessageText:r?.welcomeMessageText||""}}),[p,h]=a.useState(!1),b=g("welcomeMessageEnabled");return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg max-w-md w-full mx-4 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:r?"Edit Group":"Create Group"}),e.jsxs("form",{onSubmit:x(async e=>{try{if(h(!0),r){const s=await n(r.id,{name:e.name,description:e.description||void 0,welcomeMessageEnabled:e.welcomeMessageEnabled,welcomeMessageText:e.welcomeMessageText||void 0});t.success("Group updated successfully"),o(s)}else{const s=await d(l,{name:e.name,description:e.description||void 0,welcomeMessageEnabled:e.welcomeMessageEnabled,welcomeMessageText:e.welcomeMessageText||void 0});t.success("Group created successfully"),o(s)}u(),i()}catch(s){t.error(s.message||"Failed to save group")}finally{h(!1)}}),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Group Name *"}),e.jsx("input",{type:"text",...c("name",{required:!0}),className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Young Adults"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{...c("description"),className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional group description",rows:3})]}),e.jsxs("div",{className:"space-y-3 border-t border-gray-300 dark:border-slate-600 pt-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",...c("welcomeMessageEnabled"),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Send welcome message when members join"})]}),b&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Welcome Message"}),e.jsx("textarea",{...c("welcomeMessageText"),className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter welcome message text",rows:3})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:i,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-700 dark:text-gray-300 font-medium hover:bg-gray-50 dark:hover:bg-slate-700 transition",disabled:p,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition disabled:bg-gray-400",disabled:p,children:p?"Saving...":"Save"})]})]})]})}):null}function w(){const{branchId:n}=r(),{currentBranchId:d}=l(),m=n||d||"",{groups:w,setGroups:N,isLoading:v,setLoading:k}=i(),[M,C]=a.useState(!1),[S,E]=a.useState(),[G,T]=a.useState(null);a.useEffect(()=>{F()},[m]);const F=async()=>{try{k(!0);const e=await o(m);N(e)}catch(e){t.error(e.message||"Failed to load groups")}finally{k(!1)}},I=()=>{E(void 0),C(!0)};return v?e.jsx(x,{children:e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6",children:e.jsx(s.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0},children:e.jsx(p,{className:"w-8 h-8 text-primary"})})})}):e.jsxs(x,{children:[e.jsxs("div",{className:"px-4 md:px-8 py-8 w-full",children:[e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex items-center justify-between mb-8 flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:e.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Groups"})}),e.jsxs("p",{className:"text-muted-foreground",children:[w.length," groups in this branch"]})]}),e.jsx(g,{variant:"primary",size:"lg",onClick:I,children:"New Group"})]}),0===w.length?e.jsxs(u,{className:"text-center py-16",children:[e.jsx("div",{className:"mb-6",children:e.jsx(h,{className:"w-16 h-16 text-muted-foreground/50 mx-auto"})}),e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-3",children:"No Groups Yet"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Create your first group to start organizing your congregation."}),e.jsx(g,{variant:"primary",onClick:I,children:"Create First Group"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:w.map((a,r)=>e.jsx(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*r},children:e.jsxs(u,{variant:"default",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4 flex-wrap gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:a.name}),a.description&&e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:a.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"secondary",onClick:()=>(e=>{E(e),C(!0)})(a),children:e.jsx(b,{className:"w-4 h-4"})}),e.jsx(g,{variant:"danger",onClick:()=>T(a.id),children:e.jsx(f,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2 mb-6 pb-6 border-b border-border/40",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"Members"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:a.memberCount})]}),a.welcomeMessageEnabled&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"Welcome Message"}),e.jsx("p",{className:"text-sm text-green-400 font-medium",children:"Enabled"})]})]}),e.jsx(g,{variant:"secondary",onClick:()=>window.location.href=`/members?groupId=${a.id}`,fullWidth:!0,children:"Manage Members"})]})},a.id))})]}),G&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:e.jsx(s.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},children:e.jsxs(u,{className:"max-w-sm w-full",children:[e.jsxs("div",{className:"flex gap-3 items-start mb-4",children:[e.jsx(j,{className:"w-6 h-6 text-red-400 flex-shrink-0"}),e.jsx("div",{children:e.jsx("h3",{className:"text-lg font-bold text-foreground",children:"Delete Group?"})})]}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"This will delete the group and remove all members. This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(g,{variant:"secondary",onClick:()=>T(null),fullWidth:!0,children:"Cancel"}),e.jsx(g,{variant:"danger",onClick:()=>(async e=>{try{await c(e),t.success("Group deleted successfully"),T(null),await F()}catch(s){t.error(s.message||"Failed to delete group")}})(G),fullWidth:!0,children:"Delete"})]})]})})}),e.jsx(y,{isOpen:M,group:S,branchId:m,onClose:()=>{C(!1),E(void 0)},onSuccess:e=>{N(S?w.map(s=>s.id===e.id?e:s):[e,...w])}})]})}export{w as GroupsPage,w as default};
