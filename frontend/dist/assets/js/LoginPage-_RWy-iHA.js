import{j as e}from"./vendor-ui-DmDBw7yB.js";import{u as s,a as r,L as a}from"./vendor-react-GajVb7Yi.js";import{u as t}from"./index.esm-BdG2FjqQ.js";import{u as i,f as o,C as n,I as l,B as d,l as c,_ as m}from"./index-COCz0xEy.js";import{B as u}from"./BackButton-BSAgzkKw.js";import{A as p}from"./AnimatedBlobs-CcUmiRey.js";import"./vendor-utils-DLLPIWmj.js";function h(){const h=s(),{setAuth:g}=i(),[x,f]=r.useState(!1);r.useEffect(()=>{o().catch(()=>{})},[]);const{register:b,handleSubmit:v,formState:{errors:j}}=t({mode:"onBlur",defaultValues:{email:"",password:""}});return e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsx(p,{variant:"minimal"}),e.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-primary opacity-10 rounded-full blur-3xl pointer-events-none"}),e.jsxs("div",{className:"w-full max-w-md relative z-10 animate-fadeIn",children:[e.jsx("div",{className:"mb-6",children:e.jsx(u,{variant:"ghost",size:"sm"})}),e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("img",{src:"/logo.svg",alt:"Koinonia",className:"w-16 h-16 hover:opacity-80 transition-opacity"})}),e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-3 tracking-tight",children:"Welcome Back"}),e.jsx("p",{className:"text-lg text-muted-foreground font-light",children:"Church SMS Communication Platform"})]}),e.jsxs(n,{variant:"default",className:"p-8 border border-border bg-card shadow-lg",children:[e.jsxs("form",{onSubmit:v(async e=>{try{f(!0);try{const s=await c(e);if(s.mfaRequired)return m.error("MFA verification required. Please contact support for now."),void f(!1);const{admin:r,church:a,accessToken:t,refreshToken:i}=s.data;if(!(r&&a&&t&&i))return m.error("Invalid login response. Please try again."),void f(!1);g(r,a,t,i),h("/dashboard",{replace:!0}),m.success("Login successful!")}catch(s){if(f(!1),429===s.response?.status){const e=s.response?.headers?.["ratelimit-reset"];if(e){const s=1e3*parseInt(e),r=Date.now(),a=Math.ceil((s-r)/1e3),t=Math.ceil(a/60),i=`Too many login attempts. Please try again in ${t} minute${t>1?"s":""}.`;m.error(i,{duration:5e3})}else m.error("Too many login attempts. Please try again in 15 minutes.")}else if(401===s.response?.status)m.error("Invalid email or password. Please check your credentials and try again.");else{const e=s.response?.data?.error;e&&(e.includes("Invalid")||e.includes("prisma")||e.includes("database"))?m.error("An error occurred. Please try again in a moment."):m.error(e||"Login failed. Please try again.")}}}catch(r){f(!1)}}),className:"space-y-5",children:[e.jsx("div",{children:e.jsx(l,{label:"Email Address",type:"email",placeholder:"pastor@church.com",disabled:x,error:j.email?.message,autoComplete:"email",...b("email",{required:"Email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email format"}}),className:"bg-muted border-border text-foreground"})}),e.jsx("div",{children:e.jsx(l,{label:"Password",type:"password",placeholder:"••••••••",disabled:x,error:j.password?.message,autoComplete:"current-password",...b("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters"}}),className:"bg-muted border-border text-foreground"})}),e.jsx(d,{type:"submit",variant:"primary",size:"lg",fullWidth:!0,isLoading:x,disabled:x,className:"font-semibold mt-6 bg-primary hover:bg-primary/90 text-background",children:x?"Logging in...":"Login"})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-border",children:e.jsxs("p",{className:"text-center text-muted-foreground text-sm",children:["Don't have an account?"," ",e.jsx(a,{to:"/register","data-testid":"signup-link",className:"text-primary hover:text-primary/80 font-semibold transition-colors",children:"Sign up"})]})})]}),e.jsxs("div",{className:"mt-8 flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[e.jsx("svg",{className:"w-4 h-4 text-success-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 111.414 1.414L7.414 8l3.293 3.293a1 1 0 11-1.414 1.414l-4-4z",clipRule:"evenodd"})}),e.jsx("span",{children:"Secure login • No password stored"})]})]})]})}export{h as LoginPage,h as default};
