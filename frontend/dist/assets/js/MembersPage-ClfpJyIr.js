import{j as e,m as t}from"./vendor-ui-DhbhiCKM.js";import{a as s,h as r}from"./vendor-react-DC7Nk3dg.js";import{_ as a,u as l,a as d,I as i}from"./index-CE_LJGeA.js";import{u as o}from"./groupStore-nsP9i8Bn.js";import{a as n,i as m,g as c,r as x}from"./members-DlbQh0Oz.js";import{g as u}from"./groups-C4DHzcHU.js";import{u as p}from"./index.esm-C8Q_B5eL.js";import{a as h,S as f}from"./SoftLayout-Cpbz9AXP.js";import{S as b}from"./SoftButton-Dr7nJZFM.js";import{L as g,U as y,n as j}from"./vendor-utils-C8GUPZyx.js";function N({isOpen:t,groupId:r,onClose:l,onSuccess:d}){const{register:i,handleSubmit:o,reset:m,formState:{errors:c}}=p({defaultValues:{firstName:"",lastName:"",phone:"",email:""}}),[x,u]=s.useState(!1);return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg max-w-md w-full mx-4 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Add Member"}),e.jsxs("form",{onSubmit:o(async e=>{try{u(!0);const t=e.firstName?.trim(),s=e.lastName?.trim(),i=e.phone?.trim();if(!t||!s||!i)return void a.error("First name, last name, and phone are required");const o=await n(r,{firstName:t,lastName:s,phone:i,email:e.email?.trim()||void 0});a.success("Member added successfully"),d(o),m(),l()}catch(t){a.error(t.message||"Failed to add member")}finally{u(!1)}}),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["First Name * ",c.firstName&&e.jsx("span",{className:"text-red-500",children:"Required"})]}),e.jsx("input",{type:"text",...i("firstName",{required:"First name is required"}),autoComplete:"given-name",className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"John"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Last Name * ",c.lastName&&e.jsx("span",{className:"text-red-500",children:"Required"})]}),e.jsx("input",{type:"text",...i("lastName",{required:"Last name is required"}),autoComplete:"family-name",className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Doe"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Phone Number * ",c.phone&&e.jsx("span",{className:"text-red-500",children:"Required"})]}),e.jsx("input",{type:"tel",...i("phone",{required:"Phone is required"}),autoComplete:"tel",className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"(202) 555-0173"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Any phone format"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email (Optional)"}),e.jsx("input",{type:"email",...i("email"),autoComplete:"email",className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"john@example.com"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-700 dark:text-gray-300 font-medium hover:bg-gray-50 dark:hover:bg-slate-700 transition",disabled:x,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition disabled:bg-gray-400",disabled:x,children:x?"Adding...":"Add Member"})]})]})]})}):null}function v({isOpen:t,groupId:r,onClose:l,onSuccess:d}){const[i,o]=s.useState(!1),[n,c]=s.useState(null),[x,u]=s.useState(null);return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg max-w-md w-full mx-4 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Import Members from CSV"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select CSV File"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-slate-600 rounded-lg p-6 text-center hover:border-blue-400 dark:hover:border-blue-500 transition dark:bg-slate-700",children:[e.jsx("input",{type:"file",accept:".csv",onChange:e=>{const t=e.target.files?.[0];if(t){if(!t.name.toLowerCase().endsWith(".csv"))return void a.error("Please select a CSV file");c(t),u(null)}},className:"hidden",id:"csv-upload",disabled:i}),e.jsx("label",{htmlFor:"csv-upload",className:"cursor-pointer",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:n?`âœ“ ${n.name}`:"Click to select CSV file"})})]})]}),e.jsx("button",{type:"button",onClick:()=>{const e=new Blob(["firstName,lastName,phone,email\nJohn,Doe,2025550173,john@example.com\nJane,Smith,202-555-0174,jane@example.com\nRobert,Johnson,(202) 555-0175,robert@example.com"],{type:"text/csv"}),t=window.URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="members_template.csv",s.click()},className:"w-full text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium",children:"ðŸ“¥ Download CSV Template"}),e.jsxs("div",{className:"bg-blue-50 dark:bg-slate-700 border border-blue-200 dark:border-slate-600 rounded-lg p-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"CSV Format:"}),e.jsx("p",{className:"font-mono text-xs",children:"firstName,lastName,phone,email"}),e.jsxs("p",{className:"text-xs mt-2 text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Required:"})," firstName, lastName, phone (US format: (202) 555-0173, 202-555-0173, or 2025550173)"]}),e.jsxs("p",{className:"text-xs mt-1 text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Optional:"})," email"]})]}),x&&e.jsxs("div",{className:"bg-gray-50 dark:bg-slate-700 border border-gray-200 dark:border-slate-600 rounded-lg p-3 text-sm",children:[e.jsxs("p",{className:"font-medium text-green-700 dark:text-green-400",children:["âœ“ ",x.imported," imported"]}),x.failed>0&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-medium text-red-700 dark:text-red-400",children:["âœ— ",x.failed," failed"]}),x.failedDetails?.slice(0,3).map((t,s)=>e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:["Row ",s+1,": ",t.error]},s)),x.failedDetails?.length>3&&e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400",children:["+",x.failedDetails.length-3," more errors"]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-700 dark:text-gray-300 font-medium hover:bg-gray-50 dark:hover:bg-slate-700 transition",disabled:i,children:"Close"}),e.jsx("button",{type:"button",onClick:async()=>{if(n)try{o(!0);const e=await m(r,n);u(e),e.imported>0&&(a.success(`${e.imported} members imported successfully`),d()),e.failed>0&&a.error(`${e.failed} rows failed to import`)}catch(e){const t=e.response?.data?.error||e.message||"Failed to import members",s=e.response?.data?.failedDetails;s&&Array.isArray(s)?(u({imported:0,failed:s.length,failedDetails:s.map(e=>({...e,error:e.errors?.join("; ")||e.error||"Unknown error"}))}),a.error(`Validation failed: ${t}`)):a.error(t)}finally{o(!1)}else a.error("Please select a file")},disabled:!n||i,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition disabled:bg-gray-400",children:i?"Importing...":"Import"})]})]})]})}):null}function k(){const n=l(),{branches:m}=d(),{groups:p,setGroups:k}=o(),[w]=r(),[S,C]=s.useState(!p.length),I=w.get("groupId")||p[0]?.id||"",[A,F]=s.useState([]),[M,q]=s.useState(!1),[R,D]=s.useState(""),[O,V]=s.useState(1),[L,P]=s.useState(0),[$,E]=s.useState(!1),[U,z]=s.useState(!1),[J,B]=s.useState(null),T=Math.ceil(L/50),H=p.find(e=>e.id===I);s.useEffect(()=>{if(!p.length&&n.church?.id&&m.length>0){(async()=>{try{const e=m[0],t=await u(e.id);k(t)}catch(e){}finally{C(!1)}})()}else C(!1)},[n.church?.id,m,p.length,k]),s.useEffect(()=>{const e=setTimeout(()=>{_()},500);return()=>clearTimeout(e)},[I,O,R]);const _=async()=>{if(I)try{q(!0);const e=await c(I,{page:O,limit:50,search:R||void 0});F(e.data),P(e.pagination.total)}catch(e){a.error(e.message||"Failed to load members")}finally{q(!1)}};return S||!H?e.jsx(h,{children:e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6",children:S?e.jsx(t.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0},children:e.jsx(g,{className:"w-8 h-8 text-primary"})}):e.jsx(f,{className:"text-center max-w-md",children:e.jsx("p",{className:"text-foreground/80 text-lg",children:"No group selected. Create or select a group first."})})})}):e.jsxs(h,{children:[e.jsxs("div",{className:"px-4 md:px-8 py-8 w-full",children:[e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:e.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Members"})}),e.jsxs("p",{className:"text-muted-foreground",children:[H.name," â€¢ ",L," members"]})]}),e.jsx(b,{variant:"primary",size:"lg",onClick:()=>E(!0),children:"Add Member"})]}),e.jsxs("div",{className:"flex gap-4 items-center flex-wrap",children:[e.jsx(i,{type:"text",placeholder:"Search by name, phone, or email...",value:R,onChange:e=>{D(e.target.value),V(1)},className:"flex-1 min-w-xs"}),e.jsx(b,{variant:"secondary",size:"md",onClick:()=>z(!0),children:"Import CSV"})]})]}),M?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(t.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0},children:e.jsx(g,{className:"w-8 h-8 text-primary"})})}):0===A.length?e.jsxs(f,{className:"text-center py-16",children:[e.jsx("div",{className:"mb-6",children:e.jsx(y,{className:"w-16 h-16 text-muted-foreground/50 mx-auto"})}),e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-3",children:R?"No Results":"No Members Yet"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:R?"No members found matching your search":"Add your first member to get started"}),!R&&e.jsx(b,{variant:"primary",onClick:()=>E(!0),children:"Add First Member"})]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"default",className:"overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"border-b border-border/40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Name"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Phone"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Email"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Added"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border/40",children:A.map((s,r)=>e.jsxs(t.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*r},className:"hover:bg-muted/30 transition-colors duration-normal",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-medium text-foreground",children:[s.firstName," ",s.lastName]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:s.phone})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email||"â€”"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-block px-3 py-1 text-xs font-semibold rounded-lg "+(s.optInSms?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"),children:s.optInSms?"Opted In":"Opted Out"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs(t.button,{whileHover:{scale:1.05},onClick:()=>(async(e,t)=>{if(window.confirm(`Are you sure you want to remove ${t} from this group?`))try{B(e),await x(I,e),F(A.filter(t=>t.id!==e)),P(L-1),a.success("Member removed successfully")}catch(s){a.error(s.message||"Failed to remove member")}finally{B(null)}})(s.id,`${s.firstName} ${s.lastName}`),disabled:J===s.id,className:"text-red-400 hover:text-red-300 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium transition-colors flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4"}),J===s.id?"Removing...":"Remove"]})})]},s.id))})]})})}),T>1&&e.jsxs("div",{className:"mt-8 flex justify-center gap-2 items-center",children:[e.jsx(b,{variant:"secondary",onClick:()=>V(Math.max(1,O-1)),disabled:1===O,children:"Previous"}),e.jsxs("div",{className:"px-4 py-2 text-muted-foreground font-medium",children:["Page ",O," of ",T]}),e.jsx(b,{variant:"secondary",onClick:()=>V(Math.min(T,O+1)),disabled:O===T,children:"Next"})]})]})]}),e.jsx(N,{isOpen:$,groupId:I,onClose:()=>E(!1),onSuccess:e=>{F([e,...A]),P(L+1),E(!1)}}),e.jsx(v,{isOpen:U,groupId:I,onClose:()=>z(!1),onSuccess:()=>{V(1),_(),z(!1)}})]})}export{k as MembersPage,k as default};
