import{j as e,A as s,m as r}from"./vendor-ui-DmDBw7yB.js";import{a as t}from"./vendor-react-GajVb7Yi.js";import{u as a,a as n,C as i,l as o,E as d}from"./react-stripe.esm-Bb9JIkK3.js";import{F as l,s as c,e as m,f as u,p as x}from"./focus-trap-react-T-2iBaXT.js";import{B as p,_ as h}from"./index-BPwADyyg.js";import{p as f,X as b,L as g}from"./vendor-utils-DyFjxm_c.js";import"./vendor-charts-D9m5HzY1.js";const y={style:{base:{fontSize:"14px",color:"var(--foreground)","::placeholder":{color:"var(--muted-foreground)"},fontFamily:"system-ui, -apple-system, sans-serif"},invalid:{color:"#ff4444"}}};function v({amount:s,phoneNumber:r,paymentIntentId:o,onSuccess:d,onError:l,isLoading:c=!1,paymentStatus:m="idle",paymentMessage:u=""}){const x=a(),f=n(),[b,g]=t.useState(!1);return e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),x&&f){g(!0);try{const e=f.getElement(i);if(!e)throw new Error("Card element not found");const{error:s,paymentMethod:r}=await x.createPaymentMethod({type:"card",card:e,billing_details:{}});if(s)return h.error(s.message||"Failed to process card"),l?.(s.message||"Failed to process card"),void g(!1);if(!r)throw new Error("No payment method returned");d(r.id)}catch(s){const e=s.message||"Payment processing failed";h.error(e),l?.(e)}finally{g(!1)}}else h.error("Payment system not initialized")},className:"space-y-4",children:[e.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-foreground mb-2",children:["Payment for ",r]}),e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["$",(s/100).toFixed(2)]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"One-time setup fee"})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Card Details"}),e.jsx("div",{className:"p-3 border border-border rounded-lg bg-muted",children:e.jsx(i,{options:y})})]})}),"idle"!==m&&e.jsxs("div",{className:"p-4 rounded-lg border text-center "+("success"===m?"bg-green-500/10 border-green-500/20 text-green-700":"declined"===m||"failed"===m?"bg-red-500/10 border-red-500/20 text-red-700":"bg-blue-500/10 border-blue-500/20 text-blue-700"),children:["success"===m&&"âœ“ Payment Successful","declined"===m&&"âœ— Card Declined","failed"===m&&"âœ— Payment Failed","processing"===m&&"â³ Processing...",u&&e.jsx("div",{className:"text-sm mt-1",children:u})]}),e.jsx("div",{className:"text-xs text-muted-foreground bg-blue-500/10 border border-blue-500/20 rounded-lg p-3",children:"ðŸ”’ Payment is processed securely by Stripe. Your card details are encrypted and never stored on our servers."}),e.jsx("div",{className:"space-y-2",children:e.jsx(p,{type:"submit",variant:"primary",fullWidth:!0,size:"lg",disabled:!x||b||c,isLoading:b||c,className:"bg-primary hover:bg-primary/90 text-background font-medium",children:b?"Processing...":"Complete Purchase"})})]})}const j=[{code:"CA",name:"California"},{code:"NY",name:"New York"},{code:"TX",name:"Texas"},{code:"FL",name:"Florida"},{code:"IL",name:"Illinois"},{code:"PA",name:"Pennsylvania"},{code:"OH",name:"Ohio"},{code:"GA",name:"Georgia"},{code:"MI",name:"Michigan"},{code:"NC",name:"North Carolina"}];function N({isOpen:a,onClose:n,onPurchaseComplete:i}){const[y,N]=t.useState("search"),[w,S]=t.useState(""),[k,C]=t.useState(""),[P,L]=t.useState([]),[E,F]=t.useState(null),[I,M]=t.useState(!1),[z,D]=t.useState(null),[O,$]=t.useState("idle"),[A,B]=t.useState(""),[W,T]=t.useState(!1),R=t.useRef(null);t.useEffect(()=>{"payment"!==y||R.current||(T(!0),R.current=o("pk_live_51SNi09E7LiXbMhWDr4X7EtXptIiMS3xAZgkdIfdjgf18XMQpSpt2OY47nmuv7hGSMCehvRDLawh9bDSsLto5D0jS00A7xoe8Ut"),R.current.then(()=>{T(!1)}).catch(e=>{T(!1),h.error("Failed to load payment system")}))},[y]),t.useEffect(()=>{if(!a)return;const e=e=>{"Escape"===e.key&&"processing"!==O&&n()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a,n,O]);const X=()=>{N("search"),S(""),C(""),L([]),F(null),D(null),$("idle"),B("")},Y={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{duration:.3,type:"tween"}}};return e.jsx(s,{children:a&&e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4 backdrop-blur-md pointer-events-none",children:e.jsx(l,{focusTrapOptions:{escapeDeactivates:"processing"!==O,clickOutsideDeactivates:"processing"!==O},children:e.jsxs(r.div,{initial:{opacity:0,scale:.92,y:30},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.92,y:30},transition:{duration:.4,ease:"easeOut"},className:"bg-background border border-border/50 rounded-2xl shadow-2xl max-w-2xl w-full overflow-hidden pointer-events-auto",role:"dialog","aria-modal":"true","aria-labelledby":"phone-modal-title",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-primary/5 border-b border-border/30 p-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/20 rounded-lg",children:e.jsx(f,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{id:"phone-modal-title",className:"text-lg font-semibold text-foreground",children:"Buy Phone Number"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["search"===y&&"Search available numbers","select"===y&&"Choose a number","confirm"===y&&"Confirm purchase","payment"===y&&"Complete payment"]})]})]}),e.jsx(r.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:n,disabled:I,className:"w-11 h-11 flex items-center justify-center hover:bg-muted rounded-lg transition-colors disabled:opacity-50","aria-label":"Close modal (Escape key also works)",children:e.jsx(b,{className:"w-5 h-5 text-muted-foreground"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs(r.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.1}}},initial:"hidden",animate:"visible",children:["search"===y&&e.jsxs(r.div,{variants:Y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Area Code"}),e.jsx("input",{type:"text",placeholder:"e.g., 415, 212, 310",value:w,onChange:e=>S(e.target.value),maxLength:3,className:"w-full px-3 py-2 border border-border/50 rounded-lg bg-background text-foreground placeholder-muted-foreground focus:border-primary focus:outline-none transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"State (Optional)"}),e.jsxs("select",{value:k,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-border/50 rounded-lg bg-background text-foreground focus:border-primary focus:outline-none transition-colors appearance-none",style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 9L1 4h10z'/%3E%3C/svg%3E\")",backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",paddingRight:"2rem"},children:[e.jsx("option",{value:"",children:"Select a state..."}),j.map(s=>e.jsx("option",{value:s.code,children:s.name},s.code))]})]}),e.jsx(p,{variant:"primary",fullWidth:!0,size:"lg",onClick:async()=>{if(w||k){M(!0);try{const e=await c({areaCode:w||void 0,state:k||void 0,quantity:10});0===e.length?(h.error("No numbers found for that search"),L([])):(L(e),N("select"))}catch(e){h.error(e.message||"Failed to search numbers")}finally{M(!1)}}else h.error("Please enter an area code or select a state")},disabled:I,isLoading:I,className:"bg-primary hover:bg-primary/90 text-background font-medium mt-6",children:I?"Searching...":"Search Numbers"})]}),"select"===y&&e.jsxs(r.div,{variants:Y,className:"space-y-3",children:[e.jsx("div",{className:"space-y-2 max-h-72 overflow-y-auto",children:P.map(s=>e.jsx(r.button,{whileHover:{scale:1.02},onClick:()=>(async e=>{F(e),N("confirm")})(s),className:"w-full p-4 border-2 border-border/30 rounded-lg bg-muted/20 hover:border-primary/50 hover:bg-primary/5 transition-all text-left group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-foreground text-lg",children:s.formattedNumber}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s.region})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-foreground",children:["$",s.costPerSms.toFixed(4),"/SMS"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["$",s.costPerMinute.toFixed(4),"/min"]})]})]})},s.id))}),e.jsx(p,{variant:"secondary",fullWidth:!0,size:"sm",onClick:()=>{N("search"),L([]),F(null)},className:"mt-4",children:"Back to Search"})]}),"confirm"===y&&E&&e.jsxs(r.div,{variants:Y,className:"space-y-4",children:[e.jsx("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(f,{className:"w-8 h-8 text-primary mx-auto mb-3"}),e.jsx("div",{className:"text-2xl font-bold text-foreground mb-1",children:E.formattedNumber}),e.jsx("div",{className:"text-sm text-muted-foreground",children:E.region})]})}),e.jsxs("div",{className:"space-y-2 bg-muted/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Per SMS:"}),e.jsxs("span",{className:"font-medium text-foreground",children:["$",E.costPerSms.toFixed(4)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Per minute:"}),e.jsxs("span",{className:"font-medium text-foreground",children:["$",E.costPerMinute.toFixed(4)]})]}),e.jsxs("div",{className:"border-t border-border/30 pt-2 mt-2 flex justify-between font-semibold",children:[e.jsx("span",{className:"text-foreground",children:"One-time setup:"}),e.jsx("span",{className:"text-primary",children:"$0.50"})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:"By purchasing, you agree to Telnyx's terms and will be charged the one-time setup fee. Usage charges apply separately."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{variant:"primary",fullWidth:!0,size:"lg",onClick:async()=>{if(E){M(!0);try{const e=await m(E.phoneNumber);if(!e.success||!e.data?.paymentIntentId)throw new Error("Failed to create payment intent");D(e.data.paymentIntentId),N("payment")}catch(e){h.error(e.message||"Failed to create payment intent")}finally{M(!1)}}},disabled:I,isLoading:I,className:"bg-primary hover:bg-primary/90 text-background font-medium",children:I?"Processing...":"Continue to Payment"}),e.jsx(p,{variant:"secondary",fullWidth:!0,size:"sm",onClick:()=>{N("select"),F(null)},disabled:I,children:"Choose Different Number"})]})]}),"payment"===y&&E&&z&&e.jsxs(r.div,{variants:Y,className:"space-y-4",children:[W?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(g,{className:"w-8 h-8 text-primary animate-spin mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading payment system..."})]}):R.current?e.jsx(d,{stripe:R.current,children:e.jsx(v,{amount:50,phoneNumber:E.phoneNumber,paymentIntentId:z,onSuccess:async e=>{if(E&&z){M(!0),$("processing"),B("");try{const s=await u(z,e);if(!s.success||"succeeded"!==s.data?.status)return $("failed"),B("Payment confirmation failed. Please try again."),void M(!1);const r=await x(E.phoneNumber,z);r.success&&($("success"),B(""),setTimeout(()=>{const e=r.data.webhookId?"automatically linked with webhook":"linked (webhook manual setup recommended)";h.success(`Successfully purchased ${E.formattedNumber}! Number ${e}.`),i&&i(E.phoneNumber),X(),n()},1500))}catch(s){let e="Payment processing failed";402===s.response?.status?e=s.response?.data?.error||"Request failed with status code 402":s.message&&(e=s.message);const r=e.toLowerCase().includes("declined")||e.toLowerCase().includes("insufficient");$(r?"declined":"failed"),B(e),M(!1)}}},isLoading:I,paymentStatus:O,paymentMessage:A})}):e.jsx("div",{className:"text-center py-8 text-red-500",children:"Failed to load payment system. Please try again."}),e.jsx(p,{variant:"secondary",fullWidth:!0,size:"sm",onClick:()=>{N("confirm"),$("idle"),B("")},disabled:I||W,children:"Back"})]})]})})]})})})})}export{N as default};
