import{i as S,r as m,j as e,_ as h,m as L,C as k,B as N,I as A,S as P}from"./index-C0qRrIwJ.js";import{u as O}from"./groupStore-Bv1QgCNL.js";import{u as E}from"./index.esm-Dj5FqAfV.js";import{B as z}from"./BackButton-CBljWYrD.js";async function R(d,a={}){const l=new URLSearchParams;return a.page&&l.append("page",a.page.toString()),a.limit&&l.append("limit",a.limit.toString()),a.search&&l.append("search",a.search),(await S.get(`/groups/${d}/members?${l.toString()}`)).data}async function V(d,a){return(await S.post(`/groups/${d}/members`,a)).data.data}async function $(d,a){const l=new FormData;return l.append("file",a),(await S.post(`/groups/${d}/members/import`,l)).data.data}function B({isOpen:d,groupId:a,onClose:l,onSuccess:o}){const{register:n,handleSubmit:f,reset:p}=E(),[u,t]=m.useState(!1),b=async i=>{try{t(!0);const c=await V(a,{firstName:i.firstName,lastName:i.lastName,phone:i.phone,email:i.email||void 0});h.success("Member added successfully"),o(c),p(),l()}catch(c){h.error(c.message||"Failed to add member")}finally{t(!1)}};return d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full mx-4 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Add Member"}),e.jsxs("form",{onSubmit:f(b),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name *"}),e.jsx("input",{type:"text",...n("firstName",{required:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"John"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name *"}),e.jsx("input",{type:"text",...n("lastName",{required:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Doe"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number *"}),e.jsx("input",{type:"tel",...n("phone",{required:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"(202) 555-0173"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Any phone format"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email (Optional)"}),e.jsx("input",{type:"email",...n("email"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"john@example.com"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition",disabled:u,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition disabled:bg-gray-400",disabled:u,children:u?"Adding...":"Add Member"})]})]})]})}):null}function q({isOpen:d,groupId:a,onClose:l,onSuccess:o}){const[n,f]=m.useState(!1),[p,u]=m.useState(null),[t,b]=m.useState(null),i=r=>{const x=r.target.files?.[0];if(x){if(!x.name.toLowerCase().endsWith(".csv")){h.error("Please select a CSV file");return}u(x),b(null)}},c=async()=>{if(!p){h.error("Please select a file");return}try{f(!0);const r=await $(a,p);b(r),r.imported>0&&(h.success(`${r.imported} members imported successfully`),o()),r.failed>0&&h.error(`${r.failed} rows failed to import`)}catch(r){h.error(r.message||"Failed to import members")}finally{f(!1)}},y=()=>{const r=`firstName,lastName,phone,email
John,Doe,(202) 555-0173,john@example.com`,x=new Blob([r],{type:"text/csv"}),g=window.URL.createObjectURL(x),j=document.createElement("a");j.href=g,j.download="members_template.csv",j.click()};return d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full mx-4 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Import Members from CSV"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select CSV File"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition",children:[e.jsx("input",{type:"file",accept:".csv",onChange:i,className:"hidden",id:"csv-upload",disabled:n}),e.jsx("label",{htmlFor:"csv-upload",className:"cursor-pointer",children:e.jsx("p",{className:"text-gray-600",children:p?`âœ“ ${p.name}`:"Click to select CSV file"})})]})]}),e.jsx("button",{type:"button",onClick:y,className:"w-full text-sm text-blue-600 hover:text-blue-700 font-medium",children:"ðŸ“¥ Download CSV Template"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm text-gray-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"CSV Format:"}),e.jsx("p",{className:"font-mono text-xs",children:"firstName,lastName,phone,email"}),e.jsx("p",{className:"text-xs mt-2 text-gray-600",children:"Email is optional. Phone accepts any format."})]}),t&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm",children:[e.jsxs("p",{className:"font-medium text-green-700",children:["âœ“ ",t.imported," imported"]}),t.failed>0&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-medium text-red-700",children:["âœ— ",t.failed," failed"]}),t.failedDetails?.slice(0,3).map((r,x)=>e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Row ",x+1,": ",r.error]},x)),t.failedDetails?.length>3&&e.jsxs("p",{className:"text-xs text-red-600",children:["+",t.failedDetails.length-3," more errors"]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition",disabled:n,children:"Close"}),e.jsx("button",{type:"button",onClick:c,disabled:!p||n,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition disabled:bg-gray-400",children:n?"Importing...":"Import"})]})]})]})}):null}function J(){const{groups:d,setLoading:a}=O(),[l]=L(),o=l.get("groupId")||d[0]?.id||"",[n,f]=m.useState([]),[p,u]=m.useState(!1),[t,b]=m.useState(""),[i,c]=m.useState(1),[y,r]=m.useState(0),[x,g]=m.useState(!1),[j,w]=m.useState(!1),C=50,v=Math.ceil(y/C),M=d.find(s=>s.id===o);m.useEffect(()=>{I()},[o,i,t]);const I=async()=>{if(o)try{u(!0);const s=await R(o,{page:i,limit:C,search:t||void 0});f(s.data),r(s.pagination.total)}catch(s){h.error(s.message||"Failed to load members")}finally{u(!1)}},D=s=>{f([s,...n]),r(y+1),g(!1)},F=()=>{c(1),I(),w(!1)};return M?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 dark:from-primary-900 to-primary-100 dark:to-primary-950 p-6 transition-colors duration-normal",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsx(z,{variant:"ghost"})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-primary-900 dark:text-primary-50 mb-2",children:"ðŸ‘¤ Members"}),e.jsxs("p",{className:"text-primary-600 dark:text-primary-400",children:[M.name," â€¢ ",y," members"]})]}),e.jsx(N,{variant:"primary",size:"lg",onClick:()=>g(!0),children:"+ Add Member"})]}),e.jsxs("div",{className:"flex gap-4 items-center flex-wrap",children:[e.jsx(A,{type:"text",placeholder:"Search by name, phone, or email...",value:t,onChange:s=>{b(s.target.value),c(1)},className:"flex-1 min-w-xs"}),e.jsx(N,{variant:"primary",size:"md",onClick:()=>w(!0),children:"ðŸ“¥ Import CSV"})]})]}),p?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(P,{size:"lg",text:"Loading members..."})}):n.length===0?e.jsxs(k,{variant:"highlight",className:"text-center py-16",children:[e.jsx("div",{className:"mb-6",children:e.jsx("span",{className:"text-6xl",children:"ðŸ‘¤"})}),e.jsx("h2",{className:"text-2xl font-bold text-primary-900 dark:text-primary-50 mb-3",children:t?"No Results":"No Members Yet"}),e.jsx("p",{className:"text-primary-600 dark:text-primary-400 mb-6 max-w-md mx-auto",children:t?"No members found matching your search":"Add your first member to get started"}),!t&&e.jsx(N,{variant:"primary",size:"md",onClick:()=>g(!0),children:"Add First Member"})]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"default",className:"overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-primary-100 dark:bg-primary-800 border-b border-primary-200 dark:border-primary-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-primary-900 dark:text-primary-50",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-primary-900 dark:text-primary-50",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-primary-900 dark:text-primary-50",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-primary-900 dark:text-primary-50",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-primary-900 dark:text-primary-50",children:"Added"})]})}),e.jsx("tbody",{className:"divide-y divide-primary-200 dark:divide-primary-700",children:n.map(s=>e.jsxs("tr",{className:"hover:bg-primary-50 dark:hover:bg-primary-700/50 transition-colors duration-normal",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-medium text-primary-900 dark:text-primary-50",children:[s.firstName," ",s.lastName]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-primary-600 dark:text-primary-400",children:s.phone})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-primary-600 dark:text-primary-400",children:s.email||"â€”"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-block px-3 py-1 text-xs font-semibold rounded-full ${s.optInSms?"bg-success-100 dark:bg-success-900 text-success-800 dark:text-success-200":"bg-danger-100 dark:bg-danger-900 text-danger-800 dark:text-danger-200"}`,children:s.optInSms?"âœ… Opted In":"âŒ Opted Out"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-primary-600 dark:text-primary-400",children:new Date(s.createdAt).toLocaleDateString()})]},s.id))})]})})}),v>1&&e.jsxs("div",{className:"mt-6 flex justify-center gap-2",children:[e.jsx(N,{variant:"secondary",size:"md",onClick:()=>c(Math.max(1,i-1)),disabled:i===1,children:"â† Previous"}),e.jsxs("div",{className:"px-4 py-2 text-primary-700 dark:text-primary-300 font-medium",children:["Page ",i," of ",v]}),e.jsx(N,{variant:"secondary",size:"md",onClick:()=>c(Math.min(v,i+1)),disabled:i===v,children:"Next â†’"})]})]})]}),e.jsx(B,{isOpen:x,groupId:o,onClose:()=>g(!1),onSuccess:D}),e.jsx(q,{isOpen:j,groupId:o,onClose:()=>w(!1),onSuccess:F})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 dark:from-primary-900 to-primary-100 dark:to-primary-950 flex items-center justify-center p-6",children:e.jsx(k,{variant:"default",className:"text-center max-w-md",children:e.jsx("p",{className:"text-primary-600 dark:text-primary-400 text-lg",children:"No group selected. Create or select a group first."})})})}export{J as MembersPage,J as default};
//# sourceMappingURL=MembersPage-Dcu87KQu.js.map
