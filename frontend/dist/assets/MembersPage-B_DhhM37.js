import{r as l,j as e,_ as c,a as B,d as U,o as z,I as J}from"./index-ClLBU_i0.js";import{u as _}from"./groupStore-CvfhCYqs.js";import{a as H,i as W,g as Y,r as K}from"./members-D0iGKvhT.js";import{g as Q}from"./groups-DAdCEoAl.js";import{u as X}from"./index.esm-BOsiI-OL.js";import{a as q,L as P,S as F}from"./SoftLayout-Bap_E91U.js";import{S as w}from"./SoftButton-C98q418O.js";import{m as k}from"./proxy-DTnraqVj.js";import{U as Z}from"./index-PTOf5QvV.js";import{T as ee}from"./trash-2-sY2FT4Hg.js";function te({isOpen:y,groupId:f,onClose:x,onSuccess:j}){const{register:m,handleSubmit:g,reset:u,formState:{errors:o}}=X({defaultValues:{firstName:"",lastName:"",phone:"",email:""}}),[a,p]=l.useState(!1),N=async h=>{try{p(!0);const n=h.firstName?.trim(),s=h.lastName?.trim(),r=h.phone?.trim();if(!n||!s||!r){c.error("First name, last name, and phone are required");return}const d=await H(f,{firstName:n,lastName:s,phone:r,email:h.email?.trim()||void 0});c.success("Member added successfully"),j(d),u(),x()}catch(n){c.error(n.message||"Failed to add member")}finally{p(!1)}};return y?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg max-w-md w-full mx-4 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Add Member"}),e.jsxs("form",{onSubmit:g(N),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["First Name * ",o.firstName&&e.jsx("span",{className:"text-red-500",children:"Required"})]}),e.jsx("input",{type:"text",...m("firstName",{required:"First name is required"}),autoComplete:"off",className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"John"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Last Name * ",o.lastName&&e.jsx("span",{className:"text-red-500",children:"Required"})]}),e.jsx("input",{type:"text",...m("lastName",{required:"Last name is required"}),autoComplete:"off",className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Doe"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Phone Number * ",o.phone&&e.jsx("span",{className:"text-red-500",children:"Required"})]}),e.jsx("input",{type:"tel",...m("phone",{required:"Phone is required"}),autoComplete:"off",className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"(202) 555-0173"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Any phone format"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email (Optional)"}),e.jsx("input",{type:"email",...m("email"),autoComplete:"off",className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"john@example.com"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:x,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-700 dark:text-gray-300 font-medium hover:bg-gray-50 dark:hover:bg-slate-700 transition",disabled:a,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition disabled:bg-gray-400",disabled:a,children:a?"Adding...":"Add Member"})]})]})]})}):null}function se({isOpen:y,groupId:f,onClose:x,onSuccess:j}){const[m,g]=l.useState(!1),[u,o]=l.useState(null),[a,p]=l.useState(null),N=s=>{const r=s.target.files?.[0];if(r){if(!r.name.toLowerCase().endsWith(".csv")){c.error("Please select a CSV file");return}o(r),p(null)}},h=async()=>{if(!u){c.error("Please select a file");return}try{g(!0);const s=await W(f,u);p(s),s.imported>0&&(c.success(`${s.imported} members imported successfully`),j()),s.failed>0&&c.error(`${s.failed} rows failed to import`)}catch(s){console.error("CSV Import Error:",{status:s.response?.status,statusText:s.response?.statusText,data:s.response?.data,message:s.message});const r=s.response?.data?.error||s.message||"Failed to import members",d=s.response?.data?.failedDetails;d&&Array.isArray(d)?(p({imported:0,failed:d.length,failedDetails:d.map(i=>({...i,error:i.errors?.join("; ")||i.error||"Unknown error"}))}),c.error(`Validation failed: ${r}`)):c.error(r)}finally{g(!1)}},n=()=>{const s=`firstName,lastName,phone,email
John,Doe,2025550173,john@example.com
Jane,Smith,202-555-0174,jane@example.com
Robert,Johnson,(202) 555-0175,robert@example.com`,r=new Blob([s],{type:"text/csv"}),d=window.URL.createObjectURL(r),i=document.createElement("a");i.href=d,i.download="members_template.csv",i.click()};return y?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg max-w-md w-full mx-4 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Import Members from CSV"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select CSV File"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-slate-600 rounded-lg p-6 text-center hover:border-blue-400 dark:hover:border-blue-500 transition dark:bg-slate-700",children:[e.jsx("input",{type:"file",accept:".csv",onChange:N,className:"hidden",id:"csv-upload",disabled:m}),e.jsx("label",{htmlFor:"csv-upload",className:"cursor-pointer",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:u?`âœ“ ${u.name}`:"Click to select CSV file"})})]})]}),e.jsx("button",{type:"button",onClick:n,className:"w-full text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium",children:"ðŸ“¥ Download CSV Template"}),e.jsxs("div",{className:"bg-blue-50 dark:bg-slate-700 border border-blue-200 dark:border-slate-600 rounded-lg p-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"CSV Format:"}),e.jsx("p",{className:"font-mono text-xs",children:"firstName,lastName,phone,email"}),e.jsxs("p",{className:"text-xs mt-2 text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Required:"})," firstName, lastName, phone (US format: (202) 555-0173, 202-555-0173, or 2025550173)"]}),e.jsxs("p",{className:"text-xs mt-1 text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Optional:"})," email"]})]}),a&&e.jsxs("div",{className:"bg-gray-50 dark:bg-slate-700 border border-gray-200 dark:border-slate-600 rounded-lg p-3 text-sm",children:[e.jsxs("p",{className:"font-medium text-green-700 dark:text-green-400",children:["âœ“ ",a.imported," imported"]}),a.failed>0&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-medium text-red-700 dark:text-red-400",children:["âœ— ",a.failed," failed"]}),a.failedDetails?.slice(0,3).map((s,r)=>e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:["Row ",r+1,": ",s.error]},r)),a.failedDetails?.length>3&&e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400",children:["+",a.failedDetails.length-3," more errors"]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:x,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-700 dark:text-gray-300 font-medium hover:bg-gray-50 dark:hover:bg-slate-700 transition",disabled:m,children:"Close"}),e.jsx("button",{type:"button",onClick:h,disabled:!u||m,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition disabled:bg-gray-400",children:m?"Importing...":"Import"})]})]})]})}):null}function ue(){const y=B(),{branches:f}=U(),{groups:x,setGroups:j}=_(),[m]=z(),[g,u]=l.useState(!x.length),o=m.get("groupId")||x[0]?.id||"",[a,p]=l.useState([]),[N,h]=l.useState(!1),[n,s]=l.useState(""),[r,d]=l.useState(1),[i,M]=l.useState(0),[V,S]=l.useState(!1),[T,I]=l.useState(!1),[A,L]=l.useState(null),D=50,C=Math.ceil(i/D),R=x.find(t=>t.id===o);l.useEffect(()=>{!x.length&&y.church?.id&&f.length>0?(async()=>{try{const b=f[0],v=await Q(b.id);j(v)}catch(b){console.error("Failed to load groups:",b)}finally{u(!1)}})():u(!1)},[y.church?.id,f,x.length,j]),l.useEffect(()=>{const t=setTimeout(()=>{O()},500);return()=>clearTimeout(t)},[o,r,n]);const O=async()=>{if(o)try{h(!0);const t=await Y(o,{page:r,limit:D,search:n||void 0});p(t.data),M(t.pagination.total)}catch(t){c.error(t.message||"Failed to load members")}finally{h(!1)}},E=t=>{p([t,...a]),M(i+1),S(!1)},$=()=>{d(1),O(),I(!1)},G=async(t,b)=>{if(window.confirm(`Are you sure you want to remove ${b} from this group?`))try{L(t),await K(o,t),p(a.filter(v=>v.id!==t)),M(i-1),c.success("Member removed successfully")}catch(v){c.error(v.message||"Failed to remove member")}finally{L(null)}};return g||!R?e.jsx(q,{children:e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6",children:g?e.jsx(k.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0},children:e.jsx(P,{className:"w-8 h-8 text-primary"})}):e.jsx(F,{className:"text-center max-w-md",children:e.jsx("p",{className:"text-foreground/80 text-lg",children:"No group selected. Create or select a group first."})})})}):e.jsxs(q,{children:[e.jsxs("div",{className:"px-4 md:px-8 py-8 w-full",children:[e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:e.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Members"})}),e.jsxs("p",{className:"text-muted-foreground",children:[R.name," â€¢ ",i," members"]})]}),e.jsx(w,{variant:"primary",size:"lg",onClick:()=>S(!0),children:"Add Member"})]}),e.jsxs("div",{className:"flex gap-4 items-center flex-wrap",children:[e.jsx(J,{type:"text",placeholder:"Search by name, phone, or email...",value:n,onChange:t=>{s(t.target.value),d(1)},className:"flex-1 min-w-xs"}),e.jsx(w,{variant:"secondary",size:"md",onClick:()=>I(!0),children:"Import CSV"})]})]}),N?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(k.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0},children:e.jsx(P,{className:"w-8 h-8 text-primary"})})}):a.length===0?e.jsxs(F,{className:"text-center py-16",children:[e.jsx("div",{className:"mb-6",children:e.jsx(Z,{className:"w-16 h-16 text-muted-foreground/50 mx-auto"})}),e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-3",children:n?"No Results":"No Members Yet"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:n?"No members found matching your search":"Add your first member to get started"}),!n&&e.jsx(w,{variant:"primary",onClick:()=>S(!0),children:"Add First Member"})]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{variant:"default",className:"overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"border-b border-border/40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Name"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Phone"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Email"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Added"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border/40",children:a.map((t,b)=>e.jsxs(k.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:b*.05},className:"hover:bg-muted/30 transition-colors duration-normal",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-medium text-foreground",children:[t.firstName," ",t.lastName]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:t.phone})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:t.email||"â€”"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-block px-3 py-1 text-xs font-semibold rounded-lg ${t.optInSms?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:t.optInSms?"Opted In":"Opted Out"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-muted-foreground",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs(k.button,{whileHover:{scale:1.05},onClick:()=>G(t.id,`${t.firstName} ${t.lastName}`),disabled:A===t.id,className:"text-red-400 hover:text-red-300 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium transition-colors flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),A===t.id?"Removing...":"Remove"]})})]},t.id))})]})})}),C>1&&e.jsxs("div",{className:"mt-8 flex justify-center gap-2 items-center",children:[e.jsx(w,{variant:"secondary",onClick:()=>d(Math.max(1,r-1)),disabled:r===1,children:"Previous"}),e.jsxs("div",{className:"px-4 py-2 text-muted-foreground font-medium",children:["Page ",r," of ",C]}),e.jsx(w,{variant:"secondary",onClick:()=>d(Math.min(C,r+1)),disabled:r===C,children:"Next"})]})]})]}),e.jsx(te,{isOpen:V,groupId:o,onClose:()=>S(!1),onSuccess:E}),e.jsx(se,{isOpen:T,groupId:o,onClose:()=>I(!1),onSuccess:$})]})}export{ue as MembersPage,ue as default};
//# sourceMappingURL=MembersPage-B_DhhM37.js.map
