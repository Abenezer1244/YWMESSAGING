{"version":3,"file":"SendMessagePage-qxsIGRf0.js","sources":["../../src/pages/dashboard/SendMessagePage.js"],"sourcesContent":["import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { useState, useEffect } from 'react';\nimport toast from 'react-hot-toast';\nimport useGroupStore from '../../stores/groupStore';\nimport useMessageStore from '../../stores/messageStore';\nimport { sendMessage } from '../../api/messages';\nimport { getTemplates } from '../../api/templates';\nimport TemplateFormModal from '../../components/templates/TemplateFormModal';\nimport Button from '../../components/ui/Button';\nimport Card from '../../components/ui/Card';\nexport function SendMessagePage() {\n    const { groups } = useGroupStore();\n    const { addMessage } = useMessageStore();\n    const [content, setContent] = useState('');\n    const [targetType, setTargetType] = useState('groups');\n    const [selectedGroupIds, setSelectedGroupIds] = useState([]);\n    const [isLoading, setIsLoading] = useState(false);\n    const [templates, setTemplates] = useState([]);\n    const [showSaveModal, setShowSaveModal] = useState(false);\n    useEffect(() => {\n        loadTemplates();\n    }, []);\n    const loadTemplates = async () => {\n        try {\n            const data = await getTemplates();\n            setTemplates(data);\n        }\n        catch (error) {\n            console.error('Failed to load templates:', error);\n        }\n    };\n    // Calculate segments and cost\n    const segments = Math.ceil(content.length / 160) || 0;\n    const totalCost = (segments * selectedGroupIds.length) * 0.0075;\n    const recipientCount = selectedGroupIds.reduce((sum, gId) => sum + (groups.find((g) => g.id === gId)?.memberCount || 0), 0);\n    const handleGroupToggle = (groupId) => {\n        setSelectedGroupIds((prev) => prev.includes(groupId) ? prev.filter((id) => id !== groupId) : [...prev, groupId]);\n    };\n    const handleUseTemplate = (template) => {\n        setContent(template.content);\n        toast.success(`Using template: ${template.name}`);\n    };\n    const handleSendMessage = async () => {\n        if (!content.trim()) {\n            toast.error('Please enter a message');\n            return;\n        }\n        if (targetType === 'groups' && selectedGroupIds.length === 0) {\n            toast.error('Please select at least one group');\n            return;\n        }\n        try {\n            setIsLoading(true);\n            const message = await sendMessage({\n                content: content.trim(),\n                targetType: targetType === 'all' ? 'all' : 'groups',\n                targetIds: targetType === 'all' ? undefined : selectedGroupIds,\n            });\n            addMessage(message);\n            toast.success(`Message queued for ${message.totalRecipients} recipients`);\n            setContent('');\n            setSelectedGroupIds([]);\n        }\n        catch (error) {\n            toast.error(error.message || 'Failed to send message');\n        }\n        finally {\n            setIsLoading(false);\n        }\n    };\n    return (_jsxs(\"div\", { className: \"min-h-screen bg-gradient-to-br from-secondary-50 dark:from-secondary-900 to-secondary-100 dark:to-secondary-950 p-6 transition-colors duration-normal\", children: [_jsxs(\"div\", { className: \"max-w-4xl mx-auto\", children: [_jsx(\"div\", { className: \"flex items-center justify-between mb-8\", children: _jsxs(\"div\", { children: [_jsx(\"h1\", { className: \"text-4xl font-bold text-secondary-900 dark:text-secondary-50 mb-2\", children: \"\\uD83D\\uDCE8 Send Message\" }), _jsx(\"p\", { className: \"text-secondary-600 dark:text-secondary-400\", children: \"Reach your congregation with direct SMS messages\" })] }) }), _jsxs(Card, { variant: \"default\", className: \"space-y-6\", children: [templates.length > 0 && (_jsxs(\"div\", { children: [_jsx(\"label\", { className: \"block text-sm font-semibold text-secondary-900 dark:text-secondary-50 mb-3\", children: \"\\uD83D\\uDCCB Use Template\" }), _jsxs(\"div\", { className: \"flex gap-2 flex-wrap\", children: [templates.slice(0, 6).map((template) => (_jsx(Button, { variant: \"secondary\", size: \"sm\", onClick: () => handleUseTemplate(template), title: template.content, children: template.name }, template.id))), templates.length > 6 && (_jsx(Button, { variant: \"outline\", size: \"sm\", onClick: () => window.location.href = '/templates', children: \"More Templates...\" }))] })] })), _jsxs(\"div\", { children: [_jsx(\"label\", { className: \"block text-sm font-semibold text-secondary-900 dark:text-secondary-50 mb-3\", children: \"\\u270D\\uFE0F Message Content\" }), _jsx(\"textarea\", { value: content, onChange: (e) => setContent(e.target.value.slice(0, 1600)), className: \"w-full px-4 py-3 border border-secondary-200 dark:border-secondary-700 rounded-lg bg-white dark:bg-secondary-800 text-secondary-900 dark:text-secondary-50 placeholder-secondary-400 dark:placeholder-secondary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 resize-none transition-colors duration-normal\", rows: 6, placeholder: \"Type your message here...\", maxLength: 1600 }), _jsxs(\"div\", { className: \"flex justify-between mt-3 text-sm text-secondary-600 dark:text-secondary-400\", children: [_jsxs(\"span\", { children: [content.length, \" / 1600 characters\"] }), _jsxs(\"span\", { children: [segments, \" SMS segment\", segments !== 1 ? 's' : '', segments > 0 && ` ($${(segments * 0.0075).toFixed(4)} per recipient)`] })] }), content.trim() && (_jsx(Button, { variant: \"ghost\", size: \"sm\", onClick: () => setShowSaveModal(true), className: \"mt-2\", children: \"\\uD83D\\uDCBE Save as Template\" }))] }), _jsxs(\"div\", { children: [_jsx(\"label\", { className: \"block text-sm font-semibold text-secondary-900 dark:text-secondary-50 mb-3\", children: \"\\uD83D\\uDC65 Send To\" }), _jsxs(\"div\", { className: \"space-y-3\", children: [_jsxs(\"label\", { className: \"flex items-center gap-3 cursor-pointer group\", children: [_jsx(\"input\", { type: \"radio\", name: \"targetType\", value: \"groups\", checked: targetType === 'groups', onChange: (e) => setTargetType(e.target.value), className: \"w-4 h-4 accent-primary-600 dark:accent-primary-400 cursor-pointer\" }), _jsx(\"span\", { className: \"text-sm font-medium text-secondary-900 dark:text-secondary-50\", children: \"Select Groups\" })] }), targetType === 'groups' && (_jsx(\"div\", { className: \"ml-7 space-y-2 bg-secondary-100 dark:bg-secondary-800 p-4 rounded-lg border border-secondary-200 dark:border-secondary-700\", children: groups.length === 0 ? (_jsx(\"p\", { className: \"text-secondary-600 dark:text-secondary-400 text-sm\", children: \"No groups available\" })) : (groups.map((group) => (_jsxs(\"label\", { className: \"flex items-center gap-3 cursor-pointer group\", children: [_jsx(\"input\", { type: \"checkbox\", checked: selectedGroupIds.includes(group.id), onChange: () => handleGroupToggle(group.id), className: \"w-4 h-4 rounded accent-primary-600 dark:accent-primary-400 cursor-pointer\" }), _jsxs(\"span\", { className: \"text-sm text-secondary-700 dark:text-secondary-300\", children: [group.name, \" (\", group.memberCount, \" members)\"] })] }, group.id)))) })), _jsxs(\"label\", { className: \"flex items-center gap-3 cursor-pointer group\", children: [_jsx(\"input\", { type: \"radio\", name: \"targetType\", value: \"all\", checked: targetType === 'all', onChange: (e) => setTargetType(e.target.value), className: \"w-4 h-4 accent-primary-600 dark:accent-primary-400 cursor-pointer\" }), _jsx(\"span\", { className: \"text-sm font-medium text-secondary-900 dark:text-secondary-50\", children: \"All Members\" })] })] })] }), (targetType === 'all' || selectedGroupIds.length > 0) && segments > 0 && (_jsx(Card, { variant: \"highlight\", children: _jsxs(\"div\", { className: \"space-y-2 text-sm\", children: [_jsxs(\"div\", { className: \"flex justify-between\", children: [_jsx(\"span\", { className: \"text-secondary-700 dark:text-secondary-300\", children: \"Recipients:\" }), _jsx(\"span\", { className: \"font-medium text-secondary-900 dark:text-secondary-50\", children: recipientCount })] }), _jsxs(\"div\", { className: \"flex justify-between\", children: [_jsx(\"span\", { className: \"text-secondary-700 dark:text-secondary-300\", children: \"Segments:\" }), _jsx(\"span\", { className: \"font-medium text-secondary-900 dark:text-secondary-50\", children: segments })] }), _jsxs(\"div\", { className: \"flex justify-between border-t border-primary-200 dark:border-primary-700 pt-2\", children: [_jsx(\"span\", { className: \"font-medium text-secondary-900 dark:text-secondary-50\", children: \"Estimated Cost:\" }), _jsxs(\"span\", { className: \"font-bold text-primary-600 dark:text-primary-400\", children: [\"$\", totalCost.toFixed(2)] })] })] }) })), _jsxs(\"div\", { className: \"flex gap-3 pt-4\", children: [_jsx(Button, { variant: \"secondary\", size: \"md\", onClick: () => {\n                                            setContent('');\n                                            setSelectedGroupIds([]);\n                                        }, disabled: isLoading, children: \"\\uD83D\\uDDD1\\uFE0F Clear\" }), _jsx(Button, { variant: \"primary\", size: \"md\", fullWidth: true, onClick: handleSendMessage, disabled: isLoading ||\n                                            !content.trim() ||\n                                            (targetType === 'groups' && selectedGroupIds.length === 0), isLoading: isLoading, children: isLoading ? 'Sending...' : '✉️ Send Message' })] })] })] }), showSaveModal && (_jsx(TemplateFormModal, { template: null, onClose: () => {\n                    setShowSaveModal(false);\n                    loadTemplates();\n                } }))] }));\n}\nexport default SendMessagePage;\n//# sourceMappingURL=SendMessagePage.js.map"],"names":["SendMessagePage","groups","useGroupStore","addMessage","useMessageStore","content","setContent","useState","targetType","setTargetType","selectedGroupIds","setSelectedGroupIds","isLoading","setIsLoading","templates","setTemplates","showSaveModal","setShowSaveModal","useEffect","loadTemplates","data","getTemplates","error","segments","totalCost","recipientCount","sum","gId","g","handleGroupToggle","groupId","prev","id","handleUseTemplate","template","toast","handleSendMessage","message","sendMessage","_jsxs","_jsx","Card","Button","e","group","TemplateFormModal"],"mappings":"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"}