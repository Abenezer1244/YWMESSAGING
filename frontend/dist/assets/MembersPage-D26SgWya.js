import{k as D,r as o,j as e,_ as p,a as V,c as z,m as $,S as L,C as I,B as y,I as T}from"./index-jEQhhmGz.js";import{u as G}from"./groupStore-_pwqbAu-.js";import{g as U}from"./groups-BYLTocEE.js";import{u as q}from"./index.esm-B70KnHSo.js";import{B as J}from"./BackButton-BNus7Zji.js";async function _(i,l={}){const r=new URLSearchParams;return l.page&&r.append("page",l.page.toString()),l.limit&&r.append("limit",l.limit.toString()),l.search&&r.append("search",l.search),(await D.get(`/groups/${i}/members?${r.toString()}`)).data}async function W(i,l){return(await D.post(`/groups/${i}/members`,l)).data.data}async function Y(i,l){const r=new FormData;return r.append("file",l),(await D.post(`/groups/${i}/members/import`,r,{headers:{}})).data.data}function H({isOpen:i,groupId:l,onClose:r,onSuccess:h}){const{register:c,handleSubmit:N,reset:u}=q(),[d,n]=o.useState(!1),f=async g=>{try{n(!0);const b=await W(l,{firstName:g.firstName,lastName:g.lastName,phone:g.phone,email:g.email||void 0});p.success("Member added successfully"),h(b),u(),r()}catch(b){p.error(b.message||"Failed to add member")}finally{n(!1)}};return i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full mx-4 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Add Member"}),e.jsxs("form",{onSubmit:N(f),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name *"}),e.jsx("input",{type:"text",...c("firstName",{required:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"John"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name *"}),e.jsx("input",{type:"text",...c("lastName",{required:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Doe"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number *"}),e.jsx("input",{type:"tel",...c("phone",{required:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"(202) 555-0173"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Any phone format"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email (Optional)"}),e.jsx("input",{type:"email",...c("email"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"john@example.com"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition",disabled:d,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition disabled:bg-gray-400",disabled:d,children:d?"Adding...":"Add Member"})]})]})]})}):null}function K({isOpen:i,groupId:l,onClose:r,onSuccess:h}){const[c,N]=o.useState(!1),[u,d]=o.useState(null),[n,f]=o.useState(null),g=t=>{const a=t.target.files?.[0];if(a){if(!a.name.toLowerCase().endsWith(".csv")){p.error("Please select a CSV file");return}d(a),f(null)}},b=async()=>{if(!u){p.error("Please select a file");return}try{N(!0);const t=await Y(l,u);f(t),t.imported>0&&(p.success(`${t.imported} members imported successfully`),h()),t.failed>0&&p.error(`${t.failed} rows failed to import`)}catch(t){console.error("CSV Import Error:",{status:t.response?.status,statusText:t.response?.statusText,data:t.response?.data,message:t.message});const a=t.response?.data?.error||t.message||"Failed to import members",m=t.response?.data?.failedDetails;m&&Array.isArray(m)?(f({imported:0,failed:m.length,failedDetails:m.map(x=>({...x,error:x.errors?.join("; ")||x.error||"Unknown error"}))}),p.error(`Validation failed: ${a}`)):p.error(a)}finally{N(!1)}},j=()=>{const t=`firstName,lastName,phone,email
John,Doe,2025550173,john@example.com
Jane,Smith,202-555-0174,jane@example.com
Robert,Johnson,(202) 555-0175,robert@example.com`,a=new Blob([t],{type:"text/csv"}),m=window.URL.createObjectURL(a),x=document.createElement("a");x.href=m,x.download="members_template.csv",x.click()};return i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full mx-4 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Import Members from CSV"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select CSV File"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition",children:[e.jsx("input",{type:"file",accept:".csv",onChange:g,className:"hidden",id:"csv-upload",disabled:c}),e.jsx("label",{htmlFor:"csv-upload",className:"cursor-pointer",children:e.jsx("p",{className:"text-gray-600",children:u?`âœ“ ${u.name}`:"Click to select CSV file"})})]})]}),e.jsx("button",{type:"button",onClick:j,className:"w-full text-sm text-blue-600 hover:text-blue-700 font-medium",children:"ðŸ“¥ Download CSV Template"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm text-gray-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"CSV Format:"}),e.jsx("p",{className:"font-mono text-xs",children:"firstName,lastName,phone,email"}),e.jsxs("p",{className:"text-xs mt-2 text-gray-600",children:[e.jsx("strong",{children:"Required:"})," firstName, lastName, phone (US format: (202) 555-0173, 202-555-0173, or 2025550173)"]}),e.jsxs("p",{className:"text-xs mt-1 text-gray-600",children:[e.jsx("strong",{children:"Optional:"})," email"]})]}),n&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm",children:[e.jsxs("p",{className:"font-medium text-green-700",children:["âœ“ ",n.imported," imported"]}),n.failed>0&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-medium text-red-700",children:["âœ— ",n.failed," failed"]}),n.failedDetails?.slice(0,3).map((t,a)=>e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Row ",a+1,": ",t.error]},a)),n.failedDetails?.length>3&&e.jsxs("p",{className:"text-xs text-red-600",children:["+",n.failedDetails.length-3," more errors"]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition",disabled:c,children:"Close"}),e.jsx("button",{type:"button",onClick:b,disabled:!u||c,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition disabled:bg-gray-400",children:c?"Importing...":"Import"})]})]})]})}):null}function te(){const i=V(),{branches:l}=z(),{groups:r,setGroups:h}=G(),[c]=$(),[N,u]=o.useState(!r.length),d=c.get("groupId")||r[0]?.id||"",[n,f]=o.useState([]),[g,b]=o.useState(!1),[j,t]=o.useState(""),[a,m]=o.useState(1),[x,M]=o.useState(0),[O,v]=o.useState(!1),[P,S]=o.useState(!1),k=50,w=Math.ceil(x/k),F=r.find(s=>s.id===d);o.useEffect(()=>{!r.length&&i.church?.id&&l.length>0?(async()=>{try{const C=l[0],R=await U(C.id);h(R)}catch(C){console.error("Failed to load groups:",C)}finally{u(!1)}})():u(!1)},[i.church?.id,l,r.length,h]),o.useEffect(()=>{const s=setTimeout(()=>{A()},500);return()=>clearTimeout(s)},[d,a,j]);const A=async()=>{if(d)try{b(!0);const s=await _(d,{page:a,limit:k,search:j||void 0});f(s.data),M(s.pagination.total)}catch(s){p.error(s.message||"Failed to load members")}finally{b(!1)}},B=s=>{f([s,...n]),M(x+1),v(!1)},E=()=>{m(1),A(),S(!1)};return N||!F?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6",children:N?e.jsx(L,{size:"lg",text:"Loading groups..."}):e.jsx(I,{variant:"default",className:"text-center max-w-md bg-muted border-border",children:e.jsx("p",{className:"text-foreground/80 text-lg",children:"No group selected. Create or select a group first."})})}):e.jsxs("div",{className:"min-h-screen bg-background p-6 transition-colors duration-normal",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsx(J,{variant:"ghost"})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:"ðŸ‘¤ Members"}),e.jsxs("p",{className:"text-foreground/80",children:[F.name," â€¢ ",x," members"]})]}),e.jsx(y,{variant:"primary",size:"lg",onClick:()=>v(!0),children:"+ Add Member"})]}),e.jsxs("div",{className:"flex gap-4 items-center flex-wrap",children:[e.jsx(T,{type:"text",placeholder:"Search by name, phone, or email...",value:j,onChange:s=>{t(s.target.value),m(1)},className:"flex-1 min-w-xs"}),e.jsx(y,{variant:"primary",size:"md",onClick:()=>S(!0),children:"ðŸ“¥ Import CSV"})]})]}),g?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(L,{size:"lg",text:"Loading members..."})}):n.length===0?e.jsxs(I,{variant:"highlight",className:"text-center py-16 bg-muted border-border",children:[e.jsx("div",{className:"mb-6",children:e.jsx("span",{className:"text-6xl",children:"ðŸ‘¤"})}),e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-3",children:j?"No Results":"No Members Yet"}),e.jsx("p",{className:"text-foreground/80 mb-6 max-w-md mx-auto",children:j?"No members found matching your search":"Add your first member to get started"}),!j&&e.jsx(y,{variant:"primary",size:"md",onClick:()=>v(!0),children:"Add First Member"})]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{variant:"default",className:"overflow-hidden bg-muted border-border",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-card border-b border-border",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Added"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:n.map(s=>e.jsxs("tr",{className:"hover:bg-muted/50 transition-colors duration-normal",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-medium text-foreground",children:[s.firstName," ",s.lastName]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-foreground/80",children:s.phone})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-foreground/80",children:s.email||"â€”"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-block px-3 py-1 text-xs font-semibold rounded-full ${s.optInSms?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:s.optInSms?"âœ… Opted In":"âŒ Opted Out"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-foreground/80",children:new Date(s.createdAt).toLocaleDateString()})]},s.id))})]})})}),w>1&&e.jsxs("div",{className:"mt-6 flex justify-center gap-2",children:[e.jsx(y,{variant:"secondary",size:"md",onClick:()=>m(Math.max(1,a-1)),disabled:a===1,children:"â† Previous"}),e.jsxs("div",{className:"px-4 py-2 text-foreground/80 font-medium",children:["Page ",a," of ",w]}),e.jsx(y,{variant:"secondary",size:"md",onClick:()=>m(Math.min(w,a+1)),disabled:a===w,children:"Next â†’"})]})]})]}),e.jsx(H,{isOpen:O,groupId:d,onClose:()=>v(!1),onSuccess:B}),e.jsx(K,{isOpen:P,groupId:d,onClose:()=>S(!1),onSuccess:E})]})}export{te as MembersPage,te as default};
//# sourceMappingURL=MembersPage-D26SgWya.js.map
