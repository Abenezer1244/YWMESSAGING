import{e as _,c as A,r as l,j as e,_ as I}from"./index-B2BXEiIc.js";import{c as D,A as K,X as $}from"./index-XlRfScrd.js";import{m as h}from"./proxy-DH6Zr8XE.js";import{S}from"./send-BxrkM2hu.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],v=D("message-circle",L),F=_(a=>({conversationId:null,messages:[],isLoading:!1,error:null,isOpen:!1,setConversationId:t=>a({conversationId:t}),addMessage:t=>a(r=>({messages:[...r.messages,t]})),setMessages:t=>a({messages:t}),setLoading:t=>a({isLoading:t}),setError:t=>a({error:t}),toggleChatWindow:()=>a(t=>({isOpen:!t.isOpen})),openChat:()=>a({isOpen:!0}),closeChat:()=>a({isOpen:!1}),clearChat:()=>a({messages:[],conversationId:null,error:null})}));async function P(a,t,r){return(await A.post("/chat/message",{message:a,conversationId:t,visitorId:r})).data.data}async function R(a){return(await A.post("/chat/conversation",{visitorId:a})).data.data}function q({variant:a="floating",position:t="bottom-right"}){const[r,c]=l.useState(""),[j,M]=l.useState(!1),y=l.useRef(null),[f]=l.useState(()=>{let s=localStorage.getItem("visitor_id");return s||(s=`visitor_${Date.now()}_${Math.random().toString(36).substring(7)}`,localStorage.setItem("visitor_id",s)),s}),{conversationId:u,messages:d,isLoading:i,error:x,isOpen:m,setConversationId:p,addMessage:w,setLoading:k,setError:g,openChat:E,closeChat:z}=F();l.useEffect(()=>{(async()=>{if(!u&&m)try{const n=await R(f);p(n.conversationId)}catch{g("Failed to start conversation"),I.error("Failed to start conversation")}})()},[m,u,p,g,f]),l.useEffect(()=>{y.current?.scrollIntoView({behavior:"smooth"})},[d]),l.useEffect(()=>{const s=()=>{M(document.documentElement.classList.contains("dark"))};s();const n=new MutationObserver(s);return n.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>n.disconnect()},[]);const b=async()=>{if(!r.trim())return;const s=r.trim();c(""),w({id:Date.now().toString(),role:"user",content:s,createdAt:new Date().toISOString()}),k(!0),g(null);try{const n=await P(s,u||void 0,f);w({id:`response_${Date.now()}`,role:"assistant",content:n.message,createdAt:new Date().toISOString()}),u||p(n.conversationId)}catch(n){const C=n.response?.data?.error||"Failed to send message";g(C),I.error(C)}finally{k(!1)}},O=t==="bottom-left"?"left-4":"right-4",o=j?"#5f8787":"#e78a53",N=j?"#9db0b0":"#c97a4c";return a==="floating"?e.jsx("div",{className:`fixed bottom-4 ${O} z-50`,children:e.jsxs(K,{children:[!m&&e.jsx(h.button,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},onClick:E,className:"w-14 h-14 rounded-full text-white shadow-lg hover:shadow-xl transition-shadow flex items-center justify-center",style:{backgroundColor:o},children:e.jsx(v,{size:24})}),m&&e.jsxs(h.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"w-96 h-[500px] bg-white dark:bg-slate-900 rounded-lg shadow-2xl border border-gray-200 dark:border-slate-700 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"text-white p-4 flex items-center justify-between",style:{backgroundColor:o},children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Koinonia Assistant"}),e.jsx("p",{className:"text-sm",style:{color:N},children:"Ask me about Koinonia SMS"})]}),e.jsx("button",{onClick:z,className:"p-1 rounded transition-colors",style:{background:"rgba(0, 0, 0, 0.2)"},children:e.jsx($,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50 dark:bg-slate-800",children:[d.length===0&&e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:[e.jsx(v,{size:32,className:"mx-auto mb-2 opacity-30"}),e.jsxs("p",{className:"text-sm",children:["Hi! I'm the Koinonia Assistant.",e.jsx("br",{}),"Ask me anything about our platform!"]})]}),d.map(s=>e.jsx(h.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg text-sm ${s.role==="user"?"text-white rounded-br-none":"bg-white dark:bg-slate-700 text-gray-900 dark:text-white border border-gray-200 dark:border-slate-600 rounded-bl-none"}`,style:s.role==="user"?{backgroundColor:o}:void 0,children:s.content})},s.id)),i&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-white dark:bg-slate-700 px-3 py-2 rounded-lg rounded-bl-none",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200"})]})})}),x&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:x}),e.jsx("div",{ref:y})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-slate-700 p-4 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:r,onChange:s=>c(s.target.value),onKeyPress:s=>s.key==="Enter"&&b(),placeholder:"Ask me something...",disabled:i,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 dark:bg-slate-800 dark:text-white text-sm",style:{"--tw-ring-color":o}}),e.jsx("button",{onClick:b,disabled:i||!r.trim(),className:"text-white p-2 rounded-lg transition-colors disabled:bg-gray-400",style:{backgroundColor:!i&&r.trim()?o:void 0},children:e.jsx(S,{size:18})})]})})]})]})}):e.jsxs("div",{className:"w-full h-full bg-white dark:bg-slate-900 rounded-lg shadow-lg border border-gray-200 dark:border-slate-700 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"text-white p-4",style:{backgroundColor:o},children:[e.jsx("h3",{className:"font-semibold",children:"Koinonia Assistant"}),e.jsx("p",{className:"text-sm",style:{color:N},children:"Ask me about Koinonia features and support"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50 dark:bg-slate-800",children:[d.length===0&&e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:[e.jsx(v,{size:32,className:"mx-auto mb-2 opacity-30"}),e.jsxs("p",{className:"text-sm",children:["Hi! I'm the Koinonia Assistant.",e.jsx("br",{}),"Ask me anything about our platform!"]})]}),d.map(s=>e.jsx(h.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg text-sm ${s.role==="user"?"text-white rounded-br-none":"bg-white dark:bg-slate-700 text-gray-900 dark:text-white border border-gray-200 dark:border-slate-600 rounded-bl-none"}`,style:s.role==="user"?{backgroundColor:o}:void 0,children:s.content})},s.id)),i&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-white dark:bg-slate-700 px-3 py-2 rounded-lg rounded-bl-none",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200"})]})})}),x&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:x}),e.jsx("div",{ref:y})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-slate-700 p-4 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:r,onChange:s=>c(s.target.value),onKeyPress:s=>s.key==="Enter"&&b(),placeholder:"Ask me something...",disabled:i,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 dark:bg-slate-800 dark:text-white text-sm",style:{"--tw-ring-color":o}}),e.jsx("button",{onClick:b,disabled:i||!r.trim(),className:"text-white p-2 rounded-lg transition-colors disabled:bg-gray-400",style:{backgroundColor:!i&&r.trim()?o:void 0},children:e.jsx(S,{size:18})})]})})]})}export{q as C};
//# sourceMappingURL=ChatWidget-BJxguKpV.js.map
