import{c as S,r,_ as i,j as e,I}from"./index-BHrUDtA-.js";import{a as D,P as k,g as F}from"./PhoneNumberPurchaseModal-DgnYroZ_.js";import{L as A,S as l,C as E,a as T}from"./SoftLayout-4zvuBu72.js";import{S as N}from"./SoftButton-B3F5iL4a.js";import{U as M}from"./user-plus-DAeJxXEE.js";import{T as R}from"./trash-2--eXM0cz4.js";import{C as Y}from"./chevron-left-CB8J5Du3.js";import{m}from"./proxy-DEnN5MaA.js";import"./index-Brj5yV9m.js";import"./index-CWRWOvUC.js";import"./index-DtB5PJwM.js";async function $(){return(await S.get("/admin/profile")).data}async function q(s){return(await S.put("/admin/profile",s)).data}async function z(){return(await S.get("/admin/co-admins")).data}async function B(s){return(await S.post("/admin/co-admins",s)).data}async function U(s){return(await S.delete(`/admin/co-admins/${s}`)).data}async function _(s=1,x=50){return(await S.get("/admin/activity-logs",{params:{page:s,limit:x}})).data}function J(){const[s,x]=r.useState([]),[b,h]=r.useState(!0),[n,p]=r.useState(null),[u,d]=r.useState(!1),[f,v]=r.useState(!1),[g,w]=r.useState(null),[o,y]=r.useState({email:"",firstName:"",lastName:""});r.useEffect(()=>{c()},[]);const c=async()=>{try{h(!0);const t=await z();x(t)}catch(t){i.error(t.message||"Failed to load co-admins")}finally{h(!1)}},C=async t=>{if(confirm("Are you sure you want to remove this co-admin? They will lose access immediately."))try{p(t),await U(t),i.success("Co-admin removed successfully"),c()}catch(j){i.error(j.message||"Failed to remove co-admin")}finally{p(null)}},P=async t=>{if(t.preventDefault(),!o.email||!o.firstName||!o.lastName){i.error("Please fill in all fields");return}try{v(!0);const j=await B({email:o.email,firstName:o.firstName,lastName:o.lastName});w(j.data),y({email:"",firstName:"",lastName:""}),i.success("Co-admin invited successfully"),c()}catch(j){i.error(j.message||"Failed to invite co-admin")}finally{v(!1)}};return b?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(A,{className:"w-6 h-6 text-primary animate-spin"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Co-Admin Management"}),e.jsx(N,{variant:"primary",onClick:()=>d(!u),icon:e.jsx(M,{className:"w-4 h-4"}),children:u?"Cancel":"Invite Co-Admin"})]}),u&&e.jsxs(l,{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"Invite New Co-Admin"}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"First Name"}),e.jsx("input",{type:"text",value:o.firstName,onChange:t=>y({...o,firstName:t.target.value}),className:"w-full px-4 py-2 border border-border/40 rounded-lg bg-card/50 text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors duration-normal backdrop-blur-sm",placeholder:"John",disabled:f})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Last Name"}),e.jsx("input",{type:"text",value:o.lastName,onChange:t=>y({...o,lastName:t.target.value}),className:"w-full px-4 py-2 border border-border/40 rounded-lg bg-card/50 text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors duration-normal backdrop-blur-sm",placeholder:"Doe",disabled:f})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Email"}),e.jsx("input",{type:"email",value:o.email,onChange:t=>y({...o,email:t.target.value}),className:"w-full px-4 py-2 border border-border/40 rounded-lg bg-card/50 text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors duration-normal backdrop-blur-sm",placeholder:"john.doe@example.com",disabled:f})]}),e.jsx(N,{type:"submit",variant:"primary",fullWidth:!0,disabled:f,children:f?"Inviting...":"Send Invite"})]})]}),g&&e.jsxs(l,{variant:"gradient",className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"Co-Admin Invited Successfully!"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Share the following credentials with ",e.jsx("strong",{children:g.admin.email}),":"]}),e.jsxs(l,{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-foreground mb-2",children:[e.jsx("strong",{children:"Email:"})," ",g.admin.email]}),e.jsxs("p",{className:"text-sm text-foreground mb-2",children:[e.jsx("strong",{children:"Temporary Password:"}),e.jsx("code",{className:"ml-2 bg-muted/50 px-2 py-1 rounded font-mono text-primary",children:g.tempPassword}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(g.tempPassword),i.success("Password copied to clipboard")},className:"ml-2 text-primary hover:text-primary/80 text-sm font-medium",children:"Copy"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"They can log in with this temporary password and change it after first login."}),e.jsx(N,{variant:"primary",onClick:()=>w(null),children:"Done"})]}),s.length===0?e.jsxs(l,{className:"text-center py-12 mb-6",children:[e.jsx("p",{className:"text-muted-foreground",children:"No co-admins yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:'Click "Invite Co-Admin" to add your first co-admin'})]}):e.jsx(l,{className:"mb-6 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"border-b border-border/40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Added"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Last Login"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border/40",children:s.map(t=>e.jsxs("tr",{className:"hover:bg-muted/30 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 text-sm font-medium text-foreground",children:[t.firstName," ",t.lastName]}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:t.email}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:t.lastLoginAt?new Date(t.lastLoginAt).toLocaleDateString():"Never"}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsxs("button",{onClick:()=>C(t.id),disabled:n===t.id,className:"inline-flex items-center gap-1 text-danger hover:text-danger/80 disabled:opacity-50 font-medium",children:[e.jsx(R,{className:"w-4 h-4"}),n===t.id?"Removing...":"Remove"]})})]},t.id))})]})})}),e.jsx(l,{variant:"gradient",children:e.jsxs("p",{className:"text-sm text-foreground",children:["ℹ️ ",e.jsx("strong",{children:"Tip:"})," Co-admins can manage branches, groups, members, and messages. They cannot manage billing or other co-admins."]})})]})}function O(){const[s,x]=r.useState(null),[b,h]=r.useState(!0),[n,p]=r.useState(1);r.useEffect(()=>{u()},[n]);const u=async()=>{try{h(!0);const d=await _(n,50);x(d)}catch(d){i.error(d.message||"Failed to load activity logs")}finally{h(!1)}};return b?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(A,{className:"w-6 h-6 text-primary animate-spin"})}):!s||s.logs.length===0?e.jsx(l,{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No activity logs yet"})}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-foreground mb-6",children:"Activity Logs"}),e.jsx(l,{className:"mb-6 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"border-b border-border/40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Action"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Admin"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-foreground",children:"Timestamp"})]})}),e.jsx("tbody",{className:"divide-y divide-border/40",children:s.logs.map(d=>e.jsxs("tr",{className:"hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-foreground",children:d.action}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:d.details}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:d.adminEmail}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:new Date(d.timestamp).toLocaleString()})]},d.id))})]})})}),s.pagination.pages>1&&e.jsx(l,{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(n-1)*s.pagination.limit+1," to"," ",Math.min(n*s.pagination.limit,s.pagination.total)," of"," ",s.pagination.total," logs"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"secondary",size:"sm",onClick:()=>p(Math.max(1,n-1)),disabled:n===1,icon:e.jsx(Y,{className:"w-4 h-4"}),children:"Previous"}),e.jsxs("div",{className:"px-4 py-2 text-sm text-muted-foreground font-medium",children:["Page ",n," of ",s.pagination.pages]}),e.jsx(N,{variant:"secondary",size:"sm",onClick:()=>p(Math.min(s.pagination.pages,n+1)),disabled:n===s.pagination.pages,icon:e.jsx(E,{className:"w-4 h-4"}),children:"Next"})]})]})}),e.jsx(l,{variant:"gradient",children:e.jsxs("p",{className:"text-sm text-foreground",children:["ℹ️ ",e.jsx("strong",{children:"Activity logs:"})," All user actions are logged for security and compliance purposes. Logs are retained for 90 days."]})})]})}const V=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s);function re(){const[s,x]=r.useState("profile"),[b,h]=r.useState(!1),[n,p]=r.useState(!1),[u,d]=r.useState(null),[f,v]=r.useState(null),[g,w]=r.useState(!1),[o,y]=r.useState(!1),[c,C]=r.useState({name:"",email:""}),P=async()=>{try{h(!0);const a=await $();d(a),C({name:a.name||"",email:a.email||""})}catch{i.error("Failed to load profile. Please refresh the page.")}finally{h(!1)}},t=async()=>{try{y(!0);const a=await F();v(a.telnyxPhoneNumber)}catch{v(null)}finally{y(!1)}};r.useEffect(()=>{P(),t()},[]);const j=async a=>{if(a.preventDefault(),!c.name.trim()){i.error("Church name is required");return}if(!c.email.trim()){i.error("Email address is required");return}if(!V(c.email.trim())){i.error("Please enter a valid email address");return}try{p(!0),await q({name:c.name.trim(),email:c.email.trim()}),i.success("Profile updated successfully"),P()}catch{i.error("Failed to update profile. Please try again.")}finally{p(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(T,{children:e.jsxs("div",{className:"px-4 md:px-8 py-8 w-full",children:[e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-foreground mb-2",children:e.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Settings"})}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your church account and permissions"})]}),e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"mb-8",children:e.jsxs(l,{children:[e.jsx("div",{className:"border-b border-border/40",children:e.jsx("div",{className:"flex flex-wrap",children:["profile","coadmins","numbers","logs"].map((a,L)=>e.jsxs(m.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:L*.05},onClick:()=>x(a),className:`flex-1 min-w-[120px] px-4 py-4 text-center font-medium border-b-2 transition ${s===a?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[a==="profile"&&"Church Profile",a==="coadmins"&&"Co-Admins",a==="numbers"&&"Phone Numbers",a==="logs"&&"Activity Logs"]},a))})}),e.jsxs("div",{className:"p-8",children:[s==="profile"&&e.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-6",children:"Church Profile"}),b?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(m.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0},children:e.jsx(A,{className:"w-8 h-8 text-primary"})})}):e.jsxs("form",{onSubmit:j,className:"max-w-2xl",children:[e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-6",children:e.jsx(I,{label:"Church Name",type:"text",value:c.name,onChange:a=>C({...c,name:a.target.value}),placeholder:"Your church name"})}),e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"mb-6",children:e.jsx(I,{label:"Email Address",type:"email",value:c.email,onChange:a=>C({...c,email:a.target.value}),placeholder:"contact@church.com"})}),u&&e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-6",children:e.jsxs(l,{variant:"gradient",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"Account Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Status:"})," ",e.jsx("span",{className:"font-medium text-foreground",children:u.subscriptionStatus})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Created:"})," ",e.jsx("span",{className:"font-medium text-foreground",children:new Date(u.createdAt).toLocaleDateString()})]})]})]})}),e.jsx(N,{type:"submit",variant:"primary",disabled:n,children:n?"Saving...":"Save Changes"})]})]}),s==="coadmins"&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:e.jsx(J,{})}),s==="numbers"&&e.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-6",children:"Phone Numbers"}),o?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(m.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0},children:e.jsx(A,{className:"w-8 h-8 text-primary"})})}):e.jsxs("div",{className:"max-w-2xl",children:[e.jsxs(l,{variant:"gradient",className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(D,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-foreground",children:"Current Phone Number"})]}),f?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:f}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your active Telnyx phone number for sending SMS messages."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted-foreground",children:"No phone number assigned yet. Purchase one to start sending SMS messages."}),e.jsx(N,{variant:"primary",onClick:()=>w(!0),children:"Buy Phone Number"})]})]}),e.jsxs(l,{variant:"default",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"About Phone Numbers"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-primary font-bold",children:"•"}),e.jsx("span",{children:"Each church gets one dedicated phone number for sending SMS messages"})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-primary font-bold",children:"•"}),e.jsx("span",{children:"Numbers are powered by Telnyx for reliable SMS delivery"})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-primary font-bold",children:"•"}),e.jsx("span",{children:"You can purchase and manage your numbers from this dashboard"})]}),e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"text-primary font-bold",children:"•"}),e.jsx("span",{children:"Delivery tracking is automatic - monitor message status in real-time"})]})]})]})]})]}),s==="logs"&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:e.jsx(O,{})})]})]})})]})}),e.jsx(k,{isOpen:g,onClose:()=>w(!1),onPurchaseComplete:a=>{v(a),w(!1),i.success("Phone number purchased successfully!")}})]})}export{re as AdminSettingsPage,re as default};
//# sourceMappingURL=AdminSettingsPage-DAzw46t6.js.map
