import{c as i,r as u,j as e,B as S,_ as g}from"./index-C4F4BrS0.js";import{u as T,a as W,C as M,E as X,l as _}from"./index-B8EBjmMc.js";import{A as q,X as U}from"./index-CZGW8dGN.js";import{m as p}from"./proxy-D6E2wFT5.js";import{P as F}from"./phone-DsXNAE_3.js";async function Y(s){const r=new URLSearchParams;return s.areaCode&&r.append("areaCode",s.areaCode),s.state&&r.append("state",s.state),s.contains&&r.append("contains",s.contains),s.quantity&&r.append("quantity",s.quantity.toString()),(await i.get(`/numbers/search?${r.toString()}`)).data.data}async function G(s){return(await i.post("/numbers/setup-payment-intent",{phoneNumber:s})).data}async function H(s,r){return(await i.post("/numbers/confirm-payment",{paymentIntentId:s,paymentMethodId:r})).data}async function V(s,r,h){return(await i.post("/numbers/purchase",{phoneNumber:s,paymentIntentId:r,connectionId:h})).data}async function ne(){return(await i.get("/numbers/current")).data.data}async function oe(s){return(await i.delete("/numbers/current",{data:s})).data}async function ie(){return(await i.get("/admin/profile")).data}async function de(s){return(await i.put("/admin/profile",s)).data}async function ce(){return(await i.get("/admin/co-admins")).data}async function le(s){return(await i.post("/admin/co-admins",s)).data}async function me(s){return(await i.delete(`/admin/co-admins/${s}`)).data}async function ue(s=1,r=50){return(await i.get("/admin/activity-logs",{params:{page:s,limit:r}})).data}async function pe(s){return(await i.post("/admin/phone-numbers/link",{phoneNumber:s})).data}const Q={style:{base:{fontSize:"14px",color:"var(--foreground)","::placeholder":{color:"var(--muted-foreground)"},fontFamily:"system-ui, -apple-system, sans-serif"},invalid:{color:"#ff4444"}}};function Z({amount:s,phoneNumber:r,paymentIntentId:h,onSuccess:c,onError:m,isLoading:y=!1,paymentStatus:l="idle",paymentMessage:v=""}){const N=T(),k=W(),[f,a]=u.useState(!1),j=async d=>{if(d.preventDefault(),!N||!k){g.error("Payment system not initialized");return}a(!0);try{const n=k.getElement(M);if(!n)throw new Error("Card element not found");const{error:o,paymentMethod:C}=await N.createPaymentMethod({type:"card",card:n,billing_details:{}});if(o){console.error("Payment method creation failed:",o),g.error(o.message||"Failed to process card"),m?.(o.message||"Failed to process card"),a(!1);return}if(!C)throw new Error("No payment method returned");c(C.id)}catch(n){console.error("Payment form error:",n);const o=n.message||"Payment processing failed";g.error(o),m?.(o)}finally{a(!1)}};return e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-foreground mb-2",children:["Payment for ",r]}),e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["$",(s/100).toFixed(2)]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"One-time setup fee"})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Card Details"}),e.jsx("div",{className:"p-3 border border-border rounded-lg bg-muted",children:e.jsx(M,{options:Q})})]})}),l!=="idle"&&e.jsxs("div",{className:`p-4 rounded-lg border text-center ${l==="success"?"bg-green-500/10 border-green-500/20 text-green-700":l==="declined"||l==="failed"?"bg-red-500/10 border-red-500/20 text-red-700":"bg-blue-500/10 border-blue-500/20 text-blue-700"}`,children:[l==="success"&&"âœ“ Payment Successful",l==="declined"&&"âœ— Card Declined",l==="failed"&&"âœ— Payment Failed",l==="processing"&&"â³ Processing...",v&&e.jsx("div",{className:"text-sm mt-1",children:v})]}),e.jsx("div",{className:"text-xs text-muted-foreground bg-blue-500/10 border border-blue-500/20 rounded-lg p-3",children:"ðŸ”’ Payment is processed securely by Stripe. Your card details are encrypted and never stored on our servers."}),e.jsx("div",{className:"space-y-2",children:e.jsx(S,{type:"submit",variant:"primary",fullWidth:!0,size:"lg",disabled:!N||f||y,isLoading:f||y,className:"bg-primary hover:bg-primary/90 text-background font-medium",children:f?"Processing...":"Complete Purchase"})})]})}const J=[{code:"CA",name:"California"},{code:"NY",name:"New York"},{code:"TX",name:"Texas"},{code:"FL",name:"Florida"},{code:"IL",name:"Illinois"},{code:"PA",name:"Pennsylvania"},{code:"OH",name:"Ohio"},{code:"GA",name:"Georgia"},{code:"MI",name:"Michigan"},{code:"NC",name:"North Carolina"}],K=_("pk_live_51SNi09E7LiXbMhWDr4X7EtXptIiMS3xAZgkdIfdjgf18XMQpSpt2OY47nmuv7hGSMCehvRDLawh9bDSsLto5D0jS00A7xoe8Ut");function he({isOpen:s,onClose:r,onPurchaseComplete:h}){const[c,m]=u.useState("search"),[y,l]=u.useState(""),[v,N]=u.useState(""),[k,f]=u.useState([]),[a,j]=u.useState(null),[d,n]=u.useState(!1),[o,C]=u.useState(null),[A,w]=u.useState("idle"),[D,P]=u.useState(""),L=async()=>{if(!y&&!v){g.error("Please enter an area code or select a state");return}n(!0);try{const t=await Y({areaCode:y||void 0,state:v||void 0,quantity:10});t.length===0?(g.error("No numbers found for that search"),f([])):(f(t),m("select"))}catch(t){console.error("Search failed:",t),g.error(t.message||"Failed to search numbers")}finally{n(!1)}},$=async t=>{j(t),m("confirm")},z=async()=>{if(a){n(!0);try{const t=await G(a.phoneNumber);if(!t.success||!t.data?.paymentIntentId)throw new Error("Failed to create payment intent");C(t.data.paymentIntentId),m("payment")}catch(t){console.error("Payment intent creation failed:",t),g.error(t.message||"Failed to create payment intent")}finally{n(!1)}}},R=async t=>{if(!(!a||!o)){n(!0),w("processing"),P("");try{const x=await H(o,t);if(!x.success||x.data?.status!=="succeeded"){w("failed"),P("Payment confirmation failed. Please try again."),n(!1);return}const b=await V(a.phoneNumber,o);b.success&&(w("success"),P(""),setTimeout(()=>{const E=b.data.webhookId?"automatically linked with webhook":"linked (webhook manual setup recommended)";g.success(`Successfully purchased ${a.formattedNumber}! Number ${E}.`),h&&h(a.phoneNumber),O(),r()},1500))}catch(x){console.error("Purchase failed:",x);let b="Payment processing failed";x.response?.status===402?b=x.response?.data?.error||"Request failed with status code 402":x.message&&(b=x.message);const E=b.toLowerCase().includes("declined")||b.toLowerCase().includes("insufficient");w(E?"declined":"failed"),P(b),n(!1)}}},O=()=>{m("search"),l(""),N(""),f([]),j(null),C(null),w("idle"),P("")},B={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.1}}},I={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{duration:.3,type:"tween"}}};return e.jsx(q,{children:s&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4 backdrop-blur-md",children:e.jsxs(p.div,{initial:{opacity:0,scale:.92,y:30},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.92,y:30},transition:{duration:.4,ease:"easeOut"},className:"bg-background border border-border/50 rounded-2xl shadow-2xl max-w-2xl w-full overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-primary/5 border-b border-border/30 p-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/20 rounded-lg",children:e.jsx(F,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Buy Phone Number"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[c==="search"&&"Search available numbers",c==="select"&&"Choose a number",c==="confirm"&&"Confirm purchase",c==="payment"&&"Complete payment"]})]})]}),e.jsx(p.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:r,disabled:d,className:"p-2 hover:bg-muted rounded-lg transition-colors disabled:opacity-50",children:e.jsx(U,{className:"w-5 h-5 text-muted-foreground"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs(p.div,{variants:B,initial:"hidden",animate:"visible",children:[c==="search"&&e.jsxs(p.div,{variants:I,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Area Code"}),e.jsx("input",{type:"text",placeholder:"e.g., 415, 212, 310",value:y,onChange:t=>l(t.target.value),maxLength:3,className:"w-full px-3 py-2 border border-border/50 rounded-lg bg-background text-foreground placeholder-muted-foreground focus:border-primary focus:outline-none transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"State (Optional)"}),e.jsxs("select",{value:v,onChange:t=>N(t.target.value),className:"w-full px-3 py-2 border border-border/50 rounded-lg bg-background text-foreground focus:border-primary focus:outline-none transition-colors appearance-none",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 9L1 4h10z'/%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",paddingRight:"2rem"},children:[e.jsx("option",{value:"",children:"Select a state..."}),J.map(t=>e.jsx("option",{value:t.code,children:t.name},t.code))]})]}),e.jsx(S,{variant:"primary",fullWidth:!0,size:"lg",onClick:L,disabled:d,isLoading:d,className:"bg-primary hover:bg-primary/90 text-background font-medium mt-6",children:d?"Searching...":"Search Numbers"})]}),c==="select"&&e.jsxs(p.div,{variants:I,className:"space-y-3",children:[e.jsx("div",{className:"space-y-2 max-h-72 overflow-y-auto",children:k.map(t=>e.jsx(p.button,{whileHover:{scale:1.02},onClick:()=>$(t),className:"w-full p-4 border-2 border-border/30 rounded-lg bg-muted/20 hover:border-primary/50 hover:bg-primary/5 transition-all text-left group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-foreground text-lg",children:t.formattedNumber}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:t.region})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-foreground",children:["$",t.costPerSms.toFixed(4),"/SMS"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["$",t.costPerMinute.toFixed(4),"/min"]})]})]})},t.id))}),e.jsx(S,{variant:"secondary",fullWidth:!0,size:"sm",onClick:()=>{m("search"),f([]),j(null)},className:"mt-4",children:"Back to Search"})]}),c==="confirm"&&a&&e.jsxs(p.div,{variants:I,className:"space-y-4",children:[e.jsx("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"w-8 h-8 text-primary mx-auto mb-3"}),e.jsx("div",{className:"text-2xl font-bold text-foreground mb-1",children:a.formattedNumber}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.region})]})}),e.jsxs("div",{className:"space-y-2 bg-muted/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Per SMS:"}),e.jsxs("span",{className:"font-medium text-foreground",children:["$",a.costPerSms.toFixed(4)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Per minute:"}),e.jsxs("span",{className:"font-medium text-foreground",children:["$",a.costPerMinute.toFixed(4)]})]}),e.jsxs("div",{className:"border-t border-border/30 pt-2 mt-2 flex justify-between font-semibold",children:[e.jsx("span",{className:"text-foreground",children:"One-time setup:"}),e.jsx("span",{className:"text-primary",children:"$0.50"})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:"By purchasing, you agree to Telnyx's terms and will be charged the one-time setup fee. Usage charges apply separately."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{variant:"primary",fullWidth:!0,size:"lg",onClick:z,disabled:d,isLoading:d,className:"bg-primary hover:bg-primary/90 text-background font-medium",children:d?"Processing...":"Continue to Payment"}),e.jsx(S,{variant:"secondary",fullWidth:!0,size:"sm",onClick:()=>{m("select"),j(null)},disabled:d,children:"Choose Different Number"})]})]}),c==="payment"&&a&&o&&e.jsxs(p.div,{variants:I,className:"space-y-4",children:[e.jsx(X,{stripe:K,children:e.jsx(Z,{amount:50,phoneNumber:a.phoneNumber,paymentIntentId:o,onSuccess:R,isLoading:d,paymentStatus:A,paymentMessage:D})}),e.jsx(S,{variant:"secondary",fullWidth:!0,size:"sm",onClick:()=>{m("confirm"),w("idle"),P("")},disabled:d,children:"Back"})]})]})})]})})})}export{he as P,ne as a,ce as b,ue as c,oe as d,ie as g,le as i,pe as l,me as r,de as u};
//# sourceMappingURL=PhoneNumberPurchaseModal-DCvY0ay_.js.map
