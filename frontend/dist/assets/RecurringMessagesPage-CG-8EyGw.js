import{i as p,r as m,j as e,_ as c,B as b,S as R,C as w}from"./index-C_1TKi-h.js";import{u as C}from"./index.esm-c-QvmoYu.js";import{u as T}from"./groupStore-gV1t2wdQ.js";async function q(){return(await p.get("/recurring-messages")).data}async function O(r){return(await p.post("/recurring-messages",r)).data}async function F(r,a){return(await p.put(`/recurring-messages/${r}`,a)).data}async function W(r){return(await p.delete(`/recurring-messages/${r}`)).data}async function A(r,a){return(await p.put(`/recurring-messages/${r}/toggle`,{isActive:a})).data}function E({message:r,onClose:a}){const{groups:x}=T(),[o,f]=m.useState(!1),{register:n,handleSubmit:j,formState:{errors:l},watch:d}=C({defaultValues:r?{name:r.name,content:r.content,targetType:r.targetType==="all"?"all":"groups",selectedGroupIds:r.targetIds?JSON.parse(r.targetIds):[],frequency:r.frequency,timeOfDay:r.timeOfDay||"09:00",dayOfWeek:r.dayOfWeek||0}:{name:"",content:"",targetType:"groups",selectedGroupIds:[],frequency:"daily",timeOfDay:"09:00",dayOfWeek:0}}),h=d("targetType");d("selectedGroupIds");const N=d("frequency"),v=async t=>{try{f(!0);const u={name:t.name,content:t.content,targetType:t.targetType==="all"?"all":"groups",targetIds:t.targetType==="all"?void 0:t.selectedGroupIds,frequency:t.frequency,timeOfDay:t.timeOfDay,dayOfWeek:t.frequency==="weekly"?t.dayOfWeek:void 0};r?(await F(r.id,u),c.success("Recurring message updated")):(await O(u),c.success("Recurring message created")),a()}catch(u){c.error(u.message||"Failed to save recurring message")}finally{f(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:r?"Edit Recurring Message":"Create Recurring Message"}),e.jsxs("form",{onSubmit:j(v),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e.jsx("input",{...n("name",{required:"Name is required"}),type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Sunday Reminder"}),l.name&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:l.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Content *"}),e.jsx("textarea",{...n("content",{required:"Content is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:4,placeholder:"Message content..."}),l.content&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:l.content.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Send To *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{...n("targetType"),type:"radio",value:"groups"}),e.jsx("span",{className:"text-sm",children:"Select Groups"})]}),h==="groups"&&e.jsx("div",{className:"ml-6 space-y-1 bg-gray-50 p-2 rounded",children:x.map(t=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",value:t.id,...n("selectedGroupIds")}),e.jsx("span",{className:"text-sm",children:t.name})]},t.id))}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{...n("targetType"),type:"radio",value:"all"}),e.jsx("span",{className:"text-sm",children:"All Members"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Frequency *"}),e.jsxs("select",{...n("frequency"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),N==="weekly"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Day of Week *"}),e.jsxs("select",{...n("dayOfWeek",{valueAsNumber:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:0,children:"Sunday"}),e.jsx("option",{value:1,children:"Monday"}),e.jsx("option",{value:2,children:"Tuesday"}),e.jsx("option",{value:3,children:"Wednesday"}),e.jsx("option",{value:4,children:"Thursday"}),e.jsx("option",{value:5,children:"Friday"}),e.jsx("option",{value:6,children:"Saturday"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Time of Day *"}),e.jsx("input",{...n("timeOfDay"),type:"time",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition",disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition disabled:bg-gray-400",disabled:o,children:o?"Saving...":"Save"})]})]})]})})}function G(){const[r,a]=m.useState([]),[x,o]=m.useState(!0),[f,n]=m.useState(!1),[j,l]=m.useState(null);m.useEffect(()=>{d()},[]);const d=async()=>{try{o(!0);const s=await q();a(s)}catch(s){c.error(s.message||"Failed to load recurring messages")}finally{o(!1)}},h=()=>{l(null),n(!0)},N=s=>{l(s),n(!0)},v=async s=>{if(window.confirm("Are you sure you want to delete this recurring message?"))try{await W(s),a(r.filter(i=>i.id!==s)),c.success("Recurring message deleted")}catch(i){c.error(i.message||"Failed to delete recurring message")}},t=async(s,i)=>{try{const g=await A(s,!i);a(r.map(y=>y.id===s?g:y)),c.success(i?"Recurring message paused":"Recurring message resumed")}catch(g){c.error(g.message||"Failed to toggle recurring message")}},u=()=>{n(!1),l(null),d()},D=s=>{const i=new Date(s),g=new Date,y=i.getTime()-g.getTime(),M=Math.floor(y/(1e3*60*60*24)),k=Math.floor(y%(1e3*60*60*24)/(1e3*60*60));return M>0?`in ${M}d ${k}h`:k>0?`in ${k}h`:"soon"},S=s=>({daily:"Daily",weekly:"Weekly",monthly:"Monthly"})[s]||s;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 dark:from-primary-900 to-primary-100 dark:to-primary-950 p-6 transition-colors duration-normal",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-primary-900 dark:text-primary-50 mb-2",children:"ðŸ”„ Recurring Messages"}),e.jsx("p",{className:"text-primary-600 dark:text-primary-400",children:"Automate regular communications"})]}),e.jsx(b,{variant:"primary",size:"lg",onClick:h,children:"+ Create Recurring Message"})]}),x?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(R,{size:"lg",text:"Loading recurring messages..."})}):r.length===0?e.jsxs(w,{variant:"highlight",className:"text-center py-16",children:[e.jsx("div",{className:"mb-6",children:e.jsx("span",{className:"text-6xl",children:"ðŸ”„"})}),e.jsx("h2",{className:"text-2xl font-bold text-primary-900 dark:text-primary-50 mb-3",children:"No Recurring Messages Yet"}),e.jsx("p",{className:"text-primary-600 dark:text-primary-400 mb-6 max-w-md mx-auto",children:"Create recurring messages to automatically send messages on a regular schedule."}),e.jsx(b,{variant:"primary",size:"md",onClick:h,children:"Create First Message"})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:r.map(s=>e.jsxs(w,{variant:"default",className:`hover:shadow-lg transition-shadow ${s.isActive?"":"opacity-75"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary-900 dark:text-primary-50",children:s.name}),e.jsx("p",{className:"text-sm text-primary-600 dark:text-primary-400 mt-1",children:S(s.frequency)})]}),e.jsx("button",{onClick:()=>t(s.id,s.isActive),className:`px-3 py-1 rounded-full text-xs font-semibold transition-colors ${s.isActive?"bg-success-100 dark:bg-success-900 text-success-800 dark:text-success-200":"bg-primary-200 dark:bg-primary-700 text-primary-800 dark:text-primary-300"}`,children:s.isActive?"âœ… Active":"â¸ï¸ Paused"})]}),e.jsx("p",{className:"text-primary-700 dark:text-primary-300 text-sm mb-4 line-clamp-2",children:s.content}),e.jsxs(w,{variant:"highlight",className:"mb-4",children:[e.jsxs("p",{className:"text-primary-900 dark:text-primary-50 text-sm",children:[e.jsx("strong",{children:"â±ï¸ Next send:"})," ",D(s.nextSendAt)]}),e.jsx("p",{className:"text-primary-600 dark:text-primary-400 text-xs mt-2",children:new Date(s.nextSendAt).toLocaleString()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{variant:"secondary",size:"sm",onClick:()=>N(s),fullWidth:!0,children:"Edit"}),e.jsx(b,{variant:"danger",size:"sm",onClick:()=>v(s.id),fullWidth:!0,children:"Delete"})]})]},s.id))})]}),f&&e.jsx(E,{message:j,onClose:u})]})}export{G as RecurringMessagesPage,G as default};
//# sourceMappingURL=RecurringMessagesPage-CG-8EyGw.js.map
